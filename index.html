<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>DSG Book Club | Tactical Study Bible</title>
    <meta name="description" content="DSG Book Club Tactical Study Bible - Spiritual Warfare Edition">
    <meta name="theme-color" content="#0a0a0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DSG Bible">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons for various platforms -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold-400:#facc15;--gold-500:#d4a537;--gold-600:#ca8a04;
            --slate-950:#0a0a0f;--slate-900:#0f0f14;--slate-800:#1a1a22;--slate-700:#25252f;
            --slate-600:#3a3a47;--slate-500:#5a5a6a;--slate-400:#8a8a9a;--slate-300:#b0b0be;
            --slate-200:#d4d4de;--slate-100:#ececf2;
            --crimson:#dc2626;--azure:#0ea5e9;--emerald:#10b981;
            --font-display:'Cormorant Garamond',Georgia,serif;
            --font-body:'Outfit',sans-serif;
            /* Theme colors - will be overridden in light mode */
            --bg-primary:#0a0a0f;--bg-secondary:#0f0f14;--bg-card:#1a1a22;--bg-hover:#25252f;
            --text-primary:#d4d4de;--text-secondary:#8a8a9a;--text-muted:#5a5a6a;
            --border-color:rgba(255,255,255,0.05);--border-light:#25252f;
        }
        
        /* Light Theme */
        body.light-theme {
            --bg-primary:#f5f5f5;--bg-secondary:#ffffff;--bg-card:#ffffff;--bg-hover:#ebebeb;
            --text-primary:#111111;--text-secondary:#333333;--text-muted:#555555;
            --border-color:rgba(0,0,0,0.12);--border-light:#d0d0d0;
            --slate-950:#f5f5f5;--slate-900:#ffffff;--slate-800:#ebebeb;--slate-700:#d0d0d0;
            --slate-600:#777777;--slate-500:#555555;--slate-400:#333333;--slate-300:#222222;
            --slate-200:#111111;--slate-100:#000000;
            --gold-500:#b8860b;--azure:#0077b6;--crimson:#b91c1c;--emerald:#059669;
        }
        body.light-theme #splash{background:var(--bg-primary)}
        body.light-theme .header{background:rgba(255,255,255,0.98);border-bottom:1px solid var(--border-color);box-shadow:0 1px 3px rgba(0,0,0,0.08)}
        body.light-theme select{background:var(--bg-card);border-color:var(--border-light);color:var(--text-primary)}
        body.light-theme .bottom-nav{background:rgba(255,255,255,0.98);border-top:1px solid var(--border-color);box-shadow:0 -1px 3px rgba(0,0,0,0.08)}
        body.light-theme .nav-item{color:#555555}
        body.light-theme .nav-item:hover{color:#111111}
        body.light-theme .modal{background:var(--bg-secondary);border-color:var(--gold-500);box-shadow:0 4px 20px rgba(0,0,0,0.15)}
        body.light-theme .modal-header h2{color:var(--gold-500)}
        body.light-theme .modal-header p{color:#555555}
        body.light-theme .audio-player{background:var(--bg-card);border-color:var(--border-light);box-shadow:0 2px 8px rgba(0,0,0,0.1)}
        body.light-theme .drawer{background:var(--bg-secondary);box-shadow:-2px 0 10px rgba(0,0,0,0.1)}
        body.light-theme .verse{color:#1a1a1a}
        body.light-theme .verse:hover{background:rgba(0,0,0,0.04)}
        body.light-theme .verse.highlighted{background:rgba(212,165,55,0.2);border-left-color:var(--gold-500)}
        body.light-theme .verse-num{color:#666666}
        body.light-theme .dropcap{color:var(--gold-500)}
        body.light-theme .chapter-header{border-color:var(--gold-500)}
        body.light-theme .chapter-book{color:#111111}
        body.light-theme .chapter-num{color:var(--gold-500)}
        body.light-theme .chapter-theme{color:#555555}
        body.light-theme .btn{border-color:#cccccc;color:#333333}
        body.light-theme .btn:hover{border-color:var(--gold-500);color:var(--gold-500)}
        body.light-theme .btn.primary{background:var(--gold-500);color:#ffffff}
        body.light-theme .sidebar-title{color:#333333}
        body.light-theme .font-btn{border-color:#cccccc;color:#333333}
        body.light-theme .font-btn:hover{border-color:var(--gold-500);color:var(--gold-500)}
        body.light-theme .theme-toggle{border-color:#cccccc;color:#333333}
        body.light-theme .red-letter{color:#b91c1c}
        body.light-theme .search-input{background:#f5f5f5;border-color:var(--gold-500);color:#111111}
        body.light-theme .search-item{background:#f5f5f5}
        body.light-theme .search-item:hover{background:#ebebeb}
        body.light-theme .manual-section p{color:#333333}
        body.light-theme .manual-section strong{color:#111111}
        body.light-theme .sidebar{border-color:rgba(0,0,0,0.08)}
        body.light-theme .sidebar-title{color:#555555}
        body.light-theme .card{background:#ffffff;border-color:rgba(0,0,0,0.1)}
        body.light-theme .card-title{color:#111111}
        body.light-theme .card-text{color:#333333}
        body.light-theme .gear-box{background:#f5f5f5}
        body.light-theme .gear-name{color:var(--gold-500)}
        body.light-theme .gear-desc{color:#555555}
        body.light-theme .identity-box{background:#f0f0f0;color:#111111}
        body.light-theme .identity-box h4{color:#555555}
        body.light-theme .identity-box p{color:#111111}
        body.light-theme .christ-box{background:linear-gradient(135deg,rgba(185,28,28,0.08),rgba(184,134,11,0.08));border-color:var(--crimson)}
        body.light-theme .christ-box-title{color:#b8860b}
        body.light-theme .christ-box-desc{color:#222222}
        body.light-theme .christ-box-ref{color:#555555}
        body.light-theme .identity-box{background:linear-gradient(135deg,#f0f0f0,#e8e8f0)}
        body.light-theme .identity-box-label{color:#8b6914}
        body.light-theme .identity-box-type{color:#b91c1c}
        body.light-theme .identity-box-text{color:#111111}
        body.light-theme .identity-box-ref{color:#555555}
        body.light-theme .identity-btn.next{background:#e0e0e0;color:#333333}
        body.light-theme .identity-btn.next:hover{background:#d0d0d0}
        body.light-theme .context-box{background:#f0f0f0}
        body.light-theme .context-row{border-color:#ddd}
        body.light-theme .context-label{color:#666666}
        body.light-theme .context-value{color:#222222}
        body.light-theme .key-verse-box{background:linear-gradient(135deg,rgba(184,134,11,0.12),rgba(184,134,11,0.05))}
        body.light-theme .key-verse-text{color:#1a1a1a}
        body.light-theme .reading-time{background:#f0f0f0}
        body.light-theme .reading-time-text{color:#333333}
        body.light-theme .intro-purpose{background:#f5f5f5;color:#222222}
        body.light-theme .intro-outline li{background:#f5f5f5;color:#333333}
        body.light-theme .topic-btn{background:#f5f5f5;color:#333333;border-color:#ddd}
        body.light-theme .topic-btn:hover,.topic-btn.active{background:rgba(184,134,11,0.1)}
        body.light-theme .topic-verse{background:#f5f5f5}
        body.light-theme .topic-verse:hover{background:#ebebeb}
        body.light-theme .topic-verse-text{color:#222222}
        body.light-theme .topic-back{background:#e0e0e0;color:#333333}
        
        /* Font Size Controls */
        .font-controls{display:flex;align-items:center;gap:4px;margin-left:8px}
        .font-btn{width:28px;height:28px;border-radius:6px;border:1px solid var(--slate-700);background:transparent;color:var(--slate-400);font-size:0.75rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s}
        .font-btn:hover{border-color:var(--gold-500);color:var(--gold-500)}
        
        /* Theme Toggle */
        .theme-toggle{width:36px;height:36px;border-radius:50%;border:1px solid var(--slate-700);background:transparent;color:var(--slate-400);font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;margin-left:8px}
        .theme-toggle:hover{border-color:var(--gold-500);color:var(--gold-500)}
        
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:var(--font-body);background:var(--bg-primary);color:var(--text-primary);line-height:1.6;min-height:100vh;transition:background 0.3s, color 0.3s}
        
        /* Splash */
        #splash{position:fixed;inset:0;background:var(--slate-950);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;transition:opacity 0.5s}
        #splash.hidden{opacity:0;pointer-events:none}
        #splash svg{width:80px;height:80px;margin-bottom:20px}
        #splash h1{font-family:var(--font-display);color:var(--gold-500);font-size:1.5rem;letter-spacing:0.15em}
        #splash p{color:var(--slate-500);font-size:0.7rem;letter-spacing:0.2em;text-transform:uppercase}
        .loader{width:150px;height:2px;background:var(--slate-800);margin-top:30px;border-radius:2px;overflow:hidden}
        .loader-bar{height:100%;background:var(--gold-500);animation:load 1.5s ease-out forwards}
        @keyframes load{from{width:0}to{width:100%}}
        
        /* App Container */
        #app{opacity:0;transition:opacity 0.3s}
        #app.visible{opacity:1}
        
        /* Header */
        .header{position:fixed;top:0;left:0;right:0;height:60px;background:rgba(10,10,15,0.95);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,0.05);display:flex;align-items:center;padding:0 16px;gap:16px;z-index:100}
        .logo{display:flex;align-items:center;gap:10px;text-decoration:none}
        .logo svg{width:32px;height:32px}
        .logo-text{font-family:var(--font-display);font-size:0.95rem;font-weight:700;color:var(--gold-500)}
        .nav-group{display:flex;gap:6px;flex:1;justify-content:center}
        select{background:var(--slate-800);border:1px solid var(--slate-700);color:var(--slate-200);padding:8px 12px;font-size:0.75rem;border-radius:6px;cursor:pointer}
        select:focus{outline:none;border-color:var(--gold-500)}
        .header-actions{display:flex;gap:8px}
        .btn{padding:8px 14px;background:transparent;border:1px solid var(--slate-700);color:var(--slate-400);font-size:0.7rem;font-weight:600;border-radius:6px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:6px}
        .btn:hover{background:var(--slate-800);color:var(--slate-200)}
        .btn.danger{border-color:var(--crimson);color:var(--crimson)}
        .btn.danger:hover{background:var(--crimson);color:#fff}
        .btn.primary{background:var(--gold-500);border-color:var(--gold-500);color:#000}
        .btn.primary:hover{background:var(--gold-400)}
        
        /* Main Layout */
        .main{display:grid;grid-template-columns:250px 1fr 260px;margin-top:60px;margin-bottom:70px;min-height:calc(100vh - 130px)}
        .sidebar{padding:20px;border-right:1px solid rgba(255,255,255,0.03);overflow-y:auto}
        .sidebar.right{border-right:none;border-left:1px solid rgba(255,255,255,0.03)}
        .sidebar-title{font-size:0.6rem;font-weight:600;color:var(--slate-300);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:12px}
        
        /* Cards */
        .card{background:var(--slate-900);border:1px solid rgba(255,255,255,0.03);border-radius:8px;padding:14px;margin-bottom:14px}
        .card.gold{border-left:3px solid var(--gold-500)}
        .card-label{font-size:0.55rem;font-weight:600;color:var(--gold-500);letter-spacing:0.08em;text-transform:uppercase;margin-bottom:4px}
        .card-title{font-family:var(--font-display);font-size:1rem;font-weight:600;color:var(--slate-100);margin-bottom:4px}
        .card-text{font-size:0.8rem;color:var(--slate-300)}
        .gear-box{background:var(--slate-800);border-radius:8px;padding:16px;text-align:center;margin-bottom:14px}
        .gear-icon{font-size:2rem}
        .gear-name{font-family:var(--font-display);font-weight:700;color:var(--gold-500);margin-top:4px}
        .gear-desc{font-size:0.7rem;color:var(--slate-300)}
        .identity-box{background:linear-gradient(135deg,var(--slate-100),#e8e8f0);color:var(--slate-900);padding:16px;border-radius:10px;text-align:center;position:relative;overflow:hidden}
        .identity-box::before{content:'üëë';position:absolute;top:-8px;right:-5px;font-size:3rem;opacity:0.1}
        .identity-box-label{font-size:0.5rem;font-weight:700;letter-spacing:0.12em;color:var(--gold-600);text-transform:uppercase;margin-bottom:6px}
        .identity-box-type{font-size:0.75rem;font-weight:700;color:var(--crimson);margin-bottom:8px}
        .identity-box-text{font-family:var(--font-display);font-size:1rem;font-style:italic;font-weight:600;color:#1a1a2e;line-height:1.4;margin-bottom:8px}
        .identity-box-ref{font-size:0.65rem;color:var(--slate-500);margin-bottom:12px}
        .identity-box-actions{display:flex;gap:6px;justify-content:center}
        .identity-btn{padding:6px 12px;border-radius:6px;border:none;font-size:0.65rem;font-weight:600;cursor:pointer;transition:all 0.2s}
        .identity-btn.speak{background:var(--gold-500);color:#000}
        .identity-btn.speak:hover{background:var(--gold-400)}
        .identity-btn.next{background:var(--slate-800);color:var(--slate-200)}
        .identity-btn.next:hover{background:var(--slate-700)}
        
        /* Christ in Book */
        .christ-box{background:linear-gradient(135deg,rgba(220,38,38,0.1),rgba(212,165,55,0.1));border:1px solid var(--crimson);border-radius:10px;padding:16px;margin-bottom:14px;position:relative;overflow:hidden}
        .christ-box::before{content:'‚úù';position:absolute;top:-10px;right:-5px;font-size:4rem;opacity:0.08;color:var(--crimson)}
        .christ-box-label{font-size:0.5rem;font-weight:700;color:var(--crimson);letter-spacing:0.12em;text-transform:uppercase;margin-bottom:8px;display:flex;align-items:center;gap:6px}
        .christ-box-type{font-size:0.45rem;padding:2px 6px;border-radius:3px;background:rgba(220,38,38,0.2);color:var(--crimson)}
        .christ-box-title{font-family:var(--font-display);font-size:1.1rem;font-weight:700;color:var(--gold-400);margin-bottom:6px}
        .christ-box-desc{font-size:0.8rem;color:var(--slate-200);line-height:1.5;margin-bottom:8px}
        .christ-box-ref{font-size:0.7rem;color:var(--slate-400);font-style:italic}
        
        /* Historical Context Box */
        .context-box{background:var(--slate-800);border-radius:8px;padding:14px;margin-bottom:14px}
        .context-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed var(--slate-700)}
        .context-row:last-child{border-bottom:none}
        .context-label{font-size:0.65rem;color:var(--slate-500);text-transform:uppercase;letter-spacing:0.05em}
        .context-value{font-size:0.75rem;color:var(--slate-200);font-weight:500}
        
        /* Key Verse Box */
        .key-verse-box{background:linear-gradient(135deg,rgba(212,165,55,0.15),rgba(212,165,55,0.05));border:1px solid var(--gold-500);border-radius:10px;padding:14px;margin-bottom:14px;cursor:pointer;transition:all 0.2s}
        .key-verse-box:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(212,165,55,0.2)}
        .key-verse-label{font-size:0.5rem;font-weight:700;color:var(--gold-500);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:8px;display:flex;align-items:center;gap:6px}
        .key-verse-text{font-family:var(--font-display);font-size:0.95rem;font-style:italic;color:var(--slate-100);line-height:1.5;margin-bottom:8px}
        .key-verse-ref{font-size:0.7rem;color:var(--gold-400);font-weight:500}
        .key-verse-actions{display:flex;gap:6px;margin-top:10px}
        .key-verse-btn{padding:5px 10px;border-radius:5px;border:1px solid var(--slate-700);background:transparent;color:var(--slate-400);font-size:0.6rem;font-weight:600;cursor:pointer;transition:all 0.2s}
        .key-verse-btn:hover{border-color:var(--gold-500);color:var(--gold-500)}
        
        /* Reading Time */
        .reading-time{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--slate-800);border-radius:8px;margin-bottom:14px}
        .reading-time-icon{font-size:1.2rem}
        .reading-time-text{font-size:0.8rem;color:var(--slate-300)}
        .reading-time-value{font-weight:600;color:var(--gold-400)}
        
        /* Book Introduction */
        .intro-purpose{font-size:0.95rem;color:var(--slate-200);line-height:1.7;margin-bottom:20px;padding:16px;background:var(--slate-800);border-radius:8px;border-left:3px solid var(--gold-500)}
        .intro-section{margin-bottom:20px}
        .intro-section-title{font-size:0.7rem;font-weight:700;color:var(--gold-500);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:10px}
        .intro-outline{list-style:none;padding:0}
        .intro-outline li{padding:10px 14px;background:var(--slate-800);border-radius:6px;margin-bottom:6px;font-size:0.85rem;color:var(--slate-300);display:flex;align-items:center;gap:10px}
        .intro-outline li::before{content:'‚Üí';color:var(--gold-500);font-weight:bold}
        .intro-themes{display:flex;flex-wrap:wrap;gap:8px}
        .intro-theme{padding:6px 14px;background:linear-gradient(135deg,rgba(212,165,55,0.15),rgba(212,165,55,0.05));border:1px solid var(--gold-500);border-radius:20px;font-size:0.75rem;color:var(--gold-400);font-weight:500}
        
        /* Topical Index */
        .topic-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-bottom:20px}
        .topic-btn{padding:12px;background:var(--slate-800);border:1px solid var(--slate-700);border-radius:8px;color:var(--slate-300);font-size:0.75rem;font-weight:600;cursor:pointer;transition:all 0.2s;text-align:center}
        .topic-btn:hover{border-color:var(--gold-500);color:var(--gold-500);background:rgba(212,165,55,0.1)}
        .topic-btn.active{border-color:var(--gold-500);color:var(--gold-500);background:rgba(212,165,55,0.15)}
        .topic-verses{display:none}
        .topic-verses.active{display:block}
        .topic-verse{padding:14px;background:var(--slate-800);border-left:3px solid var(--azure);margin-bottom:10px;border-radius:0 8px 8px 0;cursor:pointer;transition:all 0.2s}
        .topic-verse:hover{background:var(--slate-700)}
        .topic-verse-ref{font-weight:600;color:var(--azure);margin-bottom:6px;font-size:0.85rem}
        .topic-verse-text{font-family:var(--font-display);font-size:0.95rem;color:var(--slate-200);font-style:italic;line-height:1.5}
        .topic-back{background:var(--slate-800);border:none;color:var(--slate-400);padding:8px 14px;border-radius:6px;cursor:pointer;font-size:0.8rem;margin-bottom:16px;display:flex;align-items:center;gap:6px}
        .topic-back:hover{background:var(--slate-700)}
        
        /* Scripture */
        .scripture{padding:30px;max-width:750px;margin:0 auto}
        .chapter-header{text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:1px solid var(--slate-800)}
        .chapter-book{font-size:0.65rem;color:var(--gold-500);letter-spacing:0.15em;text-transform:uppercase}
        .chapter-num{font-family:var(--font-display);font-size:2.8rem;font-weight:700;color:var(--slate-100)}
        .chapter-theme{font-family:var(--font-display);font-style:italic;color:var(--slate-400)}
        .verses{font-family:var(--font-display);font-size:1.1rem;line-height:1.9}
        .verse{margin-bottom:12px;padding:4px 8px;border-radius:4px;cursor:pointer;transition:background 0.2s;position:relative}
        .verse:hover{background:rgba(255,255,255,0.02)}
        .verse.highlighted{background:rgba(212,165,55,0.1);border-left:3px solid var(--gold-500);padding-left:12px}
        .verse.memorizing{border-right:3px solid var(--azure);background:rgba(14,165,233,0.05)}
        .verse.highlighted.memorizing{border-left:3px solid var(--gold-500);border-right:3px solid var(--azure)}
        .verse-num{font-family:var(--font-body);font-size:0.6rem;font-weight:700;color:var(--gold-600);vertical-align:super;margin-right:6px}
        .verse-actions{opacity:0;margin-left:8px;transition:opacity 0.2s;vertical-align:middle;white-space:nowrap}
        .verse:hover .verse-actions{opacity:1}
        .verse-copy,.verse-mem{cursor:pointer;font-size:0.8rem;margin-left:4px;opacity:0.6;transition:opacity 0.2s}
        .verse-copy:hover,.verse-mem:hover{opacity:1}
        .verse-mem.active{opacity:1}
        .red-letter{color:#ef4444}
        .dropcap{float:left;font-size:3rem;font-weight:700;line-height:0.8;margin-right:10px;color:var(--gold-500)}
        .loading{text-align:center;padding:60px}
        .spinner{width:30px;height:30px;border:2px solid var(--slate-700);border-top-color:var(--gold-500);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 16px}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        /* Reading Progress Bar */
        .book-progress{margin-bottom:14px}
        .book-progress-label{display:flex;justify-content:space-between;font-size:0.65rem;color:var(--slate-500);margin-bottom:6px}
        .book-progress-bar{height:6px;background:var(--slate-800);border-radius:3px;overflow:hidden}
        .book-progress-fill{height:100%;background:linear-gradient(90deg,var(--emerald),var(--gold-500));border-radius:3px;transition:width 0.5s ease-out}
        
        /* Memory Flashcard */
        .flashcard-container{text-align:center;padding:20px}
        .flashcard{background:var(--slate-800);border:2px solid var(--azure);border-radius:12px;padding:30px;margin:20px auto;max-width:500px;min-height:200px;display:flex;flex-direction:column;justify-content:center;cursor:pointer;transition:transform 0.3s}
        .flashcard:hover{transform:scale(1.02)}
        .flashcard-ref{font-size:1.4rem;color:var(--azure);font-weight:700;margin-bottom:16px}
        .flashcard-text{font-family:var(--font-display);font-size:1.1rem;line-height:1.7;color:var(--slate-200);display:none}
        .flashcard.revealed .flashcard-text{display:block}
        .flashcard-hint{font-size:0.8rem;color:var(--slate-500);margin-top:16px}
        .flashcard.revealed .flashcard-hint{display:none}
        .memory-stats{display:flex;justify-content:center;gap:20px;margin-bottom:20px}
        .memory-stat{text-align:center}
        .memory-stat-num{font-size:1.5rem;font-weight:700;color:var(--azure)}
        .memory-stat-label{font-size:0.65rem;color:var(--slate-500);text-transform:uppercase;letter-spacing:0.05em}
        .memory-levels{display:flex;gap:8px;justify-content:center;margin:16px 0}
        .memory-level{padding:6px 12px;border-radius:6px;font-size:0.7rem;font-weight:600;cursor:pointer;border:1px solid var(--slate-700);color:var(--slate-400)}
        .memory-level.active{border-color:var(--azure);color:var(--azure);background:rgba(14,165,233,0.1)}
        .memory-list{max-height:300px;overflow-y:auto}
        .memory-item{display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--slate-800);border-left:3px solid var(--azure);margin-bottom:8px;border-radius:0 6px 6px 0;cursor:pointer}
        .memory-item:hover{background:var(--slate-700)}
        .memory-item-ref{font-weight:600;color:var(--azure)}
        .memory-item-level{font-size:0.6rem;padding:3px 8px;border-radius:4px;background:var(--slate-700);color:var(--slate-400)}
        .memory-item-level.mastered{background:rgba(16,185,129,0.2);color:var(--emerald)}
        
        /* Victory Journal */
        .victory-input{margin-bottom:16px}
        .victory-input textarea{width:100%;min-height:100px;background:var(--slate-800);border:1px solid var(--slate-700);border-radius:8px;padding:12px;color:var(--slate-200);font-family:var(--font-body);font-size:0.85rem;resize:vertical}
        .victory-input textarea:focus{outline:none;border-color:var(--emerald)}
        .victory-type-select{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
        .victory-type{padding:6px 12px;border-radius:6px;font-size:0.7rem;font-weight:600;cursor:pointer;border:1px solid var(--slate-700);color:var(--slate-400);background:transparent}
        .victory-type.selected{border-color:var(--emerald);color:var(--emerald);background:rgba(16,185,129,0.1)}
        .victory-list{max-height:350px;overflow-y:auto}
        .victory-item{padding:14px;background:var(--slate-800);border-left:3px solid var(--emerald);margin-bottom:10px;border-radius:0 8px 8px 0}
        .victory-item-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
        .victory-item-type{font-size:0.6rem;padding:3px 8px;border-radius:4px;background:rgba(16,185,129,0.2);color:var(--emerald);font-weight:600;text-transform:uppercase}
        .victory-item-date{font-size:0.65rem;color:var(--slate-600)}
        .victory-item-text{font-size:0.9rem;color:var(--slate-300);line-height:1.5}
        .victory-item-delete{background:none;border:none;color:var(--slate-600);cursor:pointer;padding:4px}
        .victory-item-delete:hover{color:var(--crimson)}
        
        /* Reading Streak */
        .streak-display{text-align:center;padding:20px;background:linear-gradient(135deg,rgba(250,204,21,0.1),rgba(220,38,38,0.1));border:1px solid var(--gold-500);border-radius:12px;margin-bottom:20px}
        .streak-flame{font-size:3rem;margin-bottom:8px}
        .streak-count{font-size:2.5rem;font-weight:700;color:var(--gold-400)}
        .streak-label{font-size:0.7rem;color:var(--slate-400);letter-spacing:0.1em;text-transform:uppercase}
        .streak-best{font-size:0.75rem;color:var(--slate-500);margin-top:8px}
        .streak-stats{display:flex;justify-content:space-around;margin-top:16px;padding-top:16px;border-top:1px dashed var(--slate-700)}
        .streak-stat{text-align:center}
        .streak-stat-num{font-size:1.3rem;font-weight:700;color:var(--slate-200)}
        .streak-stat-label{font-size:0.6rem;color:var(--slate-500);text-transform:uppercase}
        
        /* Reading Plans */
        .plan-card{background:var(--slate-800);border:1px solid var(--slate-700);border-radius:10px;padding:16px;margin-bottom:12px;cursor:pointer;transition:all 0.2s}
        .plan-card:hover{border-color:var(--gold-500);transform:translateY(-2px)}
        .plan-card.active{border-color:var(--emerald);background:rgba(16,185,129,0.05)}
        .plan-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
        .plan-card-title{font-weight:600;color:var(--slate-100)}
        .plan-card-badge{font-size:0.55rem;padding:3px 8px;border-radius:4px;background:var(--slate-700);color:var(--slate-400)}
        .plan-card.active .plan-card-badge{background:rgba(16,185,129,0.2);color:var(--emerald)}
        .plan-card-desc{font-size:0.8rem;color:var(--slate-500);margin-bottom:10px}
        .plan-card-progress{height:4px;background:var(--slate-700);border-radius:2px;overflow:hidden}
        .plan-card-progress-fill{height:100%;background:var(--emerald);transition:width 0.3s}
        .plan-detail{display:none}
        .plan-detail.active{display:block}
        .plan-today{background:var(--slate-800);border-left:3px solid var(--gold-500);padding:16px;border-radius:0 8px 8px 0;margin-bottom:16px}
        .plan-today-label{font-size:0.6rem;color:var(--gold-500);letter-spacing:0.1em;text-transform:uppercase;margin-bottom:4px}
        .plan-today-reading{font-size:1.1rem;font-weight:600;color:var(--slate-100)}
        .plan-today-btn{margin-top:12px}
        .plan-checklist{max-height:250px;overflow-y:auto}
        .plan-day{display:flex;align-items:center;padding:10px;border-bottom:1px solid var(--slate-800);cursor:pointer}
        .plan-day:hover{background:var(--slate-800)}
        .plan-day-check{width:20px;height:20px;border:2px solid var(--slate-600);border-radius:50%;margin-right:12px;display:flex;align-items:center;justify-content:center;font-size:0.7rem}
        .plan-day.completed .plan-day-check{background:var(--emerald);border-color:var(--emerald);color:#fff}
        .plan-day-text{flex:1;font-size:0.85rem;color:var(--slate-300)}
        .plan-day.completed .plan-day-text{color:var(--slate-500);text-decoration:line-through}
        .plan-day.today{background:rgba(212,165,55,0.1);border-left:3px solid var(--gold-500);margin-left:-3px;padding-left:13px}
        
        /* Declarations */
        .declaration-card{background:linear-gradient(135deg,var(--slate-800),var(--slate-900));border:2px solid var(--gold-500);border-radius:12px;padding:24px;margin-bottom:16px;text-align:center}
        .declaration-type{font-size:0.65rem;color:var(--gold-500);letter-spacing:0.15em;text-transform:uppercase;margin-bottom:12px}
        .declaration-text{font-family:var(--font-display);font-size:1.3rem;font-weight:600;color:var(--slate-100);line-height:1.5;margin-bottom:12px}
        .declaration-ref{font-size:0.85rem;color:var(--gold-400);font-weight:500}
        .declaration-actions{display:flex;gap:8px;justify-content:center;margin-top:16px}
        .declaration-list{max-height:300px;overflow-y:auto}
        .declaration-item{display:flex;align-items:center;padding:12px;background:var(--slate-800);border-left:3px solid var(--gold-500);margin-bottom:8px;border-radius:0 6px 6px 0}
        .declaration-item:hover{background:var(--slate-700)}
        .declaration-item-text{flex:1;font-size:0.9rem;color:var(--slate-300)}
        .declaration-item-type{font-size:0.55rem;padding:2px 6px;border-radius:3px;background:var(--slate-700);color:var(--slate-400);margin-right:8px}
        .declare-type-select{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap;justify-content:center}
        .declare-type{padding:8px 14px;border-radius:6px;font-size:0.75rem;font-weight:600;cursor:pointer;border:1px solid var(--slate-700);color:var(--slate-400);background:transparent}
        .declare-type.selected{border-color:var(--gold-500);color:var(--gold-500);background:rgba(212,165,55,0.1)}
        
        /* Bottom Nav */
        .bottom-nav{position:fixed;bottom:0;left:0;right:0;height:70px;background:rgba(10,10,15,0.98);border-top:1px solid rgba(255,255,255,0.05);display:flex;z-index:100;padding-bottom:env(safe-area-inset-bottom)}
        .nav-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;background:none;border:none;color:var(--slate-500);cursor:pointer;transition:color 0.2s;padding:4px 2px}
        .nav-item:hover{color:var(--slate-300)}
        .nav-item span:first-child{font-size:1.1rem}
        .nav-item span:last-child{font-size:0.5rem;margin-top:4px;font-weight:600;letter-spacing:0.03em}
        
        /* Audio Player */
        .audio-player{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--slate-800);border:1px solid var(--slate-700);border-radius:50px;padding:8px 16px;display:flex;align-items:center;gap:12px;z-index:99}
        .audio-btn{width:32px;height:32px;border-radius:50%;background:var(--gold-500);border:none;color:#000;font-size:0.8rem;cursor:pointer}
        .audio-info{font-size:0.75rem;color:var(--slate-300)}
        
        /* Drawer */
        .drawer-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:200;opacity:0;visibility:hidden;transition:all 0.3s}
        .drawer-overlay.open{opacity:1;visibility:visible}
        .drawer{position:fixed;top:0;right:-380px;width:380px;max-width:90vw;height:100%;background:var(--slate-900);border-left:1px solid var(--gold-500);z-index:201;transition:right 0.3s;display:flex;flex-direction:column}
        .drawer.open{right:0}
        .drawer-header{display:flex;border-bottom:1px solid var(--slate-800)}
        .drawer-tab{flex:1;padding:14px;background:var(--slate-800);border:none;color:var(--slate-500);font-size:0.65rem;font-weight:600;letter-spacing:0.08em;cursor:pointer}
        .drawer-tab.active{background:var(--slate-900);color:var(--gold-500);border-bottom:2px solid var(--gold-500)}
        .drawer-close{padding:14px 16px;background:var(--slate-800);border:none;color:var(--slate-500);font-size:1rem;cursor:pointer}
        .drawer-body{flex:1;padding:20px;overflow-y:auto;display:none}
        .drawer-body.active{display:block}
        .notes-label{font-size:0.6rem;color:var(--slate-500);letter-spacing:0.1em;margin-bottom:12px}
        textarea{width:100%;min-height:250px;background:var(--slate-800);border:1px solid var(--slate-700);border-radius:8px;padding:12px;color:var(--slate-200);font-family:var(--font-body);font-size:0.85rem;resize:vertical}
        textarea:focus{outline:none;border-color:var(--gold-500)}
        .save-status{font-size:0.65rem;color:var(--slate-600);text-align:right;margin-top:6px}
        .target-input{display:flex;gap:8px;margin-bottom:14px}
        .target-input input{flex:1;padding:10px;background:var(--slate-800);border:1px solid var(--slate-700);border-radius:6px;color:var(--slate-200);font-size:0.8rem}
        .target-item{display:flex;align-items:center;padding:10px;background:var(--slate-800);border-left:3px solid var(--crimson);margin-bottom:8px;border-radius:0 6px 6px 0}
        .target-item.done{opacity:0.5;border-color:var(--emerald);text-decoration:line-through}
        .target-item span{flex:1;cursor:pointer}
        .target-item button{background:none;border:none;color:var(--slate-600);cursor:pointer}
        
        /* Modals */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:300;display:none;justify-content:center;align-items:center;padding:20px}
        .modal-overlay.open{display:flex}
        .modal{background:var(--slate-900);border:1px solid var(--slate-700);border-radius:12px;width:100%;max-width:600px;max-height:80vh;overflow-y:auto}
        .modal.large{max-width:750px}
        .modal.war{border-color:var(--crimson)}
        .modal.qrf{border-color:var(--azure)}
        .modal-header{padding:20px;border-bottom:1px solid var(--slate-800)}
        .modal-header h2{font-family:var(--font-display);font-size:1.5rem;color:var(--gold-500)}
        .modal.war .modal-header h2{color:var(--crimson)}
        .modal.qrf .modal-header h2{color:var(--azure)}
        .modal-header p{font-size:0.8rem;color:var(--slate-500)}
        .modal-close{position:absolute;top:16px;right:16px;background:var(--slate-800);border:none;color:var(--slate-400);width:28px;height:28px;border-radius:6px;cursor:pointer}
        .modal-body{padding:20px}
        
        /* Armor Grid */
        .armor-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:20px 0}
        .armor-piece{padding:16px;background:var(--slate-800);border:1px solid var(--slate-700);border-radius:8px;text-align:center;cursor:pointer;opacity:0.4;transition:all 0.2s}
        .armor-piece:hover{opacity:0.6}
        .armor-piece.equipped{opacity:1;border-color:var(--gold-500);background:rgba(212,165,55,0.1)}
        .armor-piece .icon{font-size:1.6rem}
        .armor-piece .name{font-size:0.6rem;color:var(--slate-500);margin-top:6px}
        .armor-piece.equipped .name{color:var(--gold-500)}
        
        /* Strategy Grid */
        .strat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:10px}
        .strat-btn{padding:14px;background:var(--slate-800);border:1px solid var(--slate-700);border-radius:8px;color:var(--slate-300);font-size:0.65rem;font-weight:600;text-transform:uppercase;cursor:pointer;transition:all 0.2s}
        .strat-btn:hover{background:var(--slate-700)}
        .strat-btn.active{border-color:var(--crimson);color:var(--crimson);background:rgba(220,38,38,0.1)}
        .strat-detail{display:none;margin-top:16px;padding:16px;background:var(--slate-800);border-left:3px solid var(--crimson);border-radius:0 8px 8px 0}
        .strat-detail.active{display:block}
        .strat-detail h4{color:var(--gold-500);margin-bottom:10px}
        .strat-detail .verse{background:rgba(220,38,38,0.05);border:1px dashed var(--crimson);padding:12px;border-radius:6px;font-style:italic}
        .divider{text-align:center;margin:20px 0;border-top:1px dashed var(--slate-700);position:relative}
        .divider span{position:absolute;top:-10px;left:50%;transform:translateX(-50%);background:var(--slate-900);padding:0 10px;font-size:0.6rem;color:var(--slate-600);letter-spacing:0.1em}
        
        /* QRF */
        .qrf-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:10px}
        .qrf-btn{padding:16px;background:var(--slate-800);border:1px solid var(--azure);border-radius:8px;color:var(--azure);font-size:0.6rem;font-weight:600;text-transform:uppercase;cursor:pointer;transition:all 0.2s}
        .qrf-btn:hover{background:rgba(14,165,233,0.1)}
        .qrf-btn .icon{font-size:1.3rem;display:block;margin-bottom:6px}
        .qrf-content{display:none}
        .qrf-content.active{display:block}
        .qrf-back{background:var(--slate-800);border:none;color:var(--slate-400);padding:8px 12px;border-radius:6px;cursor:pointer;margin-bottom:16px;font-size:0.8rem}
        .qrf-info{padding:16px;background:var(--slate-800);border-left:3px solid var(--azure);margin-bottom:16px;border-radius:0 8px 8px 0}
        .qrf-info h4{color:var(--azure);margin-bottom:4px}
        .qrf-info p{font-style:italic;color:var(--slate-300);font-size:0.9rem}
        .qrf-verse{padding:12px;background:rgba(14,165,233,0.05);border-left:2px solid var(--azure);margin-bottom:8px;border-radius:0 6px 6px 0}
        .qrf-verse strong{color:var(--azure);display:block;margin-bottom:4px}
        .qrf-verse span{font-style:italic;color:var(--slate-300);font-size:0.9rem}
        
        /* Search */
        .search-input{width:100%;padding:14px;background:var(--slate-800);border:1px solid var(--gold-500);border-radius:8px;color:var(--slate-100);font-size:1rem;margin-bottom:16px}
        .search-input:focus{outline:none}
        .search-results{max-height:350px;overflow-y:auto}
        .search-item{padding:12px;background:var(--slate-800);border-left:3px solid var(--gold-500);margin-bottom:8px;border-radius:0 6px 6px 0;cursor:pointer}
        .search-item:hover{background:var(--slate-700)}
        .search-item strong{color:var(--gold-500)}
        .search-item span{font-size:0.8rem;color:var(--slate-400)}
        .search-verse{padding:14px;background:var(--slate-800);border-left:3px solid var(--azure);margin-bottom:10px;border-radius:0 8px 8px 0;cursor:pointer}
        .search-verse:hover{background:var(--slate-700)}
        .search-verse-ref{font-weight:600;color:var(--azure);margin-bottom:6px}
        .search-verse-text{font-family:var(--font-display);font-size:0.95rem;color:var(--slate-300);line-height:1.5}
        .search-verse-text mark{background:rgba(212,165,55,0.3);color:var(--gold-400);padding:1px 3px;border-radius:2px}
        
        /* Arsenal */
        .arsenal-list{max-height:350px;overflow-y:auto}
        .arsenal-item{padding:12px;background:var(--slate-800);border-left:3px solid var(--gold-500);margin-bottom:8px;border-radius:0 6px 6px 0;cursor:pointer}
        .arsenal-item:hover{background:var(--slate-700)}
        .arsenal-item .type{font-size:0.55rem;color:var(--gold-600);letter-spacing:0.08em;text-transform:uppercase}
        .arsenal-item .ref{color:var(--gold-400);font-weight:600}
        .btn-row{display:flex;gap:8px;margin-top:16px}
        .btn-row .btn{flex:1;justify-content:center}
        
        /* Bootcamp */
        .bootcamp-item{padding:16px;background:var(--slate-800);border-left:3px solid var(--emerald);margin-bottom:10px;border-radius:0 8px 8px 0;cursor:pointer}
        .bootcamp-item:hover{background:var(--slate-700)}
        .bootcamp-item .badge{font-size:0.55rem;color:var(--emerald);letter-spacing:0.08em;text-transform:uppercase}
        .bootcamp-item h4{color:var(--emerald);margin:4px 0}
        .bootcamp-item p{font-size:0.8rem;color:var(--slate-400)}
        .bootcamp-verses{display:none;margin-top:12px;padding-top:12px;border-top:1px dashed var(--slate-700)}
        .bootcamp-item.expanded .bootcamp-verses{display:block}
        .bootcamp-verse{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dotted var(--slate-700);font-size:0.85rem}
        .bootcamp-verse:hover{color:var(--emerald)}
        .check{color:var(--slate-700)}
        .check.done{color:var(--emerald)}
        
        /* Codebook */
        .codebook-item{padding:12px;background:var(--slate-800);border-radius:6px;margin-bottom:8px;cursor:pointer}
        .codebook-item:hover{background:var(--slate-700)}
        .codebook-item .word{font-size:0.75rem;color:var(--azure)}
        .codebook-item .term{font-weight:600;color:var(--slate-200);text-transform:capitalize}
        .codebook-item .def{font-size:0.75rem;color:var(--slate-500)}
        
        /* Manual */
        .manual-section{margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--slate-800)}
        .manual-section:last-child{border:none}
        .manual-section h4{color:var(--gold-500);margin-bottom:10px;display:flex;align-items:center;gap:8px}
        .manual-section p{font-size:0.85rem;color:var(--slate-400);line-height:1.7}
        .manual-section strong{color:var(--slate-200)}
        
        /* Responsive */
        @media(max-width:1024px){
            .main{grid-template-columns:1fr}
            .sidebar{display:none}
            .header-actions{display:none}
        }
        @media(max-width:600px){
            select{padding:6px 10px;font-size:0.7rem}
            .chapter-num{font-size:2rem}
            .verses{font-size:1rem}
            .audio-player{width:90%}
            .armor-grid{grid-template-columns:repeat(2,1fr)}
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div id="splash">
        <svg viewBox="0 0 120 120" fill="none">
            <path d="M15 95 Q35 105 60 95 Q85 105 105 95 V75 Q85 85 60 75 Q35 85 15 75 Z" stroke="#d4a537" stroke-width="2" fill="none"/>
            <rect x="56" y="15" width="8" height="70" rx="2" fill="#d4a537"/>
            <rect x="40" y="30" width="40" height="6" rx="2" fill="#d4a537"/>
            <text x="25" y="58" fill="#fff" font-family="Georgia" font-weight="bold" font-size="24">D</text>
            <text x="72" y="58" fill="#fff" font-family="Georgia" font-weight="bold" font-size="24">G</text>
        </svg>
        <h1>DSG BOOK CLUB</h1>
        <p>Tactical Study Bible</p>
        <div id="verseOfDay" style="max-width:320px;text-align:center;margin-top:24px;padding:16px;background:rgba(212,165,55,0.1);border:1px solid rgba(212,165,55,0.3);border-radius:8px">
            <p style="font-family:var(--font-display);font-style:italic;color:var(--slate-300);font-size:0.95rem;line-height:1.5;margin-bottom:8px" id="vodText"></p>
            <p style="font-size:0.7rem;color:var(--gold-500);letter-spacing:0.1em" id="vodRef"></p>
        </div>
        <div class="loader"><div class="loader-bar"></div></div>
    </div>

    <!-- Main App -->
    <div id="app">
        <header class="header">
            <a href="#" class="logo">
                <svg viewBox="0 0 120 120" fill="none">
                    <path d="M15 95 Q35 105 60 95 Q85 105 105 95 V75 Q85 85 60 75 Q35 85 15 75 Z" stroke="#d4a537" stroke-width="2" fill="none"/>
                    <rect x="56" y="15" width="8" height="70" rx="2" fill="#d4a537"/>
                    <rect x="40" y="30" width="40" height="6" rx="2" fill="#d4a537"/>
                    <text x="25" y="58" fill="#fff" font-family="Georgia" font-weight="bold" font-size="20">D</text>
                    <text x="72" y="58" fill="#fff" font-family="Georgia" font-weight="bold" font-size="20">G</text>
                </svg>
                <span class="logo-text">DSG Book Club</span>
            </a>
            <div class="nav-group">
                <select id="testamentSelect" onchange="updateBooks()">
                    <option value="OT">Old Testament</option>
                    <option value="NT">New Testament</option>
                </select>
                <select id="bookSelect" onchange="loadBook()"></select>
                <select id="chapterSelect" onchange="renderChapter(this.value)"></select>
            </div>
            <div class="header-actions">
                <div class="font-controls">
                    <button class="font-btn" onclick="adjustFontSize(-1)" title="Decrease font">A-</button>
                    <button class="font-btn" onclick="adjustFontSize(1)" title="Increase font">A+</button>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle" title="Toggle theme">üåô</button>
                <button class="btn" onclick="openModal('searchModal')">üîç</button>
                <button class="btn" onclick="openModal('manualModal')">‚ùì</button>
                <button class="btn" onclick="openModal('qrfModal')" style="border-color:var(--azure);color:var(--azure)">‚ö° Q.R.F.</button>
                <button class="btn danger" onclick="openModal('warRoomModal')">‚ö† War Room</button>
            </div>
        </header>

        <main class="main" id="mainContent">
            <aside class="sidebar" id="leftSidebar"></aside>
            <section class="scripture" id="scriptureArea">
                <div class="loading"><div class="spinner"></div><p>Loading...</p></div>
            </section>
            <aside class="sidebar right" id="rightSidebar"></aside>
        </main>

        <div class="audio-player">
            <button class="audio-btn" id="audioBtn" onclick="toggleAudio()">‚ñ∂</button>
            <div class="audio-info"><span id="audioTitle">Ready</span></div>
        </div>

        <nav class="bottom-nav">
            <button class="nav-item" onclick="openModal('introModal')"><span>üìñ</span><span>INTRO</span></button>
            <button class="nav-item" onclick="openModal('topicsModal')"><span>üè∑Ô∏è</span><span>TOPICS</span></button>
            <button class="nav-item" onclick="openModal('plansModal')"><span>üìÖ</span><span>PLANS</span></button>
            <button class="nav-item" onclick="openModal('streakModal')"><span>üî•</span><span>STREAK</span></button>
            <button class="nav-item" onclick="openModal('memoryModal')"><span>üß†</span><span>MEMORY</span></button>
            <button class="nav-item" onclick="openModal('victoryModal')"><span>üèÜ</span><span>VICTORIES</span></button>
            <button class="nav-item" onclick="openModal('declareModal')"><span>üì¢</span><span>DECLARE</span></button>
            <button class="nav-item" onclick="toggleDrawer()"><span>üìù</span><span>NOTES</span></button>
        </nav>
    </div>

    <!-- Drawer -->
    <div class="drawer-overlay" id="drawerOverlay" onclick="toggleDrawer()"></div>
    <div class="drawer" id="drawer">
        <div class="drawer-header">
            <button class="drawer-tab active" onclick="switchDrawerTab(this, 'notesTab')">FIELD NOTES</button>
            <button class="drawer-tab" onclick="switchDrawerTab(this, 'targetsTab')">TARGETS</button>
            <button class="drawer-close" onclick="toggleDrawer()">‚úï</button>
        </div>
        <div class="drawer-body active" id="notesTab">
            <div class="notes-label" id="notesLabel">Battle Log: Genesis 1</div>
            <textarea id="notesArea" placeholder="Record your tactical insights..."></textarea>
            <div class="save-status" id="saveStatus">Auto-saved</div>
        </div>
        <div class="drawer-body" id="targetsTab">
            <div class="notes-label">Prayer Targets</div>
            <div class="target-input">
                <input type="text" id="targetInput" placeholder="Add a prayer target...">
                <button class="btn primary" onclick="addTarget()">Add</button>
            </div>
            <div id="targetList"></div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Briefing Modal -->
    <div class="modal-overlay" id="briefingModal">
        <div class="modal" style="position:relative">
            <button class="modal-close" onclick="closeModal('briefingModal')">‚úï</button>
            <div class="modal-header" style="text-align:center">
                <p style="letter-spacing:0.15em;font-size:0.65rem">DAILY TACTICAL BRIEFING</p>
                <h2>ARMOR CHECK</h2>
                <p style="font-style:italic">"Put on the whole armor of God..."</p>
            </div>
            <div class="modal-body">
                <div class="armor-grid">
                    <div class="armor-piece" id="armor-belt" onclick="toggleArmor('belt')"><div class="icon">ü•ã</div><div class="name">Belt of Truth</div></div>
                    <div class="armor-piece" id="armor-plate" onclick="toggleArmor('plate')"><div class="icon">üõ°Ô∏è</div><div class="name">Breastplate</div></div>
                    <div class="armor-piece" id="armor-shoes" onclick="toggleArmor('shoes')"><div class="icon">ü•æ</div><div class="name">Shoes of Peace</div></div>
                    <div class="armor-piece" id="armor-shield" onclick="toggleArmor('shield')"><div class="icon">üõë</div><div class="name">Shield of Faith</div></div>
                    <div class="armor-piece" id="armor-helmet" onclick="toggleArmor('helmet')"><div class="icon">‚õëÔ∏è</div><div class="name">Helmet</div></div>
                    <div class="armor-piece" id="armor-sword" onclick="toggleArmor('sword')"><div class="icon">‚öîÔ∏è</div><div class="name">Sword</div></div>
                </div>
                <button class="btn primary" style="width:100%" onclick="closeModal('briefingModal')">ACKNOWLEDGE & DEPLOY</button>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="modal-overlay" id="searchModal" onclick="closeModal('searchModal')">
        <div class="modal large" onclick="event.stopPropagation()" style="position:relative">
            <button class="modal-close" onclick="closeModal('searchModal')">‚úï</button>
            <div class="modal-header"><h2>üîç Scripture Search</h2><p>Search books, themes, or verse content</p></div>
            <div class="modal-body">
                <div style="display:flex;gap:8px;margin-bottom:12px">
                    <button class="btn" id="searchModeBooks" onclick="setSearchMode('books')" style="flex:1;border-color:var(--gold-500);color:var(--gold-500)">üìö Books</button>
                    <button class="btn" id="searchModeVerses" onclick="setSearchMode('verses')" style="flex:1">üìñ Verses</button>
                </div>
                <input type="text" class="search-input" id="searchInput" placeholder="Search..." oninput="performSearch()" onkeydown="if(event.key==='Enter')performSearch()">
                <div id="searchLoading" style="display:none;text-align:center;padding:20px"><div class="spinner"></div><p>Searching Scripture...</p></div>
                <div class="search-results" id="searchResults" style="max-height:400px;overflow-y:auto"><p style="color:var(--slate-500);text-align:center">Enter a search term...</p></div>
            </div>
        </div>
    </div>

    <!-- Lexicon Modal -->
    <div class="modal-overlay" id="lexiconModal" onclick="closeModal('lexiconModal')">
        <div class="modal" onclick="event.stopPropagation()" style="position:relative;border-color:var(--azure)">
            <button class="modal-close" onclick="closeModal('lexiconModal')">‚úï</button>
            <div class="modal-header"><h2 id="lexWord" style="color:var(--azure)">Word</h2><p id="lexPhonetic">(phonetic)</p></div>
            <div class="modal-body">
                <p id="lexDef" style="margin-bottom:16px"></p>
                <div style="background:var(--slate-800);padding:14px;border-radius:8px">
                    <div style="font-size:0.6rem;color:var(--azure);letter-spacing:0.1em;margin-bottom:4px">WARFARE APPLICATION</div>
                    <p id="lexApp"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Codebook Modal -->
    <div class="modal-overlay" id="codebookModal" onclick="closeModal('codebookModal')">
        <div class="modal" onclick="event.stopPropagation()" style="position:relative">
            <button class="modal-close" onclick="closeModal('codebookModal')">‚úï</button>
            <div class="modal-header"><h2 style="color:var(--slate-300)">The Codebook</h2><p>Greek & Hebrew decoded</p></div>
            <div class="modal-body"><div id="codebookList"></div></div>
        </div>
    </div>

    <!-- Arsenal Modal -->
    <div class="modal-overlay" id="arsenalModal" onclick="closeModal('arsenalModal')">
        <div class="modal" onclick="event.stopPropagation()" style="position:relative">
            <button class="modal-close" onclick="closeModal('arsenalModal')">‚úï</button>
            <div class="modal-header"><h2>The Arsenal</h2><p>Your saved intel</p></div>
            <div class="modal-body">
                <div class="arsenal-list" id="arsenalList"></div>
                <div class="btn-row">
                    <button class="btn primary" onclick="exportData()">‚¨á Export</button>
                    <button class="btn" onclick="document.getElementById('importFile').click()">‚¨Ü Import</button>
                    <input type="file" id="importFile" style="display:none" onchange="importData(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- Bootcamp Modal -->
    <div class="modal-overlay" id="bootcampModal" onclick="closeModal('bootcampModal')">
        <div class="modal" onclick="event.stopPropagation()" style="position:relative">
            <button class="modal-close" onclick="closeModal('bootcampModal')">‚úï</button>
            <div class="modal-header"><h2 style="color:var(--emerald)">Boot Camp</h2><p>Training missions</p></div>
            <div class="modal-body"><div id="bootcampList"></div></div>
        </div>
    </div>

    <!-- Manual Modal -->
    <div class="modal-overlay" id="manualModal" onclick="closeModal('manualModal')">
        <div class="modal large" onclick="event.stopPropagation()" style="position:relative">
            <button class="modal-close" onclick="closeModal('manualModal')">‚úï</button>
            <div class="modal-header"><h2 style="color:var(--slate-300)">Field Manual</h2><p>Standard Operating Procedures</p></div>
            <div class="modal-body">
                <div class="manual-section">
                    <h4>üß≠ Navigation</h4>
                    <p><strong>Top Bar:</strong> Select Testament ‚Üí Book ‚Üí Chapter using dropdowns.<br>
                    <strong>Chapter Arrows:</strong> Use ‚Üê Previous / Next ‚Üí buttons or keyboard arrow keys.<br>
                    <strong>üîñ Bookmark:</strong> Save your place to return later.<br>
                    <strong>Bottom Bar:</strong> Quick access to all tools and features.</p>
                </div>
                
                <div class="manual-section">
                    <h4>üìñ Reading Features</h4>
                    <p><strong>Tap any verse</strong> to highlight it (gold border).<br>
                    <strong>üî¥ Red Letters:</strong> Jesus' words appear in red in the Gospels.<br>
                    <strong>Blue underlined words</strong> are Greek/Hebrew terms ‚Äî tap to see definitions.<br>
                    <strong>üìã Copy:</strong> Hover over a verse and click üìã to copy with reference.<br>
                    <strong>Progress Bar:</strong> Shows how much of the current book you've read.</p>
                </div>
                
                <div class="manual-section">
                    <h4>‚úùÔ∏è Christ in This Book</h4>
                    <p><strong>Purpose:</strong> See how Jesus is revealed in every book of the Bible.<br>
                    <strong>Location:</strong> Right sidebar, updates automatically for each book.<br>
                    <strong>Categories:</strong><br>
                    ‚Ä¢ <strong>Prophecy</strong> ‚Äî Direct predictions about Jesus (OT)<br>
                    ‚Ä¢ <strong>Type/Shadow</strong> ‚Äî People, events, or objects that foreshadow Christ<br>
                    ‚Ä¢ <strong>Appearance</strong> ‚Äî Pre-incarnate appearances of Christ (Theophanies)<br>
                    ‚Ä¢ <strong>Fulfilled</strong> ‚Äî NT reveals Jesus directly<br>
                    <strong>The Red Thread:</strong> From Genesis to Revelation, Jesus is the central figure of all Scripture.</p>
                </div>
                
                <div class="manual-section">
                    <h4>üé® Display Settings</h4>
                    <p><strong>Font Size:</strong> Use A- / A+ buttons in the header to adjust text size (14-28px).<br>
                    <strong>Theme Toggle:</strong> Click üåô/‚òÄÔ∏è to switch between dark and light mode.<br>
                    <strong>Preferences saved:</strong> Your font size and theme are remembered.</p>
                </div>
                
                <div class="manual-section">
                    <h4>üîç Scripture Search</h4>
                    <p><strong>Two search modes:</strong><br>
                    ‚Ä¢ üìö <strong>Books</strong> ‚Äî Search by book name or theme<br>
                    ‚Ä¢ üìñ <strong>Verses</strong> ‚Äî Search actual verse content<br>
                    <strong>Verse search:</strong> Find all verses containing words like "fear not", "love", "faith".<br>
                    <strong>Results:</strong> Matching text is highlighted. Click to jump to that passage.<br>
                    <strong>Access:</strong> Click üîç in the header or use the Search modal.</p>
                </div>
                
                <div class="manual-section">
                    <h4>üî• Reading Streak</h4>
                    <p><strong>Purpose:</strong> Build consistent daily Bible reading habits.<br>
                    <strong>How it works:</strong> Read any chapter to log today's reading.<br>
                    <strong>Consecutive days:</strong> Your streak increases each day you read.<br>
                    <strong>Miss a day:</strong> Streak resets to 1, but your best record is saved.<br>
                    <strong>Stats tracked:</strong> Current streak, best streak, total days, chapters read, books started.<br>
                    <strong>Tip:</strong> Even reading one chapter keeps your streak alive!</p>
                </div>
                
                <div class="manual-section">
                    <h4>üìÖ Reading Plans</h4>
                    <p><strong>Available plans:</strong><br>
                    ‚Ä¢ ‚öîÔ∏è Spiritual Warfare Bootcamp (21 days) ‚Äî Battle-ready Scripture<br>
                    ‚Ä¢ üìú Psalms in 30 Days ‚Äî 5 Psalms per day<br>
                    ‚Ä¢ ‚úùÔ∏è Gospels in 30 Days ‚Äî Walk with Jesus<br>
                    ‚Ä¢ üå± New Believer Foundations (14 days) ‚Äî Essential truths<br>
                    <strong>To start:</strong> Tap üìÖ PLANS ‚Üí Select a plan ‚Üí Start reading.<br>
                    <strong>Track progress:</strong> Check off completed days. Resume anytime.<br>
                    <strong>Today's Reading:</strong> Shows current day's assignment with quick-start button.</p>
                </div>
                
                <div class="manual-section">
                    <h4>üì¢ Declarations</h4>
                    <p><strong>Purpose:</strong> Turn Scripture into personal declarations you speak over your life.<br>
                    <strong>Browse:</strong> Cycle through 23 preset declarations using ‚Üê Prev / Next ‚Üí<br>
                    <strong>Declaration Types:</strong><br>
                    ‚Ä¢ I AM ‚Äî Identity statements ("I am more than a conqueror")<br>
                    ‚Ä¢ GOD IS ‚Äî Truth about God's character<br>
                    ‚Ä¢ I HAVE ‚Äî What belongs to you in Christ<br>
                    ‚Ä¢ I CAN ‚Äî Authority and ability statements<br>
                    <strong>üîä Speak:</strong> Use text-to-speech to hear and repeat.<br>
                    <strong>Create custom:</strong> Write your own based on Scripture.<br>
                    <strong>Save:</strong> Build your personal declaration arsenal.</p>
                </div>
                
                <div class="manual-section">
                    <h4>üß† Scripture Memory</h4>
                    <p><strong>To memorize a verse:</strong> Hover over any verse and click üß†.<br>
                    <strong>Open Memory:</strong> Tap üß† MEMORY in bottom nav.<br>
                    <strong>Flashcard Mode:</strong> Click "Start Flashcards" to review.<br>
                    <strong>How it works:</strong> See the reference ‚Üí try to recall ‚Üí tap to reveal ‚Üí rate yourself.<br>
                    <strong>Levels:</strong> New ‚Üí Learning ‚Üí Mastered (based on your ratings).<br>
                    <strong>Tip:</strong> Review daily for best retention!</p>
                </div>
                
                <div class="manual-section">
                    <h4>üèÜ Victory Journal</h4>
                    <p><strong>Purpose:</strong> Document God's faithfulness for future encouragement.<br>
                    <strong>To record:</strong> Tap üèÜ VICTORIES ‚Üí Select type ‚Üí Write what happened ‚Üí Save.<br>
                    <strong>Victory Types:</strong><br>
                    ‚Ä¢ üôè Answered Prayer ‚Äî God responded to your request<br>
                    ‚Ä¢ ‚ö° Breakthrough ‚Äî Obstacle overcome, chains broken<br>
                    ‚Ä¢ üõ°Ô∏è Protection ‚Äî Danger averted, safety provided<br>
                    ‚Ä¢ üíé Provision ‚Äî Needs met, resources supplied<br>
                    ‚Ä¢ ‚ù§Ô∏è Healing ‚Äî Physical, emotional, or relational restoration<br>
                    ‚Ä¢ üì£ Testimony ‚Äî Story worth sharing with others<br>
                    <strong>Tip:</strong> Review past victories when facing new battles!</p>
                </div>
                
                <div class="manual-section">
                    <h4>‚öîÔ∏è Combat Systems</h4>
                    <p><strong>WAR ROOM (Red):</strong> Strategic intel for your current book + global defense declarations against specific attacks.<br>
                    <strong>Q.R.F. (Blue):</strong> Quick Reaction Force ‚Äî emergency Scripture for anxiety, lust, anger, depression, burnout, confusion, condemnation, and doubt.<br>
                    <strong>Daily Armor Check:</strong> Appears once daily. Tap each armor piece to "equip" it as a declaration.</p>
                </div>
                
                <div class="manual-section">
                    <h4>üìù Notes & Targets</h4>
                    <p><strong>Field Notes:</strong> Personal notes saved per chapter. Auto-saves as you type.<br>
                    <strong>Prayer Targets:</strong> Track people/situations you're praying for. Tap to mark complete.</p>
                </div>
                
                <div class="manual-section">
                    <h4>üìñ Lexicon (Codebook)</h4>
                    <p><strong>18 Greek & Hebrew warfare terms</strong> with definitions and battlefield applications.<br>
                    <strong>Access:</strong> Click any blue word in Scripture or tap header ‚ùì for more tools.<br>
                    <strong>Includes:</strong> Dunamis (power), Exousia (authority), Histemi (stand), Rhema (spoken word), Nikao (overcome), and more.</p>
                </div>
                
                <div class="manual-section">
                    <h4>üíæ Your Data</h4>
                    <p><strong>Auto-save:</strong> All highlights, notes, bookmarks, memories, victories, plans, and declarations save automatically.<br>
                    <strong>Export:</strong> Download all your data as a backup file (in Arsenal).<br>
                    <strong>Import:</strong> Restore from a previous backup.<br>
                    <strong>Storage:</strong> Everything is stored locally in your browser.</p>
                </div>
                
                <div class="manual-section">
                    <h4>üéß Audio</h4>
                    <p><strong>Text-to-Speech:</strong> Click ‚ñ∂ in the audio bar to hear the chapter read aloud.<br>
                    <strong>Pause:</strong> Click again to stop.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- QRF Modal -->
    <div class="modal-overlay" id="qrfModal" onclick="closeModal('qrfModal')">
        <div class="modal large qrf" onclick="event.stopPropagation()" style="position:relative">
            <button class="modal-close" onclick="closeModal('qrfModal')">‚úï</button>
            <div class="modal-header"><h2>Quick Reaction Force</h2><p>Emergency protocols</p></div>
            <div class="modal-body">
                <div class="qrf-grid" id="qrfGrid"></div>
                <div class="qrf-content" id="qrfContent">
                    <button class="qrf-back" onclick="resetQRF()">‚Üê Back</button>
                    <div class="qrf-info"><h4 id="qrfTitle"></h4><p id="qrfTactic"></p></div>
                    <div id="qrfVerses"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- War Room Modal -->
    <div class="modal-overlay" id="warRoomModal" onclick="closeModal('warRoomModal')">
        <div class="modal large war" onclick="event.stopPropagation()" style="position:relative">
            <button class="modal-close" onclick="closeModal('warRoomModal')">‚úï</button>
            <div class="modal-header"><h2 id="warRoomTitle">War Room</h2><p>Tactical strategies</p></div>
            <div class="modal-body">
                <div id="sectorTactics"></div>
                <div class="divider"><span>GLOBAL DEFENSES</span></div>
                <div class="strat-grid" id="defenseGrid"></div>
                <div id="strategyDetails"></div>
            </div>
        </div>
    </div>

    <!-- Book Introduction Modal -->
    <div class="modal-overlay" id="introModal" onclick="closeModal('introModal')">
        <div class="modal large" onclick="event.stopPropagation()" style="position:relative">
            <button class="modal-close" onclick="closeModal('introModal')">‚úï</button>
            <div class="modal-header">
                <h2>üìñ <span id="introBookName">Genesis</span></h2>
                <p>Book Introduction & Overview</p>
            </div>
            <div class="modal-body" id="introContent">
                <div class="intro-purpose" id="introPurpose"></div>
                <div class="intro-section">
                    <div class="intro-section-title">üìë Outline</div>
                    <ul class="intro-outline" id="introOutline"></ul>
                </div>
                <div class="intro-section">
                    <div class="intro-section-title">üéØ Key Themes</div>
                    <div class="intro-themes" id="introThemes"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Topical Index Modal -->
    <div class="modal-overlay" id="topicsModal" onclick="closeModal('topicsModal')">
        <div class="modal large" onclick="event.stopPropagation()" style="position:relative">
            <button class="modal-close" onclick="closeModal('topicsModal')">‚úï</button>
            <div class="modal-header">
                <h2>üè∑Ô∏è Topical Index</h2>
                <p>Find verses by topic</p>
            </div>
            <div class="modal-body">
                <div id="topicsList">
                    <div class="topic-grid" id="topicGrid"></div>
                </div>
                <div id="topicVerses" class="topic-verses">
                    <button class="topic-back" onclick="showTopicsList()">‚Üê Back to Topics</button>
                    <h3 id="topicTitle" style="color:var(--gold-500);margin-bottom:16px;font-family:var(--font-display)"></h3>
                    <div id="topicVersesList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripture Memory Modal -->
    <div class="modal-overlay" id="memoryModal" onclick="closeModal('memoryModal')">
        <div class="modal large" onclick="event.stopPropagation()" style="position:relative;border-color:var(--azure)">
            <button class="modal-close" onclick="closeModal('memoryModal')">‚úï</button>
            <div class="modal-header"><h2 style="color:var(--azure)">üß† Scripture Memory</h2><p>Commit the Word to your heart</p></div>
            <div class="modal-body">
                <div class="memory-stats">
                    <div class="memory-stat"><div class="memory-stat-num" id="memTotal">0</div><div class="memory-stat-label">Total</div></div>
                    <div class="memory-stat"><div class="memory-stat-num" id="memLearning">0</div><div class="memory-stat-label">Learning</div></div>
                    <div class="memory-stat"><div class="memory-stat-num" id="memMastered">0</div><div class="memory-stat-label">Mastered</div></div>
                </div>
                <div style="text-align:center;margin-bottom:20px">
                    <button class="btn primary" onclick="startFlashcards()" id="flashcardBtn">‚ö° Start Flashcards</button>
                </div>
                <div id="flashcardArea" style="display:none">
                    <div class="flashcard" onclick="revealFlashcard()">
                        <div class="flashcard-ref" id="flashcardRef">John 3:16</div>
                        <div class="flashcard-text" id="flashcardText">For God so loved the world...</div>
                        <div class="flashcard-hint">Tap to reveal verse</div>
                    </div>
                    <div style="display:flex;gap:10px;justify-content:center;margin-top:16px">
                        <button class="btn" onclick="rateFlashcard('hard')" style="border-color:var(--crimson);color:var(--crimson)">üòì Hard</button>
                        <button class="btn" onclick="rateFlashcard('good')" style="border-color:var(--gold-500);color:var(--gold-500)">üëç Good</button>
                        <button class="btn" onclick="rateFlashcard('easy')" style="border-color:var(--emerald);color:var(--emerald)">üî• Easy</button>
                    </div>
                </div>
                <div id="memoryListArea">
                    <div class="sidebar-title" style="margin-top:16px">YOUR MEMORY VERSES</div>
                    <div class="memory-list" id="memoryList"><p style="color:var(--slate-500);text-align:center;padding:20px">Click üß† on any verse to add it to your memory list</p></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Victory Journal Modal -->
    <div class="modal-overlay" id="victoryModal" onclick="closeModal('victoryModal')">
        <div class="modal large" onclick="event.stopPropagation()" style="position:relative;border-color:var(--emerald)">
            <button class="modal-close" onclick="closeModal('victoryModal')">‚úï</button>
            <div class="modal-header"><h2 style="color:var(--emerald)">üèÜ Victory Journal</h2><p>Remember what God has done</p></div>
            <div class="modal-body">
                <div class="victory-input">
                    <div class="victory-type-select">
                        <span class="victory-type selected" onclick="selectVictoryType(this,'answered')">üôè Answered Prayer</span>
                        <span class="victory-type" onclick="selectVictoryType(this,'breakthrough')">‚ö° Breakthrough</span>
                        <span class="victory-type" onclick="selectVictoryType(this,'protection')">üõ°Ô∏è Protection</span>
                        <span class="victory-type" onclick="selectVictoryType(this,'provision')">üíé Provision</span>
                        <span class="victory-type" onclick="selectVictoryType(this,'healing')">‚ù§Ô∏è Healing</span>
                        <span class="victory-type" onclick="selectVictoryType(this,'testimony')">üì£ Testimony</span>
                    </div>
                    <textarea id="victoryInput" placeholder="Record your victory... What did God do? How did He come through?"></textarea>
                    <button class="btn primary" style="width:100%;margin-top:10px" onclick="addVictory()">üìù Record Victory</button>
                </div>
                <div class="sidebar-title">PAST VICTORIES</div>
                <div class="victory-list" id="victoryList"><p style="color:var(--slate-500);text-align:center;padding:20px">No victories recorded yet. Start documenting God's faithfulness!</p></div>
            </div>
        </div>
    </div>

    <!-- Reading Streaks Modal -->
    <div class="modal-overlay" id="streakModal" onclick="closeModal('streakModal')">
        <div class="modal" onclick="event.stopPropagation()" style="position:relative;border-color:var(--gold-500)">
            <button class="modal-close" onclick="closeModal('streakModal')">‚úï</button>
            <div class="modal-header"><h2 style="color:var(--gold-400)">üî• Reading Streak</h2><p>Consistency builds warriors</p></div>
            <div class="modal-body">
                <div class="streak-display">
                    <div class="streak-flame">üî•</div>
                    <div class="streak-count" id="streakCount">0</div>
                    <div class="streak-label">Day Streak</div>
                    <div class="streak-best">Best: <span id="streakBest">0</span> days</div>
                    <div class="streak-stats">
                        <div class="streak-stat"><div class="streak-stat-num" id="streakTotal">0</div><div class="streak-stat-label">Total Days</div></div>
                        <div class="streak-stat"><div class="streak-stat-num" id="streakChapters">0</div><div class="streak-stat-label">Chapters</div></div>
                        <div class="streak-stat"><div class="streak-stat-num" id="streakBooks">0</div><div class="streak-stat-label">Books</div></div>
                    </div>
                </div>
                <p style="text-align:center;font-size:0.85rem;color:var(--slate-400)">Read any chapter to keep your streak alive!</p>
            </div>
        </div>
    </div>

    <!-- Reading Plans Modal -->
    <div class="modal-overlay" id="plansModal" onclick="closeModal('plansModal')">
        <div class="modal large" onclick="event.stopPropagation()" style="position:relative;border-color:var(--emerald)">
            <button class="modal-close" onclick="closeModal('plansModal')">‚úï</button>
            <div class="modal-header"><h2 style="color:var(--emerald)">üìÖ Reading Plans</h2><p>Structured paths through Scripture</p></div>
            <div class="modal-body">
                <div id="plansList">
                    <!-- Plan cards will be inserted here -->
                </div>
                <div id="planDetail" class="plan-detail">
                    <button class="btn" onclick="showPlansList()" style="margin-bottom:16px">‚Üê Back to Plans</button>
                    <div class="plan-today">
                        <div class="plan-today-label">Today's Reading</div>
                        <div class="plan-today-reading" id="planTodayReading">Genesis 1-3</div>
                        <button class="btn primary plan-today-btn" onclick="goToPlanReading()">üìñ Start Reading</button>
                    </div>
                    <div class="sidebar-title">PROGRESS</div>
                    <div class="plan-checklist" id="planChecklist">
                        <!-- Days will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Declarations Modal -->
    <div class="modal-overlay" id="declareModal" onclick="closeModal('declareModal')">
        <div class="modal large" onclick="event.stopPropagation()" style="position:relative;border-color:var(--gold-500)">
            <button class="modal-close" onclick="closeModal('declareModal')">‚úï</button>
            <div class="modal-header"><h2 style="color:var(--gold-400)">üì¢ Declarations</h2><p>Speak the Word over your life</p></div>
            <div class="modal-body">
                <div id="declarationGenerator">
                    <div class="declaration-card" id="currentDeclaration">
                        <div class="declaration-type" id="declareType">I AM</div>
                        <div class="declaration-text" id="declareText">More than a conqueror through Christ who loves me</div>
                        <div class="declaration-ref" id="declareRef">‚Äî Romans 8:37</div>
                        <div class="declaration-actions">
                            <button class="btn" onclick="prevDeclaration()">‚Üê Prev</button>
                            <button class="btn primary" onclick="speakDeclaration()">üîä Speak</button>
                            <button class="btn" onclick="nextDeclaration()">Next ‚Üí</button>
                        </div>
                    </div>
                    <div style="text-align:center;margin-bottom:20px">
                        <button class="btn" onclick="saveDeclaration()">üíæ Save to My Declarations</button>
                    </div>
                </div>
                <div class="divider"><span>CREATE CUSTOM</span></div>
                <div class="declare-type-select">
                    <span class="declare-type selected" onclick="selectDeclareType(this,'I AM')">I AM</span>
                    <span class="declare-type" onclick="selectDeclareType(this,'GOD IS')">GOD IS</span>
                    <span class="declare-type" onclick="selectDeclareType(this,'I HAVE')">I HAVE</span>
                    <span class="declare-type" onclick="selectDeclareType(this,'I CAN')">I CAN</span>
                </div>
                <textarea id="customDeclareText" placeholder="Write your declaration based on Scripture..." style="width:100%;min-height:80px;background:var(--slate-800);border:1px solid var(--slate-700);border-radius:8px;padding:12px;color:var(--slate-200);font-size:0.9rem;margin-bottom:8px"></textarea>
                <input type="text" id="customDeclareRef" placeholder="Scripture reference (e.g., Philippians 4:13)" style="width:100%;padding:10px;background:var(--slate-800);border:1px solid var(--slate-700);border-radius:6px;color:var(--slate-200);font-size:0.85rem;margin-bottom:12px">
                <button class="btn primary" style="width:100%" onclick="addCustomDeclaration()">‚ûï Add Declaration</button>
                
                <div class="sidebar-title" style="margin-top:20px">MY DECLARATIONS</div>
                <div class="declaration-list" id="declarationList"><p style="color:var(--slate-500);text-align:center;padding:20px">Save declarations to build your arsenal</p></div>
            </div>
        </div>
    </div>

    <script>
    // === DATA ===
    const BIBLE = {
        OT: [
            {name:'Genesis',ch:50,theme:'Origins of War'},{name:'Exodus',ch:40,theme:'Deliverance'},{name:'Leviticus',ch:27,theme:'Holiness'},
            {name:'Numbers',ch:36,theme:'Wilderness'},{name:'Deuteronomy',ch:34,theme:'The Law'},{name:'Joshua',ch:24,theme:'Possessing Land'},
            {name:'Judges',ch:21,theme:'Cycles'},{name:'Ruth',ch:4,theme:'Redeemer'},{name:'1 Samuel',ch:31,theme:'Prophet & King'},
            {name:'2 Samuel',ch:24,theme:'David\'s Throne'},{name:'1 Kings',ch:22,theme:'Divided'},{name:'2 Kings',ch:25,theme:'Exile'},
            {name:'1 Chronicles',ch:29,theme:'Covenant'},{name:'2 Chronicles',ch:36,theme:'History'},{name:'Ezra',ch:10,theme:'Rebuilding'},
            {name:'Nehemiah',ch:13,theme:'Walls'},{name:'Esther',ch:10,theme:'Providence'},{name:'Job',ch:42,theme:'Suffering'},
            {name:'Psalms',ch:150,theme:'Worship'},{name:'Proverbs',ch:31,theme:'Wisdom'},{name:'Ecclesiastes',ch:12,theme:'Meaning'},
            {name:'Song of Solomon',ch:8,theme:'Love'},{name:'Isaiah',ch:66,theme:'Messiah'},{name:'Jeremiah',ch:52,theme:'Warning'},
            {name:'Lamentations',ch:5,theme:'Grief'},{name:'Ezekiel',ch:48,theme:'Glory'},{name:'Daniel',ch:12,theme:'Kingdoms'},
            {name:'Hosea',ch:14,theme:'Faithfulness'},{name:'Joel',ch:3,theme:'Day of Lord'},{name:'Amos',ch:9,theme:'Justice'},
            {name:'Obadiah',ch:1,theme:'Edom'},{name:'Jonah',ch:4,theme:'Mercy'},{name:'Micah',ch:7,theme:'Hope'},
            {name:'Nahum',ch:3,theme:'Nineveh'},{name:'Habakkuk',ch:3,theme:'Faith'},{name:'Zephaniah',ch:3,theme:'Judgment'},
            {name:'Haggai',ch:2,theme:'Temple'},{name:'Zechariah',ch:14,theme:'Coming King'},{name:'Malachi',ch:4,theme:'Messenger'}
        ],
        NT: [
            {name:'Matthew',ch:28,theme:'Kingdom'},{name:'Mark',ch:16,theme:'Servant'},{name:'Luke',ch:24,theme:'Son of Man'},
            {name:'John',ch:21,theme:'Son of God'},{name:'Acts',ch:28,theme:'Spirit'},{name:'Romans',ch:16,theme:'Righteousness'},
            {name:'1 Corinthians',ch:16,theme:'Church'},{name:'2 Corinthians',ch:13,theme:'Ministry'},{name:'Galatians',ch:6,theme:'Freedom'},
            {name:'Ephesians',ch:6,theme:'Identity'},{name:'Philippians',ch:4,theme:'Joy'},{name:'Colossians',ch:4,theme:'Supremacy'},
            {name:'1 Thessalonians',ch:5,theme:'Return'},{name:'2 Thessalonians',ch:3,theme:'Day'},{name:'1 Timothy',ch:6,theme:'Leadership'},
            {name:'2 Timothy',ch:4,theme:'Endurance'},{name:'Titus',ch:3,theme:'Works'},{name:'Philemon',ch:1,theme:'Forgiveness'},
            {name:'Hebrews',ch:13,theme:'Better'},{name:'James',ch:5,theme:'Action'},{name:'1 Peter',ch:5,theme:'Suffering'},
            {name:'2 Peter',ch:3,theme:'Knowledge'},{name:'1 John',ch:5,theme:'Love'},{name:'2 John',ch:1,theme:'Truth'},
            {name:'3 John',ch:1,theme:'Hospitality'},{name:'Jude',ch:1,theme:'Contend'},{name:'Revelation',ch:22,theme:'Victory'}
        ]
    };

    const LEXICON = {
        light: {word:'Ohr (◊ê◊ï÷π◊®)',phonetic:'ore',def:'Light, luminosity, dawn. First thing God spoke.',app:'God speaks light into darkness. Use the Word to illuminate your situations.'},
        glory: {word:'Kabod (◊õ÷∏÷º◊ë◊ï÷π◊ì)',phonetic:'kaw-bode',def:'Weight, heaviness, glory. God\'s tangible presence.',app:'When God\'s glory shows up, everything else becomes light.'},
        peace: {word:'Shalom (◊©÷∏◊Å◊ú◊ï÷π◊ù)',phonetic:'shaw-lome',def:'Completeness, wholeness, peace, welfare.',app:'Not absence of conflict but complete wholeness. Declare shalom over chaos.'},
        strength: {word:'Chayil (◊ó÷∑◊ô÷¥◊ú)',phonetic:'khah-yil',def:'Strength, might, valor, army.',app:'Proverbs 31 woman is "eshet chayil" - woman of valor. You have warrior strength.'},
        power: {word:'Dunamis (Œ¥œçŒΩŒ±ŒºŒπœÇ)',phonetic:'doo-nam-is',def:'Miraculous power, force (dynamite).',app:'You have explosive, miraculous power via the Holy Spirit.'},
        authority: {word:'Exousia (·ºêŒæŒøœÖœÉŒØŒ±)',phonetic:'ex-oo-see-ah',def:'Authority, delegated power to act.',app:'Police stop traffic by authority not strength. Jesus gave you His badge.'},
        stand: {word:'Histemi (·ºµœÉœÑŒ∑ŒºŒπ)',phonetic:'his-tay-mee',def:'To stand firm, hold ground.',app:'Eph 6:13 - "Having done all, STAND." Not advance, not retreat. HOLD.'},
        shield: {word:'Thureos (Œ∏œÖœÅŒµœåœÇ)',phonetic:'thoo-reh-os',def:'Large door-shaped shield.',app:'Faith isn\'t a small buckler‚Äîit\'s a full-body shield.'},
        word: {word:'Rhema (·ø•·øÜŒºŒ±)',phonetic:'hray-mah',def:'Spoken word, utterance.',app:'The sword of the Spirit is the rhema word. Declare Scripture aloud.'},
        wrestle: {word:'Pale (œÄŒ¨ŒªŒ∑)',phonetic:'pal-ay',def:'Wrestling, hand-to-hand combat.',app:'Spiritual warfare is intimate combat, not distant theory.'},
        stronghold: {word:'Ochuroma (·ΩÄœáœçœÅœâŒºŒ±)',phonetic:'okh-oo-ro-mah',def:'Fortress, stronghold.',app:'A lie believed so long it becomes a mental fortress. Demolish with truth.'},
        overcome: {word:'Nikao (ŒΩŒπŒ∫Œ¨œâ)',phonetic:'nik-ah-o',def:'To conquer, overcome, prevail.',app:'You ARE an overcomer in Christ. Walk in your victory.'},
        love: {word:'Agape (·ºÄŒ≥Œ¨œÄŒ∑)',phonetic:'ag-ah-pay',def:'Unconditional, sacrificial love.',app:'The highest weapon. Love never fails.'},
        faith: {word:'Pistis (œÄŒØœÉœÑŒπœÇ)',phonetic:'pis-tis',def:'Faith, trust, confidence.',app:'The shield that quenches ALL fiery darts.'},
        hope: {word:'Elpis (·ºêŒªœÄŒØœÇ)',phonetic:'el-pece',def:'Hope, confident expectation.',app:'The helmet protects your mind with hope.'},
        truth: {word:'Aletheia (·ºÄŒªŒÆŒ∏ŒµŒπŒ±)',phonetic:'al-ay-thi-a',def:'Truth, reality.',app:'The belt holds everything together.'},
        grace: {word:'Charis (œáŒ¨œÅŒπœÇ)',phonetic:'khar-ece',def:'Grace, favor, gift.',app:'Grace is power to do what you cannot.'},
        spirit: {word:'Pneuma (œÄŒΩŒµ·ø¶ŒºŒ±)',phonetic:'pnyoo-mah',def:'Spirit, wind, breath.',app:'The Spirit that raised Christ lives in you.'}
    };

    const QRF_DATA = {
        ANXIETY: {title:'PANIC / ANXIETY',tactic:'Hold the Line. Do not engage "what ifs." Engage the "I AM."',verses:[{ref:'Philippians 4:6-7',text:'In nothing be anxious; but in everything by prayer and supplication with thanksgiving let your requests be made known unto God.'},{ref:'2 Timothy 1:7',text:'God gave us not a spirit of fear, but of power and love and discipline.'},{ref:'Isaiah 41:10',text:'Fear thou not, for I am with thee; be not dismayed, for I am thy God.'}]},
        LUST: {title:'LUST / TEMPTATION',tactic:'Eject immediately. Do not negotiate. Bounce your eyes AND thoughts.',verses:[{ref:'1 Corinthians 6:18',text:'Flee fornication. Your body is a temple of the Holy Spirit.'},{ref:'Galatians 5:16',text:'Walk by the Spirit, and ye shall not fulfill the lust of the flesh.'},{ref:'Job 31:1',text:'I made a covenant with mine eyes.'}]},
        ANGER: {title:'ANGER / RAGE',tactic:'De-escalate. Anger gives the enemy a landing strip (Eph 4:27).',verses:[{ref:'James 1:19-20',text:'Be swift to hear, slow to speak, slow to wrath: for the wrath of man worketh not the righteousness of God.'},{ref:'Proverbs 15:1',text:'A soft answer turneth away wrath.'},{ref:'Ephesians 4:26-27',text:'Be ye angry, and sin not: let not the sun go down upon your wrath.'}]},
        DEPRESSION: {title:'DEPRESSION / HEAVINESS',tactic:'Put on the Garment of Praise. Heaviness is a spirit‚Äîpraise is the weapon.',verses:[{ref:'Isaiah 61:3',text:'The garment of praise for the spirit of heaviness.'},{ref:'Psalms 42:5',text:'Why art thou cast down, O my soul? Hope thou in God.'},{ref:'Nehemiah 8:10',text:'The joy of Jehovah is your strength.'}]},
        BURNOUT: {title:'WEAKNESS / BURNOUT',tactic:'Strategic Rest. This is not retreat‚Äîit\'s tactical recovery.',verses:[{ref:'Isaiah 40:31',text:'They that wait for Jehovah shall renew their strength; they shall mount up with wings as eagles.'},{ref:'Matthew 11:28',text:'Come unto me, all ye that labor and are heavy laden, and I will give you rest.'},{ref:'2 Corinthians 12:9',text:'My grace is sufficient for thee: for my power is made perfect in weakness.'}]},
        CONFUSION: {title:'CONFUSION / INDECISION',tactic:'Stabilize. God is NOT the author of confusion. Wait until waters clear.',verses:[{ref:'1 Corinthians 14:33',text:'God is not a God of confusion, but of peace.'},{ref:'James 1:5',text:'If any of you lacketh wisdom, let him ask of God.'},{ref:'Proverbs 3:5-6',text:'Trust in Jehovah with all thy heart... He will direct thy paths.'}]},
        CONDEMNATION: {title:'GUILT / CONDEMNATION',tactic:'Distinguish conviction from condemnation. One leads to repentance, the other to despair.',verses:[{ref:'Romans 8:1',text:'There is therefore now no condemnation to them that are in Christ Jesus.'},{ref:'1 John 1:9',text:'If we confess our sins, he is faithful to forgive us.'},{ref:'Psalms 103:12',text:'As far as the east is from the west, so far hath he removed our transgressions.'}]},
        DOUBT: {title:'DOUBT / UNBELIEF',tactic:'Faith comes by hearing (Rom 10:17). Flood your ears with the Word.',verses:[{ref:'Romans 10:17',text:'Belief cometh of hearing, and hearing by the word of Christ.'},{ref:'Mark 9:24',text:'I believe; help thou mine unbelief.'},{ref:'Hebrews 11:6',text:'Without faith it is impossible to be well-pleasing unto him.'}]}
    };

    const DEFENSES = {
        condemnation: {title:'BREASTPLATE OF RIGHTEOUSNESS',verse:'I am the Righteousness of God in Christ! (2 Cor 5:21)'},
        anxiety: {title:'SHIELD OF FAITH',verse:'God has not given me a spirit of fear, but of power and love. (2 Tim 1:7)'},
        offense: {title:'SHOES OF PEACE',verse:'I choose to walk in the Gospel of Peace. (Eph 4:27)'},
        pride: {title:'CLOAK OF HUMILITY',verse:'God resisteth the proud, but giveth grace to the humble. (James 4:6)'},
        lust: {title:'THE SPIRIT WALK',verse:'Walk by the Spirit, and ye shall not fulfill the lust of the flesh. (Gal 5:16)'},
        bitterness: {title:'ROOT EXTRACTION',verse:'Lest any root of bitterness springing up trouble you. (Heb 12:15)'},
        discouragement: {title:'THE DAVID MANEUVER',verse:'David encouraged himself in Jehovah his God. (1 Sam 30:6)'}
    };

    const BOOTCAMP = [
        {title:'MISSION ALPHA: The Armor',desc:'Protection training',verses:[{t:'Ephesians 6',l:'Full Armor'},{t:'Romans 13',l:'Armor of Light'},{t:'2 Corinthians 10',l:'Strongholds'}]},
        {title:'MISSION BRAVO: Wisdom',desc:'Strategic foundation',verses:[{t:'Proverbs 1',l:'Beginning'},{t:'Proverbs 4',l:'Guard Heart'},{t:'James 1',l:'Ask Wisdom'}]},
        {title:'MISSION CHARLIE: Identity',desc:'Know who you are',verses:[{t:'Genesis 1',l:'Image Bearer'},{t:'Romans 8',l:'Adoption'},{t:'Ephesians 1',l:'Seated'}]}
    ];

    // Fallback Scripture Content (when API unavailable)
    const SCRIPTURE_FALLBACK = {
        'Genesis-1': [
            {verse:1,text:'In the beginning God created the heavens and the earth.'},
            {verse:2,text:'And the earth was waste and void; and darkness was upon the face of the deep: and the Spirit of God moved upon the face of the waters.'},
            {verse:3,text:'And God said, Let there be light: and there was light.'},
            {verse:4,text:'And God saw the light, that it was good: and God divided the light from the darkness.'},
            {verse:5,text:'And God called the light Day, and the darkness he called Night. And there was evening and there was morning, one day.'},
            {verse:6,text:'And God said, Let there be a firmament in the midst of the waters, and let it divide the waters from the waters.'},
            {verse:7,text:'And God made the firmament, and divided the waters which were under the firmament from the waters which were above the firmament: and it was so.'},
            {verse:8,text:'And God called the firmament Heaven. And there was evening and there was morning, a second day.'},
            {verse:9,text:'And God said, Let the waters under the heavens be gathered together unto one place, and let the dry land appear: and it was so.'},
            {verse:10,text:'And God called the dry land Earth; and the gathering together of the waters called he Seas: and God saw that it was good.'},
            {verse:11,text:'And God said, Let the earth put forth grass, herbs yielding seed, and fruit-trees bearing fruit after their kind, wherein is the seed thereof, upon the earth: and it was so.'},
            {verse:12,text:'And the earth brought forth grass, herbs yielding seed after their kind, and trees bearing fruit, wherein is the seed thereof, after their kind: and God saw that it was good.'},
            {verse:13,text:'And there was evening and there was morning, a third day.'},
            {verse:14,text:'And God said, Let there be lights in the firmament of heaven to divide the day from the night; and let them be for signs, and for seasons, and for days and years.'},
            {verse:15,text:'And let them be for lights in the firmament of heaven to give light upon the earth: and it was so.'},
            {verse:16,text:'And God made the two great lights; the greater light to rule the day, and the lesser light to rule the night: he made the stars also.'},
            {verse:17,text:'And God set them in the firmament of heaven to give light upon the earth,'},
            {verse:18,text:'And to rule over the day and over the night, and to divide the light from the darkness: and God saw that it was good.'},
            {verse:19,text:'And there was evening and there was morning, a fourth day.'},
            {verse:20,text:'And God said, Let the waters swarm with swarms of living creatures, and let birds fly above the earth in the open firmament of heaven.'},
            {verse:21,text:'And God created the great sea-monsters, and every living creature that moveth, wherewith the waters swarmed, after their kind, and every winged bird after its kind: and God saw that it was good.'},
            {verse:22,text:'And God blessed them, saying, Be fruitful, and multiply, and fill the waters in the seas, and let birds multiply on the earth.'},
            {verse:23,text:'And there was evening and there was morning, a fifth day.'},
            {verse:24,text:'And God said, Let the earth bring forth living creatures after their kind, cattle, and creeping things, and beasts of the earth after their kind: and it was so.'},
            {verse:25,text:'And God made the beasts of the earth after their kind, and the cattle after their kind, and everything that creepeth upon the ground after its kind: and God saw that it was good.'},
            {verse:26,text:'And God said, Let us make man in our image, after our likeness: and let them have dominion over the fish of the sea, and over the birds of the heavens, and over the cattle, and over all the earth, and over every creeping thing that creepeth upon the earth.'},
            {verse:27,text:'And God created man in his own image, in the image of God created he him; male and female created he them.'},
            {verse:28,text:'And God blessed them: and God said unto them, Be fruitful, and multiply, and replenish the earth, and subdue it; and have dominion over the fish of the sea, and over the birds of the heavens, and over every living thing that moveth upon the earth.'},
            {verse:29,text:'And God said, Behold, I have given you every herb yielding seed, which is upon the face of all the earth, and every tree, in which is the fruit of a tree yielding seed; to you it shall be for food.'},
            {verse:30,text:'And to every beast of the earth, and to every bird of the heavens, and to everything that creepeth upon the earth, wherein there is life, I have given every green herb for food: and it was so.'},
            {verse:31,text:'And God saw everything that he had made, and, behold, it was very good. And there was evening and there was morning, the sixth day.'}
        ],
        'Psalms-23': [
            {verse:1,text:'Jehovah is my shepherd; I shall not want.'},
            {verse:2,text:'He maketh me to lie down in green pastures; He leadeth me beside still waters.'},
            {verse:3,text:'He restoreth my soul: He guideth me in the paths of righteousness for his name\'s sake.'},
            {verse:4,text:'Yea, though I walk through the valley of the shadow of death, I will fear no evil; for thou art with me; Thy rod and thy staff, they comfort me.'},
            {verse:5,text:'Thou preparest a table before me in the presence of mine enemies: Thou hast anointed my head with oil; My cup runneth over.'},
            {verse:6,text:'Surely goodness and lovingkindness shall follow me all the days of my life; And I shall dwell in the house of Jehovah for ever.'}
        ],
        'Psalms-91': [
            {verse:1,text:'He that dwelleth in the secret place of the Most High Shall abide under the shadow of the Almighty.'},
            {verse:2,text:'I will say of Jehovah, He is my refuge and my fortress; My God, in whom I trust.'},
            {verse:3,text:'For he will deliver thee from the snare of the fowler, And from the deadly pestilence.'},
            {verse:4,text:'He will cover thee with his pinions, And under his wings shalt thou take refuge: His truth is a shield and a buckler.'},
            {verse:5,text:'Thou shalt not be afraid for the terror by night, Nor for the arrow that flieth by day;'},
            {verse:6,text:'For the pestilence that walketh in darkness, Nor for the destruction that wasteth at noonday.'},
            {verse:7,text:'A thousand shall fall at thy side, And ten thousand at thy right hand; But it shall not come nigh thee.'},
            {verse:8,text:'Only with thine eyes shalt thou behold, And see the reward of the wicked.'},
            {verse:9,text:'For thou, O Jehovah, art my refuge! Thou hast made the Most High thy habitation;'},
            {verse:10,text:'There shall no evil befall thee, Neither shall any plague come nigh thy tent.'},
            {verse:11,text:'For he will give his angels charge over thee, To keep thee in all thy ways.'},
            {verse:12,text:'They shall bear thee up in their hands, Lest thou dash thy foot against a stone.'},
            {verse:13,text:'Thou shalt tread upon the lion and adder: The young lion and the serpent shalt thou trample under foot.'},
            {verse:14,text:'Because he hath set his love upon me, therefore will I deliver him: I will set him on high, because he hath known my name.'},
            {verse:15,text:'He shall call upon me, and I will answer him; I will be with him in trouble: I will deliver him, and honor him.'},
            {verse:16,text:'With long life will I satisfy him, And show him my salvation.'}
        ],
        'Ephesians-6': [
            {verse:1,text:'Children, obey your parents in the Lord: for this is right.'},
            {verse:2,text:'Honor thy father and mother (which is the first commandment with promise),'},
            {verse:3,text:'That it may be well with thee, and thou mayest live long on the earth.'},
            {verse:4,text:'And, ye fathers, provoke not your children to wrath: but nurture them in the chastening and admonition of the Lord.'},
            {verse:5,text:'Servants, be obedient unto them that according to the flesh are your masters, with fear and trembling, in singleness of your heart, as unto Christ;'},
            {verse:6,text:'Not in the way of eyeservice, as men-pleasers; but as servants of Christ, doing the will of God from the heart;'},
            {verse:7,text:'With good will doing service, as unto the Lord, and not unto men:'},
            {verse:8,text:'Knowing that whatsoever good thing each one doeth, the same shall he receive again from the Lord, whether he be bond or free.'},
            {verse:9,text:'And, ye masters, do the same things unto them, and forbear threatening: knowing that he who is both their Master and yours is in heaven, and there is no respect of persons with him.'},
            {verse:10,text:'Finally, be strong in the Lord, and in the strength of his might.'},
            {verse:11,text:'Put on the whole armor of God, that ye may be able to stand against the wiles of the devil.'},
            {verse:12,text:'For our wrestling is not against flesh and blood, but against the principalities, against the powers, against the world-rulers of this darkness, against the spiritual hosts of wickedness in the heavenly places.'},
            {verse:13,text:'Wherefore take up the whole armor of God, that ye may be able to withstand in the evil day, and, having done all, to stand.'},
            {verse:14,text:'Stand therefore, having girded your loins with truth, and having put on the breastplate of righteousness,'},
            {verse:15,text:'And having shod your feet with the preparation of the gospel of peace;'},
            {verse:16,text:'Withal taking up the shield of faith, wherewith ye shall be able to quench all the fiery darts of the evil one.'},
            {verse:17,text:'And take the helmet of salvation, and the sword of the Spirit, which is the word of God:'},
            {verse:18,text:'With all prayer and supplication praying at all seasons in the Spirit, and watching thereunto in all perseverance and supplication for all the saints,'},
            {verse:19,text:'And on my behalf, that utterance may be given unto me in opening my mouth, to make known with boldness the mystery of the gospel,'},
            {verse:20,text:'For which I am an ambassador in chains; that in it I may speak boldly, as I ought to speak.'},
            {verse:21,text:'But that ye also may know my affairs, how I do, Tychicus, the beloved brother and faithful minister in the Lord, shall make known to you all things:'},
            {verse:22,text:'Whom I have sent unto you for this very purpose, that ye may know our state, and that he may comfort your hearts.'},
            {verse:23,text:'Peace be to the brethren, and love with faith, from God the Father and the Lord Jesus Christ.'},
            {verse:24,text:'Grace be with all them that love our Lord Jesus Christ with a love incorruptible.'}
        ],
        'John-1': [
            {verse:1,text:'In the beginning was the Word, and the Word was with God, and the Word was God.'},
            {verse:2,text:'The same was in the beginning with God.'},
            {verse:3,text:'All things were made through him; and without him was not anything made that hath been made.'},
            {verse:4,text:'In him was life; and the life was the light of men.'},
            {verse:5,text:'And the light shineth in the darkness; and the darkness apprehended it not.'},
            {verse:6,text:'There came a man, sent from God, whose name was John.'},
            {verse:7,text:'The same came for witness, that he might bear witness of the light, that all might believe through him.'},
            {verse:8,text:'He was not the light, but came that he might bear witness of the light.'},
            {verse:9,text:'There was the true light, even the light which lighteth every man, coming into the world.'},
            {verse:10,text:'He was in the world, and the world was made through him, and the world knew him not.'},
            {verse:11,text:'He came unto his own, and they that were his own received him not.'},
            {verse:12,text:'But as many as received him, to them gave he the right to become children of God, even to them that believe on his name:'},
            {verse:13,text:'Who were born, not of blood, nor of the will of the flesh, nor of the will of man, but of God.'},
            {verse:14,text:'And the Word became flesh, and dwelt among us (and we beheld his glory, glory as of the only begotten from the Father), full of grace and truth.'}
        ],
        'Romans-8': [
            {verse:1,text:'There is therefore now no condemnation to them that are in Christ Jesus.'},
            {verse:2,text:'For the law of the Spirit of life in Christ Jesus made me free from the law of sin and of death.'},
            {verse:3,text:'For what the law could not do, in that it was weak through the flesh, God, sending his own Son in the likeness of sinful flesh and for sin, condemned sin in the flesh:'},
            {verse:4,text:'That the ordinance of the law might be fulfilled in us, who walk not after the flesh, but after the Spirit.'},
            {verse:5,text:'For they that are after the flesh mind the things of the flesh; but they that are after the Spirit the things of the Spirit.'},
            {verse:14,text:'For as many as are led by the Spirit of God, these are sons of God.'},
            {verse:15,text:'For ye received not the spirit of bondage again unto fear; but ye received the spirit of adoption, whereby we cry, Abba, Father.'},
            {verse:16,text:'The Spirit himself beareth witness with our spirit, that we are children of God:'},
            {verse:17,text:'And if children, then heirs; heirs of God, and joint-heirs with Christ; if so be that we suffer with him, that we may be also glorified with him.'},
            {verse:28,text:'And we know that to them that love God all things work together for good, even to them that are called according to his purpose.'},
            {verse:31,text:'What then shall we say to these things? If God is for us, who is against us?'},
            {verse:35,text:'Who shall separate us from the love of Christ? shall tribulation, or anguish, or persecution, or famine, or nakedness, or peril, or sword?'},
            {verse:37,text:'Nay, in all these things we are more than conquerors through him that loved us.'},
            {verse:38,text:'For I am persuaded, that neither death, nor life, nor angels, nor principalities, nor things present, nor things to come, nor powers,'},
            {verse:39,text:'Nor height, nor depth, nor any other creature, shall be able to separate us from the love of God, which is in Christ Jesus our Lord.'}
        ],
        'Matthew-6': [
            {verse:9,text:'After this manner therefore pray ye. Our Father who art in heaven, Hallowed be thy name.'},
            {verse:10,text:'Thy kingdom come. Thy will be done, as in heaven, so on earth.'},
            {verse:11,text:'Give us this day our daily bread.'},
            {verse:12,text:'And forgive us our debts, as we also have forgiven our debtors.'},
            {verse:13,text:'And bring us not into temptation, but deliver us from the evil one.'},
            {verse:14,text:'For if ye forgive men their trespasses, your heavenly Father will also forgive you.'},
            {verse:25,text:'Therefore I say unto you, be not anxious for your life, what ye shall eat, or what ye shall drink; nor yet for your body, what ye shall put on. Is not the life more than the food, and the body than the raiment?'},
            {verse:26,text:'Behold the birds of the heaven, that they sow not, neither do they reap, nor gather into barns; and your heavenly Father feedeth them. Are not ye of much more value than they?'},
            {verse:27,text:'And which of you by being anxious can add one cubit unto the measure of his life?'},
            {verse:33,text:'But seek ye first his kingdom, and his righteousness; and all these things shall be added unto you.'},
            {verse:34,text:'Be not therefore anxious for the morrow: for the morrow will be anxious for itself. Sufficient unto the day is the evil thereof.'}
        ],
        'Proverbs-3': [
            {verse:1,text:'My son, forget not my law; But let thy heart keep my commandments:'},
            {verse:2,text:'For length of days, and years of life, And peace, will they add to thee.'},
            {verse:3,text:'Let not kindness and truth forsake thee: Bind them about thy neck; Write them upon the tablet of thy heart:'},
            {verse:4,text:'So shalt thou find favor and good understanding In the sight of God and man.'},
            {verse:5,text:'Trust in Jehovah with all thy heart, And lean not upon thine own understanding:'},
            {verse:6,text:'In all thy ways acknowledge him, And he will direct thy paths.'},
            {verse:7,text:'Be not wise in thine own eyes; Fear Jehovah, and depart from evil:'},
            {verse:8,text:'It will be health to thy navel, And marrow to thy bones.'},
            {verse:9,text:'Honor Jehovah with thy substance, And with the first-fruits of all thine increase:'},
            {verse:10,text:'So shall thy barns be filled with plenty, And thy vats shall overflow with new wine.'}
        ],
        'Joshua-1': [
            {verse:1,text:'Now it came to pass after the death of Moses the servant of Jehovah, that Jehovah spake unto Joshua the son of Nun, Moses\' minister, saying,'},
            {verse:2,text:'Moses my servant is dead; now therefore arise, go over this Jordan, thou, and all this people, unto the land which I do give to them, even to the children of Israel.'},
            {verse:3,text:'Every place that the sole of your foot shall tread upon, to you have I given it, as I spake unto Moses.'},
            {verse:5,text:'There shall not any man be able to stand before thee all the days of thy life: as I was with Moses, so I will be with thee; I will not fail thee, nor forsake thee.'},
            {verse:6,text:'Be strong and of good courage; for thou shalt cause this people to inherit the land which I sware unto their fathers to give them.'},
            {verse:7,text:'Only be strong and very courageous, to observe to do according to all the law, which Moses my servant commanded thee: turn not from it to the right hand or to the left, that thou mayest have good success whithersoever thou goest.'},
            {verse:8,text:'This book of the law shall not depart out of thy mouth, but thou shalt meditate thereon day and night, that thou mayest observe to do according to all that is written therein: for then thou shalt make thy way prosperous, and then thou shalt have good success.'},
            {verse:9,text:'Have not I commanded thee? Be strong and of good courage; be not affrighted, neither be thou dismayed: for Jehovah thy God is with thee whithersoever thou goest.'}
        ],
        'Isaiah-40': [
            {verse:28,text:'Hast thou not known? hast thou not heard? The everlasting God, Jehovah, the Creator of the ends of the earth, fainteth not, neither is weary; there is no searching of his understanding.'},
            {verse:29,text:'He giveth power to the faint; and to him that hath no might he increaseth strength.'},
            {verse:30,text:'Even the youths shall faint and be weary, and the young men shall utterly fall:'},
            {verse:31,text:'But they that wait for Jehovah shall renew their strength; they shall mount up with wings as eagles; they shall run, and not be weary; they shall walk, and not faint.'}
        ],
        'Philippians-4': [
            {verse:4,text:'Rejoice in the Lord always: again I will say, Rejoice.'},
            {verse:5,text:'Let your forbearance be known unto all men. The Lord is at hand.'},
            {verse:6,text:'In nothing be anxious; but in everything by prayer and supplication with thanksgiving let your requests be made known unto God.'},
            {verse:7,text:'And the peace of God, which passeth all understanding, shall guard your hearts and your thoughts in Christ Jesus.'},
            {verse:8,text:'Finally, brethren, whatsoever things are true, whatsoever things are honorable, whatsoever things are just, whatsoever things are pure, whatsoever things are lovely, whatsoever things are of good report; if there be any virtue, and if there be any praise, think on these things.'},
            {verse:11,text:'Not that I speak in respect of want: for I have learned, in whatsoever state I am, therein to be content.'},
            {verse:12,text:'I know how to be abased, and I know also how to abound: in everything and in all things have I learned the secret both to be filled and to be hungry, both to abound and to be in want.'},
            {verse:13,text:'I can do all things in him that strengtheneth me.'},
            {verse:19,text:'And my God shall supply every need of yours according to his riches in glory in Christ Jesus.'}
        ],
        'James-1': [
            {verse:2,text:'Count it all joy, my brethren, when ye fall into manifold temptations;'},
            {verse:3,text:'Knowing that the proving of your faith worketh patience.'},
            {verse:4,text:'And let patience have its perfect work, that ye may be perfect and entire, lacking in nothing.'},
            {verse:5,text:'But if any of you lacketh wisdom, let him ask of God, who giveth to all liberally and upbraideth not; and it shall be given him.'},
            {verse:6,text:'But let him ask in faith, nothing doubting: for he that doubteth is like the surge of the sea driven by the wind and tossed.'},
            {verse:12,text:'Blessed is the man that endureth temptation; for when he hath been approved, he shall receive the crown of life, which the Lord promised to them that love him.'},
            {verse:19,text:'Ye know this, my beloved brethren. But let every man be swift to hear, slow to speak, slow to wrath:'},
            {verse:20,text:'For the wrath of man worketh not the righteousness of God.'},
            {verse:22,text:'But be ye doers of the word, and not hearers only, deluding your own selves.'}
        ],
        'Revelation-21': [
            {verse:1,text:'And I saw a new heaven and a new earth: for the first heaven and the first earth are passed away; and the sea is no more.'},
            {verse:2,text:'And I saw the holy city, new Jerusalem, coming down out of heaven from God, made ready as a bride adorned for her husband.'},
            {verse:3,text:'And I heard a great voice out of the throne saying, Behold, the tabernacle of God is with men, and he shall dwell with them, and they shall be his peoples, and God himself shall be with them, and be their God:'},
            {verse:4,text:'And he shall wipe away every tear from their eyes; and death shall be no more; neither shall there be mourning, nor crying, nor pain, any more: the first things are passed away.'},
            {verse:5,text:'And he that sitteth on the throne said, Behold, I make all things new. And he saith, Write: for these words are faithful and true.'},
            {verse:6,text:'And he said unto me, They are come to pass. I am the Alpha and the Omega, the beginning and the end. I will give unto him that is athirst of the fountain of the water of life freely.'},
            {verse:7,text:'He that overcometh shall inherit these things; and I will be his God, and he shall be my son.'}
        ]
    };

    const GEAR = {
        Genesis:{icon:'üß±',name:'THE ALTAR',desc:'Sacrifice'},Exodus:{icon:'üêç',name:'THE STAFF',desc:'Authority'},
        Joshua:{icon:'üé∫',name:'RAMS HORN',desc:'Warfare'},Psalms:{icon:'üé∂',name:'THE HARP',desc:'Praise'},
        Isaiah:{icon:'ü¶Ö',name:'EAGLES WINGS',desc:'Strength'},Matthew:{icon:'üîë',name:'KEYS',desc:'Kingdom'},
        John:{icon:'üî¶',name:'THE LIGHT',desc:'Truth'},Ephesians:{icon:'üõ°Ô∏è',name:'FULL ARMOR',desc:'Defense'},
        Revelation:{icon:'üóùÔ∏è',name:'MASTER KEYS',desc:'Victory'}
    };

    // Christ in Every Book - How Jesus is revealed throughout Scripture
    const CHRIST_IN_BOOK = {
        // Old Testament
        'Genesis': {title:'The Seed of the Woman', desc:'The promised One who will crush the serpent\'s head', ref:'Genesis 3:15', type:'prophecy'},
        'Exodus': {title:'The Passover Lamb', desc:'The spotless sacrifice whose blood delivers from death', ref:'Exodus 12:13', type:'type'},
        'Leviticus': {title:'Our High Priest', desc:'The mediator who makes atonement for sin', ref:'Leviticus 16', type:'type'},
        'Numbers': {title:'The Bronze Serpent', desc:'Lifted up for the healing of all who look to Him', ref:'Numbers 21:9', type:'type'},
        'Deuteronomy': {title:'The Prophet Like Moses', desc:'The greater lawgiver who speaks God\'s words', ref:'Deuteronomy 18:15', type:'prophecy'},
        'Joshua': {title:'Captain of the Lord\'s Army', desc:'The commander who leads His people to victory', ref:'Joshua 5:14', type:'appearance'},
        'Judges': {title:'The Deliverer', desc:'The true Judge who saves His people from oppression', ref:'Judges 2:16', type:'type'},
        'Ruth': {title:'The Kinsman Redeemer', desc:'The relative who pays the price to redeem His bride', ref:'Ruth 4:14', type:'type'},
        '1 Samuel': {title:'The Anointed King', desc:'The true King after God\'s own heart', ref:'1 Samuel 16:13', type:'type'},
        '2 Samuel': {title:'Son of David', desc:'The heir to an eternal throne', ref:'2 Samuel 7:12-13', type:'prophecy'},
        '1 Kings': {title:'The Greater Solomon', desc:'The King of wisdom and glory', ref:'1 Kings 4:29-34', type:'type'},
        '2 Kings': {title:'The Miracle Worker', desc:'The prophet greater than Elijah and Elisha', ref:'2 Kings 5:14', type:'type'},
        '1 Chronicles': {title:'The Temple Builder', desc:'The One who builds God\'s true dwelling place', ref:'1 Chronicles 17:12', type:'type'},
        '2 Chronicles': {title:'The King of Glory', desc:'The One whose glory fills the temple', ref:'2 Chronicles 7:1-3', type:'type'},
        'Ezra': {title:'The Faithful Scribe', desc:'The One who perfectly fulfills and teaches the Law', ref:'Ezra 7:10', type:'type'},
        'Nehemiah': {title:'The Rebuilder of Walls', desc:'The One who restores and protects His people', ref:'Nehemiah 2:17-18', type:'type'},
        'Esther': {title:'Our Advocate', desc:'The One who intercedes to save His people from destruction', ref:'Esther 4:14', type:'type'},
        'Job': {title:'The Living Redeemer', desc:'The One who lives and will stand upon the earth', ref:'Job 19:25', type:'prophecy'},
        'Psalms': {title:'The Suffering King', desc:'The Messiah who suffers, dies, and reigns forever', ref:'Psalm 22, 110', type:'prophecy'},
        'Proverbs': {title:'The Wisdom of God', desc:'Divine wisdom personified, present at creation', ref:'Proverbs 8:22-31', type:'type'},
        'Ecclesiastes': {title:'The Meaning of Life', desc:'The One who gives purpose beyond vanity', ref:'Ecclesiastes 12:13', type:'type'},
        'Song of Solomon': {title:'The Bridegroom', desc:'The lover who pursues His bride with passion', ref:'Song of Solomon 2:16', type:'type'},
        'Isaiah': {title:'The Suffering Servant', desc:'Born of a virgin, pierced for our transgressions', ref:'Isaiah 7:14, 53', type:'prophecy'},
        'Jeremiah': {title:'The Righteous Branch', desc:'The LORD our Righteousness who makes a new covenant', ref:'Jeremiah 23:5-6', type:'prophecy'},
        'Lamentations': {title:'The Man of Sorrows', desc:'The One acquainted with grief who weeps over Jerusalem', ref:'Lamentations 1:12', type:'type'},
        'Ezekiel': {title:'The Good Shepherd', desc:'The One who seeks and saves the lost sheep', ref:'Ezekiel 34:11-16', type:'prophecy'},
        'Daniel': {title:'The Son of Man', desc:'Coming on the clouds with eternal dominion', ref:'Daniel 7:13-14', type:'prophecy'},
        'Hosea': {title:'The Faithful Husband', desc:'The One who loves and redeems His unfaithful bride', ref:'Hosea 3:1-2', type:'type'},
        'Joel': {title:'The Baptizer in the Spirit', desc:'The One who pours out His Spirit on all flesh', ref:'Joel 2:28-29', type:'prophecy'},
        'Amos': {title:'The Restorer of David\'s Tent', desc:'The One who rebuilds and restores Israel', ref:'Amos 9:11', type:'prophecy'},
        'Obadiah': {title:'The Judge of Nations', desc:'The One who judges the proud and saves the humble', ref:'Obadiah 1:21', type:'type'},
        'Jonah': {title:'The Resurrected One', desc:'Three days in the grave, then raised to life', ref:'Jonah 1:17', type:'type'},
        'Micah': {title:'Born in Bethlehem', desc:'The ruler from ancient days, born in the city of David', ref:'Micah 5:2', type:'prophecy'},
        'Nahum': {title:'The Avenger', desc:'The One who takes vengeance on His enemies', ref:'Nahum 1:2', type:'type'},
        'Habakkuk': {title:'The Just One', desc:'The righteous One by whom we live by faith', ref:'Habakkuk 2:4', type:'prophecy'},
        'Zephaniah': {title:'The Mighty Savior', desc:'The warrior who rejoices over His people with singing', ref:'Zephaniah 3:17', type:'prophecy'},
        'Haggai': {title:'The Desire of Nations', desc:'The One who fills the temple with greater glory', ref:'Haggai 2:7', type:'prophecy'},
        'Zechariah': {title:'The Pierced One', desc:'The King who comes humbly, pierced for His people', ref:'Zechariah 9:9, 12:10', type:'prophecy'},
        'Malachi': {title:'The Sun of Righteousness', desc:'Rising with healing in His wings', ref:'Malachi 4:2', type:'prophecy'},
        // New Testament
        'Matthew': {title:'The King of the Jews', desc:'The promised Messiah, heir to David\'s throne', ref:'Matthew 2:2', type:'fulfillment'},
        'Mark': {title:'The Servant', desc:'The One who came not to be served but to serve', ref:'Mark 10:45', type:'fulfillment'},
        'Luke': {title:'The Son of Man', desc:'The perfect human who seeks and saves the lost', ref:'Luke 19:10', type:'fulfillment'},
        'John': {title:'The Son of God', desc:'The Word made flesh, full of grace and truth', ref:'John 1:14', type:'fulfillment'},
        'Acts': {title:'The Ascended Lord', desc:'Risen, ascended, and pouring out His Spirit', ref:'Acts 1:9, 2:33', type:'fulfillment'},
        'Romans': {title:'Our Righteousness', desc:'The One who justifies all who believe', ref:'Romans 3:22', type:'fulfillment'},
        '1 Corinthians': {title:'The Firstfruits', desc:'Risen from the dead, guaranteeing our resurrection', ref:'1 Corinthians 15:20', type:'fulfillment'},
        '2 Corinthians': {title:'Our Sufficiency', desc:'The One whose grace is sufficient in weakness', ref:'2 Corinthians 12:9', type:'fulfillment'},
        'Galatians': {title:'Our Liberator', desc:'The One who sets us free from the law of sin', ref:'Galatians 5:1', type:'fulfillment'},
        'Ephesians': {title:'Head of the Church', desc:'The One who fills all in all', ref:'Ephesians 1:22-23', type:'fulfillment'},
        'Philippians': {title:'Our Joy', desc:'The name above every name at which every knee will bow', ref:'Philippians 2:9-11', type:'fulfillment'},
        'Colossians': {title:'The Fullness of God', desc:'In Him all the fullness of deity dwells bodily', ref:'Colossians 2:9', type:'fulfillment'},
        '1 Thessalonians': {title:'The Coming One', desc:'Returning from heaven with a shout', ref:'1 Thessalonians 4:16', type:'fulfillment'},
        '2 Thessalonians': {title:'The Righteous Judge', desc:'Coming in blazing fire to judge and save', ref:'2 Thessalonians 1:7-8', type:'fulfillment'},
        '1 Timothy': {title:'The One Mediator', desc:'The man Christ Jesus who gave Himself for all', ref:'1 Timothy 2:5', type:'fulfillment'},
        '2 Timothy': {title:'The Righteous Judge', desc:'Who will award the crown of righteousness', ref:'2 Timothy 4:8', type:'fulfillment'},
        'Titus': {title:'Our Great God and Savior', desc:'The blessed hope who gave Himself to redeem us', ref:'Titus 2:13-14', type:'fulfillment'},
        'Philemon': {title:'Our Substitute', desc:'The One who pays our debt and reconciles us', ref:'Philemon 1:18-19', type:'fulfillment'},
        'Hebrews': {title:'Our Great High Priest', desc:'The mediator of a better covenant, once for all', ref:'Hebrews 4:14, 9:12', type:'fulfillment'},
        'James': {title:'The Lord of Glory', desc:'The coming Judge standing at the door', ref:'James 2:1, 5:9', type:'fulfillment'},
        '1 Peter': {title:'The Chief Shepherd', desc:'The living stone, precious cornerstone', ref:'1 Peter 2:6, 5:4', type:'fulfillment'},
        '2 Peter': {title:'The Morning Star', desc:'The One whose day is coming', ref:'2 Peter 1:19', type:'fulfillment'},
        '1 John': {title:'The Eternal Life', desc:'The Word of life, our advocate with the Father', ref:'1 John 1:1-2, 2:1', type:'fulfillment'},
        '2 John': {title:'The Truth', desc:'The Son of the Father in truth and love', ref:'2 John 1:3', type:'fulfillment'},
        '3 John': {title:'The Truth We Walk In', desc:'The One for whose name\'s sake we go out', ref:'3 John 1:7', type:'fulfillment'},
        'Jude': {title:'The Preserver', desc:'The One who keeps us from stumbling', ref:'Jude 1:24', type:'fulfillment'},
        'Revelation': {title:'The Alpha and Omega', desc:'The Lamb who was slain, the conquering King of Kings', ref:'Revelation 1:8, 19:16', type:'fulfillment'}
    };

    // Identity in Every Book - Who you are in Christ based on the book's theme
    const IDENTITY_IN_BOOK = {
        // Old Testament
        'Genesis': {type:'I AM', text:'Made in the image of God, created for dominion', ref:'Genesis 1:26-27'},
        'Exodus': {type:'I AM', text:'Delivered from bondage, set free by the blood', ref:'Exodus 12:13'},
        'Leviticus': {type:'I AM', text:'Holy, set apart for God\'s purposes', ref:'Leviticus 20:26'},
        'Numbers': {type:'I AM', text:'Counted among God\'s people, known by name', ref:'Numbers 1:2'},
        'Deuteronomy': {type:'I AM', text:'Chosen and loved by God above all peoples', ref:'Deuteronomy 7:6'},
        'Joshua': {type:'I AM', text:'Strong and courageous, inheriting God\'s promises', ref:'Joshua 1:9'},
        'Judges': {type:'I AM', text:'Called to rise up in my generation', ref:'Judges 2:16'},
        'Ruth': {type:'I AM', text:'Redeemed and brought into God\'s family', ref:'Ruth 4:14'},
        '1 Samuel': {type:'I AM', text:'Anointed by God for His purposes', ref:'1 Samuel 16:13'},
        '2 Samuel': {type:'I AM', text:'Established by God\'s covenant love', ref:'2 Samuel 7:16'},
        '1 Kings': {type:'I AM', text:'Given wisdom from above when I ask', ref:'1 Kings 3:12'},
        '2 Kings': {type:'I AM', text:'Protected by heavenly armies', ref:'2 Kings 6:17'},
        '1 Chronicles': {type:'I AM', text:'Part of God\'s eternal plan and lineage', ref:'1 Chronicles 17:14'},
        '2 Chronicles': {type:'I AM', text:'A dwelling place for God\'s glory', ref:'2 Chronicles 7:16'},
        'Ezra': {type:'I AM', text:'Restored and rebuilt by God\'s hand', ref:'Ezra 9:9'},
        'Nehemiah': {type:'I AM', text:'A builder of walls, filled with joy', ref:'Nehemiah 8:10'},
        'Esther': {type:'I AM', text:'Placed here for such a time as this', ref:'Esther 4:14'},
        'Job': {type:'I AM', text:'Confident that my Redeemer lives', ref:'Job 19:25'},
        'Psalms': {type:'I AM', text:'Fearfully and wonderfully made', ref:'Psalm 139:14'},
        'Proverbs': {type:'I AM', text:'Walking in wisdom from above', ref:'Proverbs 2:6'},
        'Ecclesiastes': {type:'I AM', text:'Created with eternity in my heart', ref:'Ecclesiastes 3:11'},
        'Song of Solomon': {type:'I AM', text:'Beloved, pursued with unfailing love', ref:'Song of Solomon 2:16'},
        'Isaiah': {type:'I AM', text:'Healed by His stripes, carried by His strength', ref:'Isaiah 53:5'},
        'Jeremiah': {type:'I AM', text:'Known by God before I was born', ref:'Jeremiah 1:5'},
        'Lamentations': {type:'I AM', text:'Receiving new mercies every morning', ref:'Lamentations 3:22-23'},
        'Ezekiel': {type:'I AM', text:'Given a new heart and new spirit', ref:'Ezekiel 36:26'},
        'Daniel': {type:'I AM', text:'Kept safe in the lion\'s den of life', ref:'Daniel 6:22'},
        'Hosea': {type:'I AM', text:'Loved unconditionally despite my failures', ref:'Hosea 3:1'},
        'Joel': {type:'I AM', text:'Filled with the Spirit of God', ref:'Joel 2:28'},
        'Amos': {type:'I AM', text:'Called to seek God and live', ref:'Amos 5:4'},
        'Obadiah': {type:'I AM', text:'Part of the kingdom that belongs to the Lord', ref:'Obadiah 1:21'},
        'Jonah': {type:'I AM', text:'Given second chances by a merciful God', ref:'Jonah 3:1'},
        'Micah': {type:'I AM', text:'Walking humbly with my God', ref:'Micah 6:8'},
        'Nahum': {type:'I AM', text:'Sheltered by a stronghold in trouble', ref:'Nahum 1:7'},
        'Habakkuk': {type:'I AM', text:'Living by faith, rejoicing in God', ref:'Habakkuk 2:4'},
        'Zephaniah': {type:'I AM', text:'Delighted over with singing by my God', ref:'Zephaniah 3:17'},
        'Haggai': {type:'I AM', text:'Called to build for God\'s glory', ref:'Haggai 2:4'},
        'Zechariah': {type:'I AM', text:'Protected as the apple of God\'s eye', ref:'Zechariah 2:8'},
        'Malachi': {type:'I AM', text:'Rising with healing in His wings', ref:'Malachi 4:2'},
        // New Testament
        'Matthew': {type:'I AM', text:'A citizen of the Kingdom of Heaven', ref:'Matthew 5:3'},
        'Mark': {type:'I AM', text:'Called to follow Jesus and fish for men', ref:'Mark 1:17'},
        'Luke': {type:'I AM', text:'Sought and saved by the Son of Man', ref:'Luke 19:10'},
        'John': {type:'I AM', text:'A child of God, born of the Spirit', ref:'John 1:12'},
        'Acts': {type:'I AM', text:'Empowered by the Holy Spirit as a witness', ref:'Acts 1:8'},
        'Romans': {type:'I AM', text:'Justified freely, more than a conqueror', ref:'Romans 8:37'},
        '1 Corinthians': {type:'I AM', text:'The temple of the Holy Spirit', ref:'1 Corinthians 6:19'},
        '2 Corinthians': {type:'I AM', text:'A new creation in Christ', ref:'2 Corinthians 5:17'},
        'Galatians': {type:'I AM', text:'Set free and no longer a slave', ref:'Galatians 5:1'},
        'Ephesians': {type:'I AM', text:'Blessed with every spiritual blessing', ref:'Ephesians 1:3'},
        'Philippians': {type:'I AM', text:'Able to do all things through Christ', ref:'Philippians 4:13'},
        'Colossians': {type:'I AM', text:'Complete in Christ, fully alive', ref:'Colossians 2:10'},
        '1 Thessalonians': {type:'I AM', text:'Chosen by God, loved and destined for salvation', ref:'1 Thessalonians 1:4'},
        '2 Thessalonians': {type:'I AM', text:'Standing firm, holding to the truth', ref:'2 Thessalonians 2:15'},
        '1 Timothy': {type:'I AM', text:'Called to fight the good fight of faith', ref:'1 Timothy 6:12'},
        '2 Timothy': {type:'I AM', text:'Not given a spirit of fear but of power', ref:'2 Timothy 1:7'},
        'Titus': {type:'I AM', text:'Redeemed and purified, eager to do good', ref:'Titus 2:14'},
        'Philemon': {type:'I AM', text:'No longer a slave but a beloved brother', ref:'Philemon 1:16'},
        'Hebrews': {type:'I AM', text:'Confident to enter God\'s presence boldly', ref:'Hebrews 4:16'},
        'James': {type:'I AM', text:'A doer of the Word, blessed in action', ref:'James 1:25'},
        '1 Peter': {type:'I AM', text:'A royal priesthood, a holy nation', ref:'1 Peter 2:9'},
        '2 Peter': {type:'I AM', text:'A partaker of the divine nature', ref:'2 Peter 1:4'},
        '1 John': {type:'I AM', text:'Loved by the Father, called a child of God', ref:'1 John 3:1'},
        '2 John': {type:'I AM', text:'Walking in truth and love', ref:'2 John 1:4'},
        '3 John': {type:'I AM', text:'Prospering in soul as I walk in truth', ref:'3 John 1:2'},
        'Jude': {type:'I AM', text:'Kept by Jesus Christ, called and loved', ref:'Jude 1:1'},
        'Revelation': {type:'I AM', text:'An overcomer who will reign with Christ', ref:'Revelation 3:21'}
    };

    // Historical Context for each book
    const BOOK_CONTEXT = {
        // Old Testament
        'Genesis': {author:'Moses', date:'~1450-1410 BC', audience:'Israel', setting:'Creation to Egypt', time:'~2,300 years of history'},
        'Exodus': {author:'Moses', date:'~1450-1410 BC', audience:'Israel', setting:'Egypt to Sinai', time:'~80 years'},
        'Leviticus': {author:'Moses', date:'~1445 BC', audience:'Priests & Israel', setting:'Mount Sinai', time:'~1 month'},
        'Numbers': {author:'Moses', date:'~1405 BC', audience:'Israel', setting:'Sinai to Moab', time:'~40 years'},
        'Deuteronomy': {author:'Moses', date:'~1405 BC', audience:'New generation', setting:'Plains of Moab', time:'~1 month'},
        'Joshua': {author:'Joshua', date:'~1390 BC', audience:'Israel', setting:'Canaan', time:'~25 years'},
        'Judges': {author:'Samuel (likely)', date:'~1050 BC', audience:'Israel', setting:'Canaan', time:'~350 years'},
        'Ruth': {author:'Unknown', date:'~1000 BC', audience:'Israel', setting:'Bethlehem', time:'~10 years'},
        '1 Samuel': {author:'Samuel, Nathan, Gad', date:'~930 BC', audience:'Israel', setting:'Israel', time:'~100 years'},
        '2 Samuel': {author:'Nathan, Gad', date:'~930 BC', audience:'Israel', setting:'Israel', time:'~40 years'},
        '1 Kings': {author:'Unknown (Jeremiah?)', date:'~560 BC', audience:'Exiles', setting:'Israel/Judah', time:'~120 years'},
        '2 Kings': {author:'Unknown (Jeremiah?)', date:'~560 BC', audience:'Exiles', setting:'Israel/Judah', time:'~270 years'},
        '1 Chronicles': {author:'Ezra (likely)', date:'~450 BC', audience:'Returned exiles', setting:'Israel', time:'Genealogies to David'},
        '2 Chronicles': {author:'Ezra (likely)', date:'~450 BC', audience:'Returned exiles', setting:'Judah', time:'~430 years'},
        'Ezra': {author:'Ezra', date:'~450 BC', audience:'Returned exiles', setting:'Jerusalem', time:'~80 years'},
        'Nehemiah': {author:'Nehemiah', date:'~430 BC', audience:'Returned exiles', setting:'Jerusalem', time:'~12 years'},
        'Esther': {author:'Unknown', date:'~470 BC', audience:'Jews in Persia', setting:'Susa, Persia', time:'~10 years'},
        'Job': {author:'Unknown', date:'Unknown (ancient)', audience:'Sufferers', setting:'Land of Uz', time:'Months'},
        'Psalms': {author:'David, Asaph, others', date:'~1000-400 BC', audience:'Israel', setting:'Various', time:'~600 years'},
        'Proverbs': {author:'Solomon, others', date:'~950-700 BC', audience:'Young men', setting:'Israel', time:'Wisdom collection'},
        'Ecclesiastes': {author:'Solomon', date:'~940 BC', audience:'All people', setting:'Jerusalem', time:'Life reflections'},
        'Song of Solomon': {author:'Solomon', date:'~960 BC', audience:'Married couples', setting:'Israel', time:'Courtship/marriage'},
        'Isaiah': {author:'Isaiah', date:'~700-680 BC', audience:'Judah', setting:'Jerusalem', time:'~60 years'},
        'Jeremiah': {author:'Jeremiah', date:'~627-580 BC', audience:'Judah', setting:'Jerusalem', time:'~40 years'},
        'Lamentations': {author:'Jeremiah', date:'~586 BC', audience:'Exiles', setting:'Jerusalem ruins', time:'After destruction'},
        'Ezekiel': {author:'Ezekiel', date:'~593-571 BC', audience:'Exiles in Babylon', setting:'Babylon', time:'~22 years'},
        'Daniel': {author:'Daniel', date:'~536 BC', audience:'Exiles', setting:'Babylon/Persia', time:'~70 years'},
        'Hosea': {author:'Hosea', date:'~750-715 BC', audience:'Israel (North)', setting:'Northern Kingdom', time:'~35 years'},
        'Joel': {author:'Joel', date:'~835 BC', audience:'Judah', setting:'Jerusalem', time:'Locust plague'},
        'Amos': {author:'Amos', date:'~760 BC', audience:'Israel (North)', setting:'Bethel', time:'~2 years'},
        'Obadiah': {author:'Obadiah', date:'~586 BC', audience:'Edom/Judah', setting:'After Jerusalem fell', time:'Brief oracle'},
        'Jonah': {author:'Jonah', date:'~780 BC', audience:'Israel', setting:'Nineveh', time:'Days'},
        'Micah': {author:'Micah', date:'~735-700 BC', audience:'Judah & Israel', setting:'Jerusalem', time:'~35 years'},
        'Nahum': {author:'Nahum', date:'~650 BC', audience:'Judah/Nineveh', setting:'Nineveh\'s fall', time:'Prophetic vision'},
        'Habakkuk': {author:'Habakkuk', date:'~609-605 BC', audience:'Judah', setting:'Before exile', time:'Dialog with God'},
        'Zephaniah': {author:'Zephaniah', date:'~635 BC', audience:'Judah', setting:'Jerusalem', time:'Josiah\'s reign'},
        'Haggai': {author:'Haggai', date:'~520 BC', audience:'Returned exiles', setting:'Jerusalem', time:'4 months'},
        'Zechariah': {author:'Zechariah', date:'~520-480 BC', audience:'Returned exiles', setting:'Jerusalem', time:'~40 years'},
        'Malachi': {author:'Malachi', date:'~430 BC', audience:'Post-exilic Jews', setting:'Jerusalem', time:'Last OT prophet'},
        // New Testament
        'Matthew': {author:'Matthew (Levi)', date:'~60-65 AD', audience:'Jews', setting:'Palestine', time:'Life of Christ'},
        'Mark': {author:'John Mark', date:'~55-65 AD', audience:'Romans', setting:'Palestine', time:'Life of Christ'},
        'Luke': {author:'Luke', date:'~60-62 AD', audience:'Theophilus/Gentiles', setting:'Palestine', time:'Life of Christ'},
        'John': {author:'John', date:'~85-90 AD', audience:'All believers', setting:'Palestine', time:'Life of Christ'},
        'Acts': {author:'Luke', date:'~62 AD', audience:'Theophilus/Church', setting:'Jerusalem to Rome', time:'~30 years'},
        'Romans': {author:'Paul', date:'~57 AD', audience:'Church in Rome', setting:'Written from Corinth', time:'Doctrinal letter'},
        '1 Corinthians': {author:'Paul', date:'~55 AD', audience:'Church in Corinth', setting:'Written from Ephesus', time:'Church issues'},
        '2 Corinthians': {author:'Paul', date:'~56 AD', audience:'Church in Corinth', setting:'Written from Macedonia', time:'Defense of ministry'},
        'Galatians': {author:'Paul', date:'~49 AD', audience:'Churches in Galatia', setting:'Written from Antioch', time:'Faith vs. Law'},
        'Ephesians': {author:'Paul', date:'~60-62 AD', audience:'Church in Ephesus', setting:'Written from prison', time:'Identity in Christ'},
        'Philippians': {author:'Paul', date:'~61 AD', audience:'Church in Philippi', setting:'Written from prison', time:'Letter of joy'},
        'Colossians': {author:'Paul', date:'~60-62 AD', audience:'Church in Colossae', setting:'Written from prison', time:'Christ\'s supremacy'},
        '1 Thessalonians': {author:'Paul', date:'~51 AD', audience:'Church in Thessalonica', setting:'Written from Corinth', time:'Christ\'s return'},
        '2 Thessalonians': {author:'Paul', date:'~51-52 AD', audience:'Church in Thessalonica', setting:'Written from Corinth', time:'End times'},
        '1 Timothy': {author:'Paul', date:'~64 AD', audience:'Timothy', setting:'Written from Macedonia', time:'Pastoral advice'},
        '2 Timothy': {author:'Paul', date:'~67 AD', audience:'Timothy', setting:'Written from prison', time:'Final letter'},
        'Titus': {author:'Paul', date:'~64 AD', audience:'Titus', setting:'Written from unknown', time:'Church leadership'},
        'Philemon': {author:'Paul', date:'~60-62 AD', audience:'Philemon', setting:'Written from prison', time:'Personal letter'},
        'Hebrews': {author:'Unknown', date:'~68 AD', audience:'Jewish Christians', setting:'Before temple fell', time:'Christ > Old Covenant'},
        'James': {author:'James (brother of Jesus)', date:'~45-49 AD', audience:'Jewish Christians', setting:'Jerusalem', time:'Practical faith'},
        '1 Peter': {author:'Peter', date:'~64 AD', audience:'Scattered believers', setting:'Written from Rome', time:'Suffering well'},
        '2 Peter': {author:'Peter', date:'~67 AD', audience:'All believers', setting:'Before Peter\'s death', time:'False teachers'},
        '1 John': {author:'John', date:'~90 AD', audience:'Churches in Asia', setting:'Written from Ephesus', time:'Truth & love'},
        '2 John': {author:'John', date:'~90 AD', audience:'Chosen lady/church', setting:'Written from Ephesus', time:'Brief letter'},
        '3 John': {author:'John', date:'~90 AD', audience:'Gaius', setting:'Written from Ephesus', time:'Brief letter'},
        'Jude': {author:'Jude (brother of Jesus)', date:'~68 AD', audience:'All believers', setting:'Unknown', time:'Contend for faith'},
        'Revelation': {author:'John', date:'~95 AD', audience:'7 churches in Asia', setting:'Isle of Patmos', time:'Prophetic vision'}
    };

    // Key verses for each book
    const KEY_VERSES = {
        'Genesis': {ch:1, v:1, text:'In the beginning God created the heavens and the earth.'},
        'Exodus': {ch:14, v:14, text:'Jehovah will fight for you, and ye shall hold your peace.'},
        'Leviticus': {ch:19, v:2, text:'Ye shall be holy; for I Jehovah your God am holy.'},
        'Numbers': {ch:6, v:24, text:'Jehovah bless thee, and keep thee.'},
        'Deuteronomy': {ch:6, v:5, text:'Thou shalt love Jehovah thy God with all thy heart.'},
        'Joshua': {ch:1, v:9, text:'Be strong and of good courage; be not affrighted.'},
        'Judges': {ch:21, v:25, text:'Every man did that which was right in his own eyes.'},
        'Ruth': {ch:1, v:16, text:'Whither thou goest, I will go; thy God my God.'},
        '1 Samuel': {ch:16, v:7, text:'Man looketh on the outward appearance, but Jehovah looketh on the heart.'},
        '2 Samuel': {ch:22, v:2, text:'Jehovah is my rock, and my fortress, and my deliverer.'},
        '1 Kings': {ch:18, v:21, text:'If Jehovah be God, follow him; but if Baal, then follow him.'},
        '2 Kings': {ch:6, v:16, text:'Fear not; for they that are with us are more than they that are with them.'},
        '1 Chronicles': {ch:29, v:11, text:'Thine, O Jehovah, is the greatness, and the power, and the glory.'},
        '2 Chronicles': {ch:7, v:14, text:'If my people humble themselves and pray... I will heal their land.'},
        'Ezra': {ch:7, v:10, text:'Ezra had set his heart to seek the law of Jehovah.'},
        'Nehemiah': {ch:8, v:10, text:'The joy of Jehovah is your strength.'},
        'Esther': {ch:4, v:14, text:'Who knoweth whether thou art not come to the kingdom for such a time as this?'},
        'Job': {ch:19, v:25, text:'I know that my Redeemer liveth.'},
        'Psalms': {ch:23, v:1, text:'Jehovah is my shepherd; I shall not want.'},
        'Proverbs': {ch:3, v:5, text:'Trust in Jehovah with all thy heart.'},
        'Ecclesiastes': {ch:12, v:13, text:'Fear God, and keep his commandments; for this is the whole duty of man.'},
        'Song of Solomon': {ch:8, v:7, text:'Many waters cannot quench love.'},
        'Isaiah': {ch:40, v:31, text:'They that wait for Jehovah shall renew their strength.'},
        'Jeremiah': {ch:29, v:11, text:'For I know the plans I have for you, declares Jehovah.'},
        'Lamentations': {ch:3, v:22, text:'His mercies are new every morning; great is thy faithfulness.'},
        'Ezekiel': {ch:36, v:26, text:'A new heart also will I give you.'},
        'Daniel': {ch:3, v:17, text:'Our God whom we serve is able to deliver us.'},
        'Hosea': {ch:6, v:6, text:'I desire mercy, and not sacrifice.'},
        'Joel': {ch:2, v:28, text:'I will pour out my Spirit upon all flesh.'},
        'Amos': {ch:5, v:24, text:'Let justice roll down as waters, and righteousness as a mighty stream.'},
        'Obadiah': {ch:1, v:15, text:'The day of Jehovah is near upon all nations.'},
        'Jonah': {ch:2, v:9, text:'Salvation is of Jehovah.'},
        'Micah': {ch:6, v:8, text:'Do justly, love kindness, and walk humbly with thy God.'},
        'Nahum': {ch:1, v:7, text:'Jehovah is good, a stronghold in the day of trouble.'},
        'Habakkuk': {ch:2, v:4, text:'The righteous shall live by his faith.'},
        'Zephaniah': {ch:3, v:17, text:'He will rejoice over thee with singing.'},
        'Haggai': {ch:2, v:9, text:'The latter glory of this house shall be greater than the former.'},
        'Zechariah': {ch:4, v:6, text:'Not by might, nor by power, but by my Spirit.'},
        'Malachi': {ch:3, v:10, text:'Bring ye the whole tithe... I will pour you out a blessing.'},
        'Matthew': {ch:6, v:33, text:'Seek ye first his kingdom, and his righteousness.'},
        'Mark': {ch:10, v:45, text:'The Son of man came to serve, and to give his life a ransom.'},
        'Luke': {ch:19, v:10, text:'The Son of man came to seek and to save that which was lost.'},
        'John': {ch:3, v:16, text:'For God so loved the world, that he gave his only begotten Son.'},
        'Acts': {ch:1, v:8, text:'Ye shall receive power, when the Holy Spirit is come upon you.'},
        'Romans': {ch:8, v:28, text:'All things work together for good to them that love God.'},
        '1 Corinthians': {ch:13, v:13, text:'Now abideth faith, hope, love, these three; but the greatest is love.'},
        '2 Corinthians': {ch:5, v:17, text:'If any man is in Christ, he is a new creature.'},
        'Galatians': {ch:2, v:20, text:'I have been crucified with Christ; Christ liveth in me.'},
        'Ephesians': {ch:2, v:8, text:'By grace have ye been saved through faith.'},
        'Philippians': {ch:4, v:13, text:'I can do all things in him that strengtheneth me.'},
        'Colossians': {ch:3, v:2, text:'Set your mind on the things that are above.'},
        '1 Thessalonians': {ch:5, v:18, text:'In everything give thanks.'},
        '2 Thessalonians': {ch:3, v:3, text:'The Lord is faithful, who shall establish you.'},
        '1 Timothy': {ch:6, v:12, text:'Fight the good fight of the faith.'},
        '2 Timothy': {ch:1, v:7, text:'God gave us not a spirit of fear, but of power and love.'},
        'Titus': {ch:2, v:11, text:'The grace of God hath appeared, bringing salvation to all men.'},
        'Philemon': {ch:1, v:6, text:'The fellowship of thy faith may become effectual.'},
        'Hebrews': {ch:11, v:1, text:'Faith is the substance of things hoped for.'},
        'James': {ch:1, v:22, text:'Be ye doers of the word, and not hearers only.'},
        '1 Peter': {ch:5, v:7, text:'Casting all your anxiety upon him, because he careth for you.'},
        '2 Peter': {ch:3, v:9, text:'The Lord is not slow concerning his promise.'},
        '1 John': {ch:4, v:4, text:'Greater is he that is in you than he that is in the world.'},
        '2 John': {ch:1, v:6, text:'This is love, that we should walk after his commandments.'},
        '3 John': {ch:1, v:4, text:'I have no greater joy than this, to hear of my children walking in the truth.'},
        'Jude': {ch:1, v:24, text:'Now unto him that is able to guard you from stumbling.'},
        'Revelation': {ch:21, v:4, text:'He shall wipe away every tear from their eyes.'}
    };

    // Book Introductions - Purpose, Outline, Key Themes
    const BOOK_INTROS = {
        'Genesis': {
            purpose: 'Records the origins of the universe, humanity, sin, and God\'s plan of redemption through Abraham\'s family.',
            outline: ['Creation & Fall (1-11)', 'Abraham (12-25)', 'Isaac & Jacob (26-36)', 'Joseph (37-50)'],
            themes: ['Creation', 'Covenant', 'Sin & Redemption', 'Faith']
        },
        'Exodus': {
            purpose: 'Tells how God delivered Israel from slavery in Egypt and established His covenant with them at Sinai.',
            outline: ['Bondage in Egypt (1-12)', 'Journey to Sinai (13-18)', 'Law & Tabernacle (19-40)'],
            themes: ['Deliverance', 'Covenant', 'God\'s Presence', 'Worship']
        },
        'Leviticus': {
            purpose: 'Provides instructions for worship, sacrifices, and holy living so Israel could dwell with a holy God.',
            outline: ['Sacrifices (1-7)', 'Priesthood (8-10)', 'Purity Laws (11-15)', 'Day of Atonement (16-17)', 'Holy Living (18-27)'],
            themes: ['Holiness', 'Sacrifice', 'Atonement', 'Priesthood']
        },
        'Numbers': {
            purpose: 'Chronicles Israel\'s 40-year wilderness journey, showing both God\'s faithfulness and the consequences of unbelief.',
            outline: ['At Sinai (1-10)', 'Wilderness Wandering (11-21)', 'Plains of Moab (22-36)'],
            themes: ['Faithfulness', 'Discipline', 'God\'s Provision', 'Consequences of Sin']
        },
        'Deuteronomy': {
            purpose: 'Moses\' farewell speeches to the new generation, reviewing the Law and preparing them to enter the Promised Land.',
            outline: ['Historical Review (1-4)', 'The Law Restated (5-26)', 'Blessings & Curses (27-30)', 'Transition to Joshua (31-34)'],
            themes: ['Obedience', 'Love for God', 'Remember', 'Choose Life']
        },
        'Joshua': {
            purpose: 'Records Israel\'s conquest and settlement of the Promised Land under Joshua\'s leadership.',
            outline: ['Entering Canaan (1-5)', 'Conquering the Land (6-12)', 'Dividing the Land (13-21)', 'Farewell & Covenant (22-24)'],
            themes: ['Faith & Courage', 'God\'s Promises', 'Victory', 'Obedience']
        },
        'Judges': {
            purpose: 'Describes the cycle of sin, oppression, and deliverance during the dark period before Israel\'s monarchy.',
            outline: ['Introduction (1-2)', 'The Judges (3-16)', 'Moral Decline (17-21)'],
            themes: ['Cycle of Sin', 'God\'s Mercy', 'Leadership', 'Moral Relativism']
        },
        'Ruth': {
            purpose: 'A beautiful story of loyalty and redemption showing God\'s providence and the lineage of David and Christ.',
            outline: ['Tragedy in Moab (1)', 'Ruth Meets Boaz (2)', 'Ruth\'s Appeal (3)', 'Redemption & Marriage (4)'],
            themes: ['Loyalty', 'Redemption', 'Providence', 'Grace to Gentiles']
        },
        '1 Samuel': {
            purpose: 'Transitions Israel from judges to monarchy, featuring Samuel, Saul, and David\'s rise.',
            outline: ['Samuel (1-7)', 'King Saul (8-15)', 'David\'s Rise (16-31)'],
            themes: ['Leadership', 'Obedience', 'Heart vs. Appearance', 'God\'s Sovereignty']
        },
        '2 Samuel': {
            purpose: 'Records David\'s reign as king, his triumphs, failures, and God\'s covenant with his dynasty.',
            outline: ['David as King (1-10)', 'David\'s Sin & Consequences (11-20)', 'Final Events (21-24)'],
            themes: ['Covenant', 'Consequences of Sin', 'Grace', 'Kingdom']
        },
        '1 Kings': {
            purpose: 'Chronicles Solomon\'s reign, the divided kingdom, and Elijah\'s prophetic ministry.',
            outline: ['Solomon\'s Reign (1-11)', 'Divided Kingdom (12-16)', 'Elijah (17-22)'],
            themes: ['Wisdom', 'Temple', 'Idolatry', 'Prophetic Voice']
        },
        '2 Kings': {
            purpose: 'Continues the history of the divided kingdom through the exile of both Israel and Judah.',
            outline: ['Elisha (1-8)', 'Israel\'s Fall (9-17)', 'Judah Alone (18-25)'],
            themes: ['Judgment', 'Faithfulness', 'Prophets', 'Exile']
        },
        '1 Chronicles': {
            purpose: 'Retells Israel\'s history from a priestly perspective, emphasizing David and temple worship.',
            outline: ['Genealogies (1-9)', 'David\'s Reign (10-29)'],
            themes: ['Worship', 'Davidic Line', 'Temple Preparations', 'God\'s Faithfulness']
        },
        '2 Chronicles': {
            purpose: 'Continues with Solomon\'s temple and Judah\'s kings, emphasizing worship and reformation.',
            outline: ['Solomon & Temple (1-9)', 'Kings of Judah (10-36)'],
            themes: ['Temple Worship', 'Revival', 'Faithfulness', 'Prayer']
        },
        'Ezra': {
            purpose: 'Records the return from Babylonian exile and the rebuilding of the temple under Zerubbabel and Ezra.',
            outline: ['First Return & Temple (1-6)', 'Ezra\'s Return & Reform (7-10)'],
            themes: ['Restoration', 'God\'s Word', 'Purity', 'Prayer']
        },
        'Nehemiah': {
            purpose: 'Tells of Nehemiah\'s leadership in rebuilding Jerusalem\'s walls and reforming the people.',
            outline: ['Rebuilding Walls (1-7)', 'Revival & Reform (8-13)'],
            themes: ['Leadership', 'Prayer', 'Perseverance', 'Restoration']
        },
        'Esther': {
            purpose: 'Shows God\'s hidden providence in protecting His people from destruction in Persia.',
            outline: ['Esther Becomes Queen (1-2)', 'Haman\'s Plot (3-5)', 'Deliverance (6-10)'],
            themes: ['Providence', 'Courage', 'Reversal', 'God\'s Unseen Hand']
        },
        'Job': {
            purpose: 'Explores the question of why the righteous suffer through Job\'s experience and God\'s response.',
            outline: ['Job\'s Trials (1-2)', 'Debates with Friends (3-37)', 'God Speaks (38-41)', 'Restoration (42)'],
            themes: ['Suffering', 'Sovereignty', 'Faith', 'God\'s Wisdom']
        },
        'Psalms': {
            purpose: 'Israel\'s songbook expressing the full range of human emotion in worship and prayer to God.',
            outline: ['Book I (1-41)', 'Book II (42-72)', 'Book III (73-89)', 'Book IV (90-106)', 'Book V (107-150)'],
            themes: ['Worship', 'Lament', 'Thanksgiving', 'Messianic Hope']
        },
        'Proverbs': {
            purpose: 'Practical wisdom for daily living, teaching how to live skillfully in God\'s world.',
            outline: ['Introduction to Wisdom (1-9)', 'Solomon\'s Proverbs (10-22)', 'Sayings of Wise (22-24)', 'More Proverbs (25-31)'],
            themes: ['Wisdom', 'Fear of the Lord', 'Discipline', 'Relationships']
        },
        'Ecclesiastes': {
            purpose: 'Explores the meaning of life "under the sun" and concludes that fearing God is what matters.',
            outline: ['The Quest for Meaning (1-2)', 'Time & Injustice (3-6)', 'Wisdom for Living (7-12)'],
            themes: ['Meaning of Life', 'Vanity', 'Fear God', 'Enjoy Life']
        },
        'Song of Solomon': {
            purpose: 'Celebrates the beauty of romantic love, pointing to Christ\'s love for His bride.',
            outline: ['Courtship (1-3)', 'Wedding (4-5)', 'Maturing Love (6-8)'],
            themes: ['Love', 'Beauty', 'Commitment', 'Intimacy']
        },
        'Isaiah': {
            purpose: 'The "Gospel Prophet" proclaims both judgment and hope, with stunning Messianic prophecies.',
            outline: ['Judgment (1-39)', 'Comfort & Restoration (40-55)', 'Future Glory (56-66)'],
            themes: ['Holiness', 'Judgment', 'Messiah', 'Salvation']
        },
        'Jeremiah': {
            purpose: 'The "Weeping Prophet" warns Judah of coming judgment while promising a new covenant.',
            outline: ['Call & Warnings (1-25)', 'Conflict & Suffering (26-45)', 'Judgments on Nations (46-52)'],
            themes: ['Repentance', 'New Covenant', 'Judgment', 'Faithfulness']
        },
        'Lamentations': {
            purpose: 'Jeremiah\'s heartbroken poems mourning Jerusalem\'s destruction while affirming God\'s faithfulness.',
            outline: ['Jerusalem\'s Misery (1)', 'God\'s Anger (2)', 'Hope in Affliction (3)', 'Siege Horrors (4)', 'Prayer (5)'],
            themes: ['Grief', 'God\'s Faithfulness', 'Hope', 'Consequences of Sin']
        },
        'Ezekiel': {
            purpose: 'Prophesies to the exiles in Babylon about judgment, restoration, and God\'s glory returning.',
            outline: ['Ezekiel\'s Call (1-3)', 'Judgment on Judah (4-24)', 'Judgment on Nations (25-32)', 'Restoration (33-48)'],
            themes: ['God\'s Glory', 'Judgment', 'New Heart', 'Restoration']
        },
        'Daniel': {
            purpose: 'Stories of faithfulness in exile and apocalyptic visions of God\'s sovereign plan for history.',
            outline: ['Court Tales (1-6)', 'Apocalyptic Visions (7-12)'],
            themes: ['Faithfulness', 'God\'s Sovereignty', 'Kingdoms', 'End Times']
        },
        'Hosea': {
            purpose: 'God\'s faithful love for unfaithful Israel, illustrated through Hosea\'s marriage.',
            outline: ['Hosea\'s Marriage (1-3)', 'Israel\'s Unfaithfulness (4-13)', 'Restoration (14)'],
            themes: ['Faithful Love', 'Unfaithfulness', 'Judgment', 'Restoration']
        },
        'Joel': {
            purpose: 'Calls Judah to repentance through a locust plague, promising the Spirit\'s outpouring.',
            outline: ['The Locust Plague (1)', 'Call to Repentance (2:1-17)', 'God\'s Response (2:18-3:21)'],
            themes: ['Repentance', 'Day of the Lord', 'Holy Spirit', 'Restoration']
        },
        'Amos': {
            purpose: 'A shepherd-prophet condemns social injustice and religious hypocrisy in prosperous Israel.',
            outline: ['Judgments on Nations (1-2)', 'Oracles Against Israel (3-6)', 'Visions (7-9)'],
            themes: ['Justice', 'Social Righteousness', 'Judgment', 'Remnant']
        },
        'Obadiah': {
            purpose: 'The shortest OT book pronounces judgment on Edom for violence against Judah.',
            outline: ['Edom\'s Judgment (1-14)', 'Day of the Lord (15-21)'],
            themes: ['Judgment', 'Pride', 'Brotherhood', 'God\'s Kingdom']
        },
        'Jonah': {
            purpose: 'Shows God\'s compassion for all nations through a reluctant prophet sent to Nineveh.',
            outline: ['Fleeing from God (1-2)', 'Preaching to Nineveh (3-4)'],
            themes: ['God\'s Compassion', 'Obedience', 'Repentance', 'Second Chances']
        },
        'Micah': {
            purpose: 'Predicts judgment and hope, including the Messiah\'s birth in Bethlehem.',
            outline: ['Judgment Coming (1-2)', 'Future Hope (3-5)', 'God\'s Case Against Israel (6-7)'],
            themes: ['Justice', 'Mercy', 'Humility', 'Messianic Hope']
        },
        'Nahum': {
            purpose: 'Announces Nineveh\'s destruction, showing God\'s justice against oppressive nations.',
            outline: ['God\'s Majesty in Judgment (1)', 'Nineveh\'s Fall Described (2-3)'],
            themes: ['God\'s Justice', 'Judgment on Evil', 'Divine Warrior', 'Comfort for Oppressed']
        },
        'Habakkuk': {
            purpose: 'A prophet\'s dialog with God about evil, learning to trust God\'s sovereign plan.',
            outline: ['First Complaint (1:1-11)', 'Second Complaint (1:12-2:20)', 'Prayer of Faith (3)'],
            themes: ['Faith', 'God\'s Sovereignty', 'Trusting God', 'Justice']
        },
        'Zephaniah': {
            purpose: 'Warns of the coming Day of the Lord while promising restoration for the humble.',
            outline: ['Judgment on Judah (1)', 'Judgment on Nations (2)', 'Jerusalem\'s Future (3)'],
            themes: ['Day of the Lord', 'Judgment', 'Remnant', 'Joy']
        },
        'Haggai': {
            purpose: 'Encourages the returned exiles to finish rebuilding the temple and prioritize God.',
            outline: ['Call to Build (1)', 'Future Glory (2)'],
            themes: ['Priorities', 'Obedience', 'God\'s Presence', 'Future Glory']
        },
        'Zechariah': {
            purpose: 'Visions and prophecies encouraging temple rebuilding with rich Messianic imagery.',
            outline: ['Night Visions (1-6)', 'Questions About Fasting (7-8)', 'Future Prophecies (9-14)'],
            themes: ['Messiah', 'Restoration', 'God\'s Spirit', 'End Times']
        },
        'Malachi': {
            purpose: 'The final OT prophet rebukes Israel\'s spiritual apathy and points to the coming Messiah.',
            outline: ['God\'s Love Questioned (1)', 'Priests Rebuked (2)', 'Messenger Coming (3-4)'],
            themes: ['Honor God', 'Faithfulness', 'Tithing', 'Coming Messiah']
        },
        'Matthew': {
            purpose: 'Presents Jesus as the promised Messiah and King of the Jews, fulfilling OT prophecy.',
            outline: ['Birth & Preparation (1-4)', 'Sermon on the Mount (5-7)', 'Miracles & Ministry (8-20)', 'Passion & Resurrection (21-28)'],
            themes: ['Kingdom of Heaven', 'Fulfilled Prophecy', 'Discipleship', 'King Jesus']
        },
        'Mark': {
            purpose: 'The action-packed Gospel showing Jesus as the Suffering Servant who came to serve.',
            outline: ['Galilean Ministry (1-9)', 'Journey to Jerusalem (10)', 'Passion Week (11-16)'],
            themes: ['Servant', 'Immediately', 'Suffering', 'Discipleship']
        },
        'Luke': {
            purpose: 'The most comprehensive Gospel, emphasizing Jesus\' compassion for all people.',
            outline: ['Birth Narratives (1-2)', 'Galilean Ministry (3-9)', 'Journey to Jerusalem (10-19)', 'Passion & Resurrection (20-24)'],
            themes: ['Son of Man', 'Compassion', 'Prayer', 'Holy Spirit']
        },
        'John': {
            purpose: 'Written so readers may believe Jesus is the Christ, the Son of God, and have life.',
            outline: ['Prologue (1)', 'Book of Signs (2-12)', 'Book of Glory (13-21)'],
            themes: ['Believe', 'Life', 'I AM Statements', 'Love']
        },
        'Acts': {
            purpose: 'Records the Spirit-empowered spread of the church from Jerusalem to Rome.',
            outline: ['Jerusalem Church (1-7)', 'Expansion (8-12)', 'Paul\'s Missions (13-28)'],
            themes: ['Holy Spirit', 'Witness', 'Church Growth', 'Gospel to All']
        },
        'Romans': {
            purpose: 'Paul\'s masterpiece explaining the Gospel of salvation by grace through faith.',
            outline: ['Sin & Judgment (1-3)', 'Justification (4-5)', 'Sanctification (6-8)', 'Israel (9-11)', 'Practical Living (12-16)'],
            themes: ['Gospel', 'Justification', 'Grace', 'Faith']
        },
        '1 Corinthians': {
            purpose: 'Addresses divisions and moral issues in the Corinthian church with apostolic authority.',
            outline: ['Divisions (1-4)', 'Moral Issues (5-6)', 'Marriage & Worship (7-14)', 'Resurrection (15-16)'],
            themes: ['Unity', 'Spiritual Gifts', 'Love', 'Resurrection']
        },
        '2 Corinthians': {
            purpose: 'Paul\'s most personal letter, defending his ministry and teaching on new covenant.',
            outline: ['Paul\'s Ministry (1-7)', 'Giving (8-9)', 'Apostolic Defense (10-13)'],
            themes: ['Comfort', 'New Covenant', 'Weakness & Power', 'Generosity']
        },
        'Galatians': {
            purpose: 'Defends justification by faith alone against those adding works to the Gospel.',
            outline: ['Paul\'s Authority (1-2)', 'Justification by Faith (3-4)', 'Freedom in Christ (5-6)'],
            themes: ['Freedom', 'Grace vs. Law', 'Faith', 'Spirit vs. Flesh']
        },
        'Ephesians': {
            purpose: 'Explains our identity in Christ and how to live as the united body of Christ.',
            outline: ['Our Identity in Christ (1-3)', 'Our Walk in Christ (4-6)'],
            themes: ['In Christ', 'Grace', 'Unity', 'Spiritual Warfare']
        },
        'Philippians': {
            purpose: 'A joyful letter from prison teaching contentment and Christ-centered living.',
            outline: ['Joy in Suffering (1)', 'Joy in Service (2)', 'Joy in Christ (3)', 'Joy in Contentment (4)'],
            themes: ['Joy', 'Humility', 'Contentment', 'Press On']
        },
        'Colossians': {
            purpose: 'Proclaims Christ\'s supremacy over all creation and all spiritual powers.',
            outline: ['Christ\'s Supremacy (1-2)', 'New Life in Christ (3-4)'],
            themes: ['Christ Supreme', 'Fullness', 'New Life', 'Warning Against Error']
        },
        '1 Thessalonians': {
            purpose: 'Encourages a young church and clarifies questions about Christ\'s return.',
            outline: ['Thanksgiving (1-3)', 'Instructions (4-5)'],
            themes: ['Faith, Love, Hope', 'Christ\'s Return', 'Holy Living', 'Encouragement']
        },
        '2 Thessalonians': {
            purpose: 'Corrects misunderstandings about the Day of the Lord and idleness.',
            outline: ['Comfort in Persecution (1)', 'Day of the Lord (2)', 'Warning Against Idleness (3)'],
            themes: ['Persecution', 'End Times', 'Work', 'Faithfulness']
        },
        '1 Timothy': {
            purpose: 'Instructions to young Timothy on church leadership and sound doctrine.',
            outline: ['Sound Doctrine (1)', 'Worship & Leadership (2-3)', 'Personal Charge (4-6)'],
            themes: ['Sound Doctrine', 'Leadership', 'Godliness', 'Fight the Good Fight']
        },
        '2 Timothy': {
            purpose: 'Paul\'s final letter, urging Timothy to persevere in ministry and guard the Gospel.',
            outline: ['Guard the Gospel (1-2)', 'Difficult Times (3)', 'Final Charge (4)'],
            themes: ['Perseverance', 'Scripture', 'Finish Well', 'Faithfulness']
        },
        'Titus': {
            purpose: 'Instructions for organizing churches in Crete and living out sound doctrine.',
            outline: ['Church Leadership (1)', 'Sound Doctrine & Living (2-3)'],
            themes: ['Good Works', 'Sound Doctrine', 'Grace', 'Leadership']
        },
        'Philemon': {
            purpose: 'A personal appeal for the slave Onesimus, showing reconciliation in Christ.',
            outline: ['Greeting (1-3)', 'Thanksgiving (4-7)', 'Appeal for Onesimus (8-22)', 'Closing (23-25)'],
            themes: ['Forgiveness', 'Reconciliation', 'New Identity', 'Christian Brotherhood']
        },
        'Hebrews': {
            purpose: 'Demonstrates Christ\'s superiority over the old covenant, urging perseverance.',
            outline: ['Christ Superior (1-7)', 'New Covenant Superior (8-10)', 'Faith & Endurance (11-13)'],
            themes: ['Christ Superior', 'New Covenant', 'Faith', 'Perseverance']
        },
        'James': {
            purpose: 'Practical wisdom showing that genuine faith produces good works.',
            outline: ['Trials & Temptation (1)', 'Faith & Works (2)', 'Tongue & Wisdom (3)', 'Humility & Patience (4-5)'],
            themes: ['Faith & Works', 'Wisdom', 'Tongue', 'Patience']
        },
        '1 Peter': {
            purpose: 'Encourages suffering believers with hope and instructions for holy living.',
            outline: ['Living Hope (1)', 'Holy Living (2-3)', 'Suffering Well (4-5)'],
            themes: ['Hope', 'Suffering', 'Holiness', 'Submission']
        },
        '2 Peter': {
            purpose: 'Warns against false teachers and reminds believers of Christ\'s certain return.',
            outline: ['Grow in Christ (1)', 'False Teachers (2)', 'Day of the Lord (3)'],
            themes: ['Knowledge', 'False Teachers', 'Christ\'s Return', 'Growth']
        },
        '1 John': {
            purpose: 'Tests for genuine faith: belief in Christ, obedience, and love for others.',
            outline: ['Walk in Light (1-2)', 'Children of God (3)', 'Test the Spirits (4)', 'Assurance (5)'],
            themes: ['Fellowship', 'Love', 'Truth', 'Assurance']
        },
        '2 John': {
            purpose: 'Brief letter warning against false teachers who deny Christ came in the flesh.',
            outline: ['Walk in Truth & Love (1-6)', 'Warning About Deceivers (7-13)'],
            themes: ['Truth', 'Love', 'Discernment', 'Hospitality']
        },
        '3 John': {
            purpose: 'Commends hospitality to traveling ministers and rebukes divisive Diotrephes.',
            outline: ['Commendation of Gaius (1-8)', 'Rebuke of Diotrephes (9-10)', 'Praise for Demetrius (11-14)'],
            themes: ['Hospitality', 'Truth', 'Good vs. Evil', 'Support Ministry']
        },
        'Jude': {
            purpose: 'Urgently warns against false teachers who have infiltrated the church.',
            outline: ['Warning Against False Teachers (1-16)', 'Exhortation to Believers (17-25)'],
            themes: ['Contend for Faith', 'False Teachers', 'Judgment', 'Perseverance']
        },
        'Revelation': {
            purpose: 'Apocalyptic vision of Christ\'s ultimate victory and the new heaven and earth.',
            outline: ['Letters to Churches (1-3)', 'Heavenly Throne (4-5)', 'Judgments (6-18)', 'Christ\'s Return & New Creation (19-22)'],
            themes: ['Christ Victorious', 'Worship', 'Judgment', 'New Creation']
        }
    };

    // Topical Index - Verses organized by topic
    const TOPICAL_INDEX = {
        'Faith': [
            {ref:'Hebrews 11:1', text:'Faith is the substance of things hoped for.'},
            {ref:'Romans 10:17', text:'Faith comes by hearing the word of God.'},
            {ref:'Habakkuk 2:4', text:'The righteous shall live by faith.'},
            {ref:'Mark 11:22-24', text:'Have faith in God.'},
            {ref:'James 2:17', text:'Faith without works is dead.'},
            {ref:'Ephesians 2:8', text:'By grace through faith you are saved.'},
            {ref:'Hebrews 11:6', text:'Without faith it is impossible to please God.'},
            {ref:'Matthew 17:20', text:'Faith as a mustard seed can move mountains.'}
        ],
        'Fear & Anxiety': [
            {ref:'Isaiah 41:10', text:'Fear not, for I am with you.'},
            {ref:'2 Timothy 1:7', text:'God gave us not a spirit of fear.'},
            {ref:'Philippians 4:6-7', text:'Be anxious for nothing, but pray.'},
            {ref:'Psalm 23:4', text:'I will fear no evil, for you are with me.'},
            {ref:'1 Peter 5:7', text:'Cast all your anxiety on him.'},
            {ref:'Joshua 1:9', text:'Be strong and courageous.'},
            {ref:'Psalm 56:3', text:'When I am afraid, I will trust in you.'},
            {ref:'Matthew 6:34', text:'Do not worry about tomorrow.'}
        ],
        'Love': [
            {ref:'1 Corinthians 13:4-7', text:'Love is patient, love is kind.'},
            {ref:'John 3:16', text:'God so loved the world.'},
            {ref:'Romans 8:38-39', text:'Nothing can separate us from God\'s love.'},
            {ref:'1 John 4:19', text:'We love because he first loved us.'},
            {ref:'John 15:13', text:'Greater love has no one than this.'},
            {ref:'1 John 4:8', text:'God is love.'},
            {ref:'Matthew 22:37-39', text:'Love God and love your neighbor.'},
            {ref:'Ephesians 5:25', text:'Husbands, love your wives as Christ loved.'}
        ],
        'Forgiveness': [
            {ref:'1 John 1:9', text:'If we confess, he is faithful to forgive.'},
            {ref:'Ephesians 4:32', text:'Forgive as God in Christ forgave you.'},
            {ref:'Colossians 3:13', text:'Forgive as the Lord forgave you.'},
            {ref:'Matthew 6:14-15', text:'If you forgive others, God will forgive you.'},
            {ref:'Psalm 103:12', text:'He removed our sins as far as east from west.'},
            {ref:'Acts 3:19', text:'Repent that your sins may be wiped out.'},
            {ref:'Isaiah 1:18', text:'Though your sins be as scarlet, they shall be white.'},
            {ref:'Micah 7:19', text:'He will cast all our sins into the sea.'}
        ],
        'Strength': [
            {ref:'Philippians 4:13', text:'I can do all things through Christ.'},
            {ref:'Isaiah 40:31', text:'They who wait on the Lord shall renew strength.'},
            {ref:'Nehemiah 8:10', text:'The joy of the Lord is your strength.'},
            {ref:'2 Corinthians 12:9', text:'My grace is sufficient, power in weakness.'},
            {ref:'Psalm 46:1', text:'God is our refuge and strength.'},
            {ref:'Ephesians 6:10', text:'Be strong in the Lord and his might.'},
            {ref:'Deuteronomy 31:6', text:'Be strong, he will not forsake you.'},
            {ref:'Zechariah 4:6', text:'Not by might but by my Spirit.'}
        ],
        'Peace': [
            {ref:'John 14:27', text:'My peace I give to you.'},
            {ref:'Philippians 4:7', text:'The peace of God guards your hearts.'},
            {ref:'Isaiah 26:3', text:'Perfect peace to those whose mind is stayed.'},
            {ref:'Romans 5:1', text:'We have peace with God through Christ.'},
            {ref:'Colossians 3:15', text:'Let the peace of Christ rule your hearts.'},
            {ref:'Psalm 29:11', text:'The Lord blesses his people with peace.'},
            {ref:'Romans 8:6', text:'The mind set on the Spirit is life and peace.'},
            {ref:'Matthew 5:9', text:'Blessed are the peacemakers.'}
        ],
        'Prayer': [
            {ref:'Philippians 4:6', text:'In everything by prayer make your requests.'},
            {ref:'1 Thessalonians 5:17', text:'Pray without ceasing.'},
            {ref:'Matthew 7:7', text:'Ask and it will be given to you.'},
            {ref:'James 5:16', text:'The prayer of a righteous person is powerful.'},
            {ref:'Jeremiah 29:12', text:'You will call on me and I will listen.'},
            {ref:'1 John 5:14', text:'If we ask according to his will, he hears.'},
            {ref:'Mark 11:24', text:'Whatever you ask in prayer, believe.'},
            {ref:'Matthew 6:9-13', text:'Our Father in heaven, hallowed be your name.'}
        ],
        'Wisdom': [
            {ref:'James 1:5', text:'If any lacks wisdom, let him ask God.'},
            {ref:'Proverbs 9:10', text:'Fear of the Lord is the beginning of wisdom.'},
            {ref:'Proverbs 3:5-6', text:'Trust in the Lord, lean not on your own understanding.'},
            {ref:'Colossians 2:3', text:'In Christ are hidden all treasures of wisdom.'},
            {ref:'Proverbs 2:6', text:'The Lord gives wisdom.'},
            {ref:'James 3:17', text:'Wisdom from above is pure, peaceable, gentle.'},
            {ref:'Ecclesiastes 7:12', text:'Wisdom preserves the life of its possessor.'},
            {ref:'Proverbs 4:7', text:'Wisdom is the principal thing; get wisdom.'}
        ],
        'Salvation': [
            {ref:'Romans 10:9', text:'Confess Jesus as Lord and believe.'},
            {ref:'Ephesians 2:8-9', text:'By grace through faith, not works.'},
            {ref:'John 3:16', text:'Whoever believes shall not perish.'},
            {ref:'Acts 4:12', text:'No other name by which we must be saved.'},
            {ref:'Romans 6:23', text:'The gift of God is eternal life.'},
            {ref:'Titus 3:5', text:'He saved us by his mercy.'},
            {ref:'John 14:6', text:'I am the way, the truth, and the life.'},
            {ref:'2 Corinthians 5:17', text:'In Christ, you are a new creation.'}
        ],
        'Hope': [
            {ref:'Romans 15:13', text:'May the God of hope fill you with joy.'},
            {ref:'Jeremiah 29:11', text:'Plans to give you hope and a future.'},
            {ref:'Hebrews 6:19', text:'Hope as an anchor for the soul.'},
            {ref:'Romans 8:28', text:'All things work together for good.'},
            {ref:'Psalm 42:11', text:'Put your hope in God.'},
            {ref:'1 Peter 1:3', text:'A living hope through the resurrection.'},
            {ref:'Lamentations 3:24', text:'The Lord is my portion, I will hope in him.'},
            {ref:'Psalm 31:24', text:'Be strong, all you who hope in the Lord.'}
        ],
        'Identity': [
            {ref:'2 Corinthians 5:17', text:'In Christ you are a new creation.'},
            {ref:'Ephesians 2:10', text:'We are his workmanship.'},
            {ref:'1 Peter 2:9', text:'You are a chosen people, royal priesthood.'},
            {ref:'John 1:12', text:'To all who received him, he gave the right to be children.'},
            {ref:'Romans 8:17', text:'Heirs of God and co-heirs with Christ.'},
            {ref:'Galatians 2:20', text:'Christ lives in me.'},
            {ref:'Colossians 3:3', text:'Your life is hidden with Christ in God.'},
            {ref:'Ephesians 1:4', text:'Chosen before the foundation of the world.'}
        ],
        'Spiritual Warfare': [
            {ref:'Ephesians 6:10-18', text:'Put on the full armor of God.'},
            {ref:'2 Corinthians 10:4', text:'Weapons mighty in God to destroy strongholds.'},
            {ref:'James 4:7', text:'Resist the devil and he will flee.'},
            {ref:'1 Peter 5:8', text:'Be sober, the devil prowls like a lion.'},
            {ref:'1 John 4:4', text:'Greater is he in you than he in the world.'},
            {ref:'Romans 8:37', text:'More than conquerors through Christ.'},
            {ref:'Revelation 12:11', text:'They overcame by the blood of the Lamb.'},
            {ref:'Isaiah 54:17', text:'No weapon formed against you shall prosper.'}
        ],
        'Marriage & Family': [
            {ref:'Ephesians 5:25', text:'Husbands, love your wives as Christ loved.'},
            {ref:'Proverbs 22:6', text:'Train up a child in the way he should go.'},
            {ref:'Genesis 2:24', text:'A man shall leave and cleave to his wife.'},
            {ref:'Ephesians 6:4', text:'Fathers, do not provoke your children.'},
            {ref:'1 Peter 3:7', text:'Husbands, live with your wives with understanding.'},
            {ref:'Colossians 3:18-19', text:'Wives submit, husbands love.'},
            {ref:'Proverbs 31:10', text:'An excellent wife, who can find?'},
            {ref:'Deuteronomy 6:6-7', text:'Teach these words to your children.'}
        ],
        'Money & Provision': [
            {ref:'Philippians 4:19', text:'God will supply all your needs.'},
            {ref:'Matthew 6:33', text:'Seek first the kingdom, all else added.'},
            {ref:'Proverbs 3:9-10', text:'Honor the Lord with your wealth.'},
            {ref:'Malachi 3:10', text:'Bring the tithe and see if I won\'t bless.'},
            {ref:'1 Timothy 6:10', text:'Love of money is a root of all evil.'},
            {ref:'Luke 6:38', text:'Give and it will be given to you.'},
            {ref:'Hebrews 13:5', text:'Be content, he will never leave you.'},
            {ref:'Proverbs 11:25', text:'A generous person will prosper.'}
        ],
        'Healing': [
            {ref:'Isaiah 53:5', text:'By his stripes we are healed.'},
            {ref:'James 5:14-15', text:'Pray over the sick, anoint with oil.'},
            {ref:'Psalm 103:3', text:'He heals all your diseases.'},
            {ref:'Jeremiah 17:14', text:'Heal me, O Lord, and I shall be healed.'},
            {ref:'3 John 1:2', text:'I pray you may be in good health.'},
            {ref:'Exodus 15:26', text:'I am the Lord who heals you.'},
            {ref:'Matthew 8:17', text:'He took our infirmities and bore our diseases.'},
            {ref:'Psalm 147:3', text:'He heals the brokenhearted.'}
        ],
        'Temptation': [
            {ref:'1 Corinthians 10:13', text:'God provides a way of escape.'},
            {ref:'James 1:12', text:'Blessed is he who endures temptation.'},
            {ref:'Hebrews 4:15', text:'Jesus was tempted yet without sin.'},
            {ref:'Matthew 26:41', text:'Watch and pray, lest you fall into temptation.'},
            {ref:'James 4:7', text:'Submit to God, resist the devil.'},
            {ref:'Galatians 5:16', text:'Walk by the Spirit, not the flesh.'},
            {ref:'Romans 6:14', text:'Sin shall not have dominion over you.'},
            {ref:'Proverbs 4:23', text:'Guard your heart above all else.'}
        ],
        'Holy Spirit': [
            {ref:'Acts 1:8', text:'You will receive power when the Spirit comes.'},
            {ref:'John 14:26', text:'The Helper will teach you all things.'},
            {ref:'Galatians 5:22-23', text:'The fruit of the Spirit is love, joy, peace.'},
            {ref:'Romans 8:26', text:'The Spirit helps us in our weakness.'},
            {ref:'Ephesians 5:18', text:'Be filled with the Spirit.'},
            {ref:'1 Corinthians 6:19', text:'Your body is a temple of the Holy Spirit.'},
            {ref:'John 16:13', text:'The Spirit will guide you into all truth.'},
            {ref:'Joel 2:28', text:'I will pour out my Spirit on all flesh.'}
        ],
        'God\'s Word': [
            {ref:'2 Timothy 3:16', text:'All Scripture is God-breathed.'},
            {ref:'Hebrews 4:12', text:'The word of God is living and active.'},
            {ref:'Psalm 119:105', text:'Your word is a lamp to my feet.'},
            {ref:'Joshua 1:8', text:'Meditate on it day and night.'},
            {ref:'Romans 10:17', text:'Faith comes by hearing the word.'},
            {ref:'Isaiah 55:11', text:'My word will not return void.'},
            {ref:'Matthew 24:35', text:'Heaven and earth pass, my words remain.'},
            {ref:'James 1:22', text:'Be doers of the word, not hearers only.'}
        ],
        'Suffering': [
            {ref:'Romans 8:18', text:'Present sufferings not worth comparing to glory.'},
            {ref:'James 1:2-3', text:'Count it joy when you face trials.'},
            {ref:'1 Peter 5:10', text:'After suffering, God will restore you.'},
            {ref:'2 Corinthians 1:3-4', text:'God of all comfort comforts us.'},
            {ref:'Romans 5:3-4', text:'Suffering produces perseverance.'},
            {ref:'Psalm 34:18', text:'The Lord is near to the brokenhearted.'},
            {ref:'John 16:33', text:'In the world you will have trouble.'},
            {ref:'1 Peter 4:12-13', text:'Do not be surprised by fiery trials.'}
        ],
        'Second Coming': [
            {ref:'John 14:3', text:'I will come again and receive you.'},
            {ref:'1 Thessalonians 4:16-17', text:'The Lord will descend from heaven.'},
            {ref:'Revelation 22:12', text:'Behold, I am coming soon.'},
            {ref:'Acts 1:11', text:'He will come in the same way you saw him go.'},
            {ref:'Matthew 24:44', text:'Be ready, for the Son of Man is coming.'},
            {ref:'Titus 2:13', text:'Awaiting our blessed hope.'},
            {ref:'James 5:8', text:'The coming of the Lord is at hand.'},
            {ref:'2 Peter 3:10', text:'The day of the Lord will come like a thief.'}
        ]
    };

    // Verse of the Day - Warfare focused
    const VERSES_OF_DAY = [
        {ref:'Ephesians 6:10',text:'Finally, be strong in the Lord, and in the strength of his might.'},
        {ref:'2 Timothy 1:7',text:'For God gave us not a spirit of fear; but of power and love and discipline.'},
        {ref:'Romans 8:37',text:'Nay, in all these things we are more than conquerors through him that loved us.'},
        {ref:'Isaiah 41:10',text:'Fear thou not, for I am with thee; be not dismayed, for I am thy God.'},
        {ref:'Joshua 1:9',text:'Be strong and of good courage; be not affrighted, neither be thou dismayed.'},
        {ref:'Philippians 4:13',text:'I can do all things in him that strengtheneth me.'},
        {ref:'Psalm 91:1',text:'He that dwelleth in the secret place of the Most High shall abide under the shadow of the Almighty.'},
        {ref:'James 4:7',text:'Resist the devil, and he will flee from you.'},
        {ref:'1 John 4:4',text:'Greater is he that is in you than he that is in the world.'},
        {ref:'Proverbs 3:5-6',text:'Trust in Jehovah with all thy heart, and lean not upon thine own understanding.'},
        {ref:'Isaiah 54:17',text:'No weapon that is formed against thee shall prosper.'},
        {ref:'Psalm 18:2',text:'Jehovah is my rock, and my fortress, and my deliverer.'},
        {ref:'2 Corinthians 10:4',text:'The weapons of our warfare are not of the flesh, but mighty before God.'},
        {ref:'Deuteronomy 31:6',text:'Be strong and of good courage, fear not: for Jehovah thy God goeth with thee.'},
        {ref:'Romans 8:31',text:'If God is for us, who is against us?'},
        {ref:'Psalm 27:1',text:'Jehovah is my light and my salvation; whom shall I fear?'},
        {ref:'Hebrews 4:12',text:'The word of God is living, and active, and sharper than any two-edged sword.'},
        {ref:'1 Corinthians 15:57',text:'Thanks be to God, who giveth us the victory through our Lord Jesus Christ.'},
        {ref:'Psalm 144:1',text:'Blessed be Jehovah my rock, who teacheth my hands to war, and my fingers to fight.'},
        {ref:'Nehemiah 8:10',text:'The joy of Jehovah is your strength.'},
        {ref:'Isaiah 40:31',text:'They that wait for Jehovah shall renew their strength; they shall mount up with wings as eagles.'},
        {ref:'Zechariah 4:6',text:'Not by might, nor by power, but by my Spirit, saith Jehovah of hosts.'},
        {ref:'Psalm 34:7',text:'The angel of Jehovah encampeth round about them that fear him, and delivereth them.'},
        {ref:'2 Chronicles 20:15',text:'The battle is not yours, but God\'s.'},
        {ref:'Ephesians 6:12',text:'Our wrestling is not against flesh and blood, but against the principalities.'},
        {ref:'Colossians 2:15',text:'Having despoiled the principalities and the powers, he made a show of them openly.'},
        {ref:'1 Peter 5:8-9',text:'Be sober, be watchful: your adversary the devil, as a roaring lion, walketh about.'},
        {ref:'Revelation 12:11',text:'They overcame him because of the blood of the Lamb, and because of the word of their testimony.'},
        {ref:'Psalm 46:1',text:'God is our refuge and strength, a very present help in trouble.'},
        {ref:'2 Samuel 22:35',text:'He teacheth my hands to war, so that mine arms do bend a bow of brass.'}
    ];

    // === STATE ===
    let testament = 'OT';
    let book = 'Genesis';
    let chapter = '1';
    let fontSize = 18;
    let synth = window.speechSynthesis;
    let speaking = false;
    let currentVerses = []; // Store verses for copy function
    let searchMode = 'books'; // 'books' or 'verses'
    let searchCache = {}; // Cache verse search results

    // === INIT ===
    window.onload = function() {
        // Load saved state
        const saved = localStorage.getItem('dsg-location');
        if (saved) {
            const loc = JSON.parse(saved);
            testament = loc.t || 'OT';
            book = loc.b || 'Genesis';
            chapter = loc.c || '1';
        }
        
        // Load saved font size
        const savedFontSize = localStorage.getItem('dsg-font-size');
        if (savedFontSize) fontSize = parseInt(savedFontSize);
        
        // Load saved theme
        const savedTheme = localStorage.getItem('dsg-theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-theme');
            document.getElementById('themeToggle').textContent = '‚òÄÔ∏è';
        }

        // Hide splash after delay
        setTimeout(function() {
            document.getElementById('splash').classList.add('hidden');
            document.getElementById('app').classList.add('visible');
            
            // Show briefing once per day
            const today = new Date().toDateString();
            if (localStorage.getItem('dsg-briefing-date') !== today) {
                setTimeout(function() {
                    openModal('briefingModal');
                    localStorage.setItem('dsg-briefing-date', today);
                }, 300);
            }
        }, 2200);

        // Show Verse of the Day on splash
        showVerseOfDay();

        // Init UI
        document.getElementById('testamentSelect').value = testament;
        updateBooks();
        loadArmor();
        loadTargets();
    };

    // === VERSE OF THE DAY ===
    function showVerseOfDay() {
        // Use day of year to rotate through verses
        const now = new Date();
        const start = new Date(now.getFullYear(), 0, 0);
        const diff = now - start;
        const dayOfYear = Math.floor(diff / (1000 * 60 * 60 * 24));
        const verse = VERSES_OF_DAY[dayOfYear % VERSES_OF_DAY.length];
        
        document.getElementById('vodText').textContent = '"' + verse.text + '"';
        document.getElementById('vodRef').textContent = '‚Äî ' + verse.ref;
    }

    // === COPY VERSE ===
    function copyVerse(verseNum) {
        const verse = currentVerses.find(function(v) { return v.verse === verseNum || currentVerses.indexOf(v) === verseNum - 1; });
        if (verse) {
            const text = '"' + verse.text.trim() + '" ‚Äî ' + book + ' ' + chapter + ':' + verseNum + ' (ASV)';
            navigator.clipboard.writeText(text).then(function() {
                showToast('üìã Verse copied to clipboard!');
            }).catch(function() {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast('üìã Verse copied!');
            });
        }
    }

    // === READING PROGRESS ===
    function markChapterRead(bookName, chapterNum) {
        localStorage.setItem('dsg-read-' + bookName + '-' + chapterNum, 'true');
        updateStreak(); // Update reading streak
    }

    function getBookProgress(bookName) {
        const t = BIBLE.NT.find(function(b) { return b.name === bookName; }) ? 'NT' : 'OT';
        const bookData = BIBLE[t].find(function(b) { return b.name === bookName; });
        if (!bookData) return { read: 0, total: 1 };
        
        let read = 0;
        for (let i = 1; i <= bookData.ch; i++) {
            if (localStorage.getItem('dsg-read-' + bookName + '-' + i) === 'true') {
                read++;
            }
        }
        return { read: read, total: bookData.ch };
    }

    // === RED LETTER EDITION ===
    // Chapters where Jesus speaks (simplified - marks entire verses in these chapters)
    const RED_LETTER_CHAPTERS = {
        'Matthew': {5:[1,48],6:[1,34],7:[1,29],10:[5,42],11:[4,30],12:[3,50],13:[3,52],15:[3,28],16:[6,28],17:[4,27],18:[2,35],19:[4,30],20:[1,28],21:[2,44],22:[2,46],23:[2,39],24:[2,51],25:[1,46],26:[2,75],28:[9,20]},
        'Mark': {2:[5,28],3:[3,35],4:[2,41],5:[8,41],6:[4,50],7:[6,37],8:[2,38],9:[1,50],10:[3,52],11:[2,33],12:[1,44],13:[2,37],14:[6,72]},
        'Luke': {4:[4,44],5:[4,39],6:[3,49],7:[9,50],8:[5,56],9:[3,62],10:[2,42],11:[2,54],12:[2,59],13:[2,35],14:[3,35],15:[3,32],16:[1,31],17:[1,37],18:[2,43],19:[5,48],20:[3,47],21:[3,38],22:[10,71],24:[17,49]},
        'John': {3:[3,21],4:[7,54],5:[6,47],6:[5,71],7:[6,53],8:[7,59],9:[3,41],10:[1,42],11:[4,57],12:[7,50],13:[7,38],14:[1,31],15:[1,27],16:[1,33],17:[1,26],18:[5,40],21:[5,25]}
    };

    function isJesusWords(bookName, chapterNum, verseNum) {
        const bookData = RED_LETTER_CHAPTERS[bookName];
        if (!bookData) return false;
        const chapterData = bookData[parseInt(chapterNum)];
        if (!chapterData) return false;
        const v = parseInt(verseNum);
        return v >= chapterData[0] && v <= chapterData[1];
    }

    // === SCRIPTURE MEMORY SYSTEM ===
    let memoryVerses = [];
    let currentFlashcardIndex = 0;
    let flashcardMode = false;

    function toggleMemorize(b, c, v) {
        const key = 'dsg-mem-' + b + '-' + c + '-' + v;
        const existing = localStorage.getItem(key);
        
        if (existing) {
            localStorage.removeItem(key);
            showToast('Removed from memory list');
        } else {
            // Get verse text
            const verse = currentVerses.find(function(vs) { return vs.verse === v || currentVerses.indexOf(vs) === v - 1; });
            const text = verse ? verse.text : '';
            localStorage.setItem(key, JSON.stringify({
                book: b,
                chapter: c,
                verse: v,
                text: text,
                level: 'new',
                added: new Date().toISOString()
            }));
            showToast('üß† Added to memory list!');
        }
        renderChapter(chapter);
    }

    function loadMemoryVerses() {
        memoryVerses = [];
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('dsg-mem-')) {
                try {
                    const data = JSON.parse(localStorage.getItem(key));
                    data.key = key;
                    memoryVerses.push(data);
                } catch(e) {}
            }
        }
        return memoryVerses;
    }

    function initMemoryModal() {
        loadMemoryVerses();
        
        // Update stats
        const total = memoryVerses.length;
        const learning = memoryVerses.filter(function(v) { return v.level === 'new' || v.level === 'learning'; }).length;
        const mastered = memoryVerses.filter(function(v) { return v.level === 'mastered'; }).length;
        
        document.getElementById('memTotal').textContent = total;
        document.getElementById('memLearning').textContent = learning;
        document.getElementById('memMastered').textContent = mastered;
        
        // Update list
        const list = document.getElementById('memoryList');
        if (memoryVerses.length === 0) {
            list.innerHTML = '<p style="color:var(--slate-500);text-align:center;padding:20px">Click üß† on any verse to add it to your memory list</p>';
        } else {
            list.innerHTML = memoryVerses.map(function(v) {
                const levelClass = v.level === 'mastered' ? 'mastered' : '';
                return '<div class="memory-item" onclick="goTo(\'' + v.book + '\',\'' + v.chapter + '\');closeModal(\'memoryModal\')">' +
                    '<div><div class="memory-item-ref">' + v.book + ' ' + v.chapter + ':' + v.verse + '</div></div>' +
                    '<div style="display:flex;align-items:center;gap:8px">' +
                    '<span class="memory-item-level ' + levelClass + '">' + (v.level || 'new').toUpperCase() + '</span>' +
                    '<button onclick="removeMemoryVerse(\'' + v.key + '\');event.stopPropagation()" style="background:none;border:none;color:var(--slate-600);cursor:pointer">‚úï</button>' +
                    '</div></div>';
            }).join('');
        }
        
        // Reset flashcard area
        document.getElementById('flashcardArea').style.display = 'none';
        document.getElementById('memoryListArea').style.display = 'block';
        document.getElementById('flashcardBtn').style.display = memoryVerses.length > 0 ? 'inline-block' : 'none';
    }

    function removeMemoryVerse(key) {
        localStorage.removeItem(key);
        initMemoryModal();
        showToast('Removed from memory');
    }

    function startFlashcards() {
        loadMemoryVerses();
        if (memoryVerses.length === 0) {
            showToast('No verses to review');
            return;
        }
        
        // Shuffle array
        memoryVerses.sort(function() { return Math.random() - 0.5; });
        currentFlashcardIndex = 0;
        flashcardMode = true;
        
        document.getElementById('flashcardArea').style.display = 'block';
        document.getElementById('memoryListArea').style.display = 'none';
        
        showFlashcard();
    }

    function showFlashcard() {
        if (currentFlashcardIndex >= memoryVerses.length) {
            // Done with all cards
            document.getElementById('flashcardArea').innerHTML = '<div style="text-align:center;padding:40px"><p style="font-size:2rem;margin-bottom:16px">üéâ</p><p style="color:var(--emerald);font-size:1.2rem">Session Complete!</p><p style="color:var(--slate-500);margin-top:8px">You reviewed ' + memoryVerses.length + ' verses</p><button class="btn primary" style="margin-top:20px" onclick="initMemoryModal()">Back to List</button></div>';
            return;
        }
        
        const v = memoryVerses[currentFlashcardIndex];
        document.getElementById('flashcardRef').textContent = v.book + ' ' + v.chapter + ':' + v.verse;
        document.getElementById('flashcardText').textContent = v.text;
        document.querySelector('.flashcard').classList.remove('revealed');
    }

    function revealFlashcard() {
        document.querySelector('.flashcard').classList.add('revealed');
    }

    function rateFlashcard(rating) {
        const v = memoryVerses[currentFlashcardIndex];
        const data = JSON.parse(localStorage.getItem(v.key));
        
        if (rating === 'easy') {
            data.level = 'mastered';
        } else if (rating === 'good') {
            data.level = 'learning';
        } else {
            data.level = 'new';
        }
        
        localStorage.setItem(v.key, JSON.stringify(data));
        currentFlashcardIndex++;
        showFlashcard();
    }

    // === VICTORY JOURNAL ===
    let selectedVictoryType = 'answered';

    function selectVictoryType(el, type) {
        document.querySelectorAll('.victory-type').forEach(function(t) { t.classList.remove('selected'); });
        el.classList.add('selected');
        selectedVictoryType = type;
    }

    function addVictory() {
        const text = document.getElementById('victoryInput').value.trim();
        if (!text) {
            showToast('Please enter your victory');
            return;
        }
        
        const victories = JSON.parse(localStorage.getItem('dsg-victories') || '[]');
        victories.unshift({
            type: selectedVictoryType,
            text: text,
            date: new Date().toISOString()
        });
        localStorage.setItem('dsg-victories', JSON.stringify(victories));
        
        document.getElementById('victoryInput').value = '';
        showToast('üèÜ Victory recorded!');
        loadVictories();
    }

    function loadVictories() {
        const victories = JSON.parse(localStorage.getItem('dsg-victories') || '[]');
        const list = document.getElementById('victoryList');
        
        if (victories.length === 0) {
            list.innerHTML = '<p style="color:var(--slate-500);text-align:center;padding:20px">No victories recorded yet. Start documenting God\'s faithfulness!</p>';
            return;
        }
        
        const typeLabels = {
            'answered': 'üôè Answered Prayer',
            'breakthrough': '‚ö° Breakthrough',
            'protection': 'üõ°Ô∏è Protection',
            'provision': 'üíé Provision',
            'healing': '‚ù§Ô∏è Healing',
            'testimony': 'üì£ Testimony'
        };
        
        list.innerHTML = victories.map(function(v, i) {
            const date = new Date(v.date).toLocaleDateString();
            return '<div class="victory-item">' +
                '<div class="victory-item-header">' +
                '<span class="victory-item-type">' + (typeLabels[v.type] || v.type) + '</span>' +
                '<div style="display:flex;align-items:center;gap:8px">' +
                '<span class="victory-item-date">' + date + '</span>' +
                '<button class="victory-item-delete" onclick="deleteVictory(' + i + ')">‚úï</button>' +
                '</div></div>' +
                '<div class="victory-item-text">' + v.text + '</div>' +
            '</div>';
        }).join('');
    }

    function deleteVictory(index) {
        const victories = JSON.parse(localStorage.getItem('dsg-victories') || '[]');
        victories.splice(index, 1);
        localStorage.setItem('dsg-victories', JSON.stringify(victories));
        loadVictories();
        showToast('Victory removed');
    }

    // === READING STREAKS ===
    function updateStreak() {
        const today = new Date().toDateString();
        const lastRead = localStorage.getItem('dsg-last-read-date');
        let streak = parseInt(localStorage.getItem('dsg-streak') || '0');
        let best = parseInt(localStorage.getItem('dsg-streak-best') || '0');
        
        if (lastRead !== today) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (lastRead === yesterday.toDateString()) {
                // Consecutive day - increase streak
                streak++;
            } else if (lastRead !== today) {
                // Streak broken - reset to 1
                streak = 1;
            }
            
            localStorage.setItem('dsg-streak', streak);
            localStorage.setItem('dsg-last-read-date', today);
            
            // Update total days
            const totalDays = parseInt(localStorage.getItem('dsg-total-days') || '0') + 1;
            localStorage.setItem('dsg-total-days', totalDays);
            
            // Check for new best
            if (streak > best) {
                localStorage.setItem('dsg-streak-best', streak);
            }
        }
    }

    function loadStreakModal() {
        const streak = parseInt(localStorage.getItem('dsg-streak') || '0');
        const best = parseInt(localStorage.getItem('dsg-streak-best') || '0');
        const totalDays = parseInt(localStorage.getItem('dsg-total-days') || '0');
        
        // Count chapters and books read
        let chapters = 0;
        let booksStarted = {};
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('dsg-read-')) {
                chapters++;
                const bookName = key.replace('dsg-read-', '').split('-')[0];
                booksStarted[bookName] = true;
            }
        }
        
        document.getElementById('streakCount').textContent = streak;
        document.getElementById('streakBest').textContent = best;
        document.getElementById('streakTotal').textContent = totalDays;
        document.getElementById('streakChapters').textContent = chapters;
        document.getElementById('streakBooks').textContent = Object.keys(booksStarted).length;
    }

    // === READING PLANS ===
    const READING_PLANS = {
        'warfare': {
            name: 'Spiritual Warfare Bootcamp',
            desc: '21 days of battle-ready Scripture',
            days: [
                {reading:'Ephesians 6',ref:'Ephesians',ch:'6'},{reading:'2 Corinthians 10:3-5',ref:'2 Corinthians',ch:'10'},
                {reading:'James 4:7-10',ref:'James',ch:'4'},{reading:'1 Peter 5:8-11',ref:'1 Peter',ch:'5'},
                {reading:'Romans 8:31-39',ref:'Romans',ch:'8'},{reading:'Isaiah 54:17',ref:'Isaiah',ch:'54'},
                {reading:'Psalm 91',ref:'Psalms',ch:'91'},{reading:'Psalm 144',ref:'Psalms',ch:'144'},
                {reading:'Joshua 1',ref:'Joshua',ch:'1'},{reading:'Deuteronomy 20:1-4',ref:'Deuteronomy',ch:'20'},
                {reading:'2 Chronicles 20:1-30',ref:'2 Chronicles',ch:'20'},{reading:'Exodus 14',ref:'Exodus',ch:'14'},
                {reading:'Daniel 10',ref:'Daniel',ch:'10'},{reading:'Revelation 12',ref:'Revelation',ch:'12'},
                {reading:'Colossians 2:13-15',ref:'Colossians',ch:'2'},{reading:'Luke 10:17-20',ref:'Luke',ch:'10'},
                {reading:'Mark 16:15-20',ref:'Mark',ch:'16'},{reading:'Acts 19:11-20',ref:'Acts',ch:'19'},
                {reading:'2 Kings 6:8-23',ref:'2 Kings',ch:'6'},{reading:'Isaiah 40:28-31',ref:'Isaiah',ch:'40'},
                {reading:'Revelation 19:11-21',ref:'Revelation',ch:'19'}
            ]
        },
        'psalms30': {
            name: 'Psalms in 30 Days',
            desc: '5 Psalms per day for a month',
            days: [
                {reading:'Psalms 1-5',ref:'Psalms',ch:'1'},{reading:'Psalms 6-10',ref:'Psalms',ch:'6'},
                {reading:'Psalms 11-15',ref:'Psalms',ch:'11'},{reading:'Psalms 16-20',ref:'Psalms',ch:'16'},
                {reading:'Psalms 21-25',ref:'Psalms',ch:'21'},{reading:'Psalms 26-30',ref:'Psalms',ch:'26'},
                {reading:'Psalms 31-35',ref:'Psalms',ch:'31'},{reading:'Psalms 36-40',ref:'Psalms',ch:'36'},
                {reading:'Psalms 41-45',ref:'Psalms',ch:'41'},{reading:'Psalms 46-50',ref:'Psalms',ch:'46'},
                {reading:'Psalms 51-55',ref:'Psalms',ch:'51'},{reading:'Psalms 56-60',ref:'Psalms',ch:'56'},
                {reading:'Psalms 61-65',ref:'Psalms',ch:'61'},{reading:'Psalms 66-70',ref:'Psalms',ch:'66'},
                {reading:'Psalms 71-75',ref:'Psalms',ch:'71'},{reading:'Psalms 76-80',ref:'Psalms',ch:'76'},
                {reading:'Psalms 81-85',ref:'Psalms',ch:'81'},{reading:'Psalms 86-90',ref:'Psalms',ch:'86'},
                {reading:'Psalms 91-95',ref:'Psalms',ch:'91'},{reading:'Psalms 96-100',ref:'Psalms',ch:'96'},
                {reading:'Psalms 101-105',ref:'Psalms',ch:'101'},{reading:'Psalms 106-110',ref:'Psalms',ch:'106'},
                {reading:'Psalms 111-115',ref:'Psalms',ch:'111'},{reading:'Psalms 116-120',ref:'Psalms',ch:'116'},
                {reading:'Psalms 121-125',ref:'Psalms',ch:'121'},{reading:'Psalms 126-130',ref:'Psalms',ch:'126'},
                {reading:'Psalms 131-135',ref:'Psalms',ch:'131'},{reading:'Psalms 136-140',ref:'Psalms',ch:'136'},
                {reading:'Psalms 141-145',ref:'Psalms',ch:'141'},{reading:'Psalms 146-150',ref:'Psalms',ch:'146'}
            ]
        },
        'gospels': {
            name: 'Gospels in 30 Days',
            desc: 'Walk with Jesus through all 4 accounts',
            days: [
                {reading:'Matthew 1-3',ref:'Matthew',ch:'1'},{reading:'Matthew 4-6',ref:'Matthew',ch:'4'},
                {reading:'Matthew 7-9',ref:'Matthew',ch:'7'},{reading:'Matthew 10-12',ref:'Matthew',ch:'10'},
                {reading:'Matthew 13-15',ref:'Matthew',ch:'13'},{reading:'Matthew 16-18',ref:'Matthew',ch:'16'},
                {reading:'Matthew 19-21',ref:'Matthew',ch:'19'},{reading:'Matthew 22-24',ref:'Matthew',ch:'22'},
                {reading:'Matthew 25-28',ref:'Matthew',ch:'25'},{reading:'Mark 1-4',ref:'Mark',ch:'1'},
                {reading:'Mark 5-8',ref:'Mark',ch:'5'},{reading:'Mark 9-12',ref:'Mark',ch:'9'},
                {reading:'Mark 13-16',ref:'Mark',ch:'13'},{reading:'Luke 1-3',ref:'Luke',ch:'1'},
                {reading:'Luke 4-6',ref:'Luke',ch:'4'},{reading:'Luke 7-9',ref:'Luke',ch:'7'},
                {reading:'Luke 10-12',ref:'Luke',ch:'10'},{reading:'Luke 13-15',ref:'Luke',ch:'13'},
                {reading:'Luke 16-18',ref:'Luke',ch:'16'},{reading:'Luke 19-21',ref:'Luke',ch:'19'},
                {reading:'Luke 22-24',ref:'Luke',ch:'22'},{reading:'John 1-3',ref:'John',ch:'1'},
                {reading:'John 4-6',ref:'John',ch:'4'},{reading:'John 7-9',ref:'John',ch:'7'},
                {reading:'John 10-12',ref:'John',ch:'10'},{reading:'John 13-15',ref:'John',ch:'13'},
                {reading:'John 16-18',ref:'John',ch:'16'},{reading:'John 19-21',ref:'John',ch:'19'}
            ]
        },
        'newbeliever': {
            name: 'New Believer Foundations',
            desc: '14 days of essential truths',
            days: [
                {reading:'John 3',ref:'John',ch:'3'},{reading:'Romans 3',ref:'Romans',ch:'3'},
                {reading:'Romans 5',ref:'Romans',ch:'5'},{reading:'Romans 6',ref:'Romans',ch:'6'},
                {reading:'Romans 8',ref:'Romans',ch:'8'},{reading:'Ephesians 1',ref:'Ephesians',ch:'1'},
                {reading:'Ephesians 2',ref:'Ephesians',ch:'2'},{reading:'Galatians 5',ref:'Galatians',ch:'5'},
                {reading:'Colossians 3',ref:'Colossians',ch:'3'},{reading:'1 John 1',ref:'1 John',ch:'1'},
                {reading:'1 John 3',ref:'1 John',ch:'3'},{reading:'James 1',ref:'James',ch:'1'},
                {reading:'Philippians 4',ref:'Philippians',ch:'4'},{reading:'Hebrews 11',ref:'Hebrews',ch:'11'}
            ]
        }
    };

    let activePlan = null;
    let activePlanKey = null;

    function loadPlansModal() {
        const plansList = document.getElementById('plansList');
        const activePlanData = localStorage.getItem('dsg-active-plan');
        
        if (activePlanData) {
            const parsed = JSON.parse(activePlanData);
            activePlanKey = parsed.key;
            activePlan = parsed;
        }
        
        let html = '';
        Object.keys(READING_PLANS).forEach(function(key) {
            const plan = READING_PLANS[key];
            const isActive = activePlanKey === key;
            const progress = getPlanProgress(key);
            const pct = Math.round((progress.completed / progress.total) * 100);
            
            html += '<div class="plan-card ' + (isActive ? 'active' : '') + '" onclick="' + (isActive ? 'showPlanDetail(\'' + key + '\')' : 'startPlan(\'' + key + '\')') + '">' +
                '<div class="plan-card-header">' +
                '<span class="plan-card-title">' + plan.name + '</span>' +
                '<span class="plan-card-badge">' + (isActive ? 'ACTIVE' : plan.days.length + ' DAYS') + '</span>' +
                '</div>' +
                '<div class="plan-card-desc">' + plan.desc + '</div>' +
                '<div class="plan-card-progress"><div class="plan-card-progress-fill" style="width:' + pct + '%"></div></div>' +
            '</div>';
        });
        
        plansList.innerHTML = html;
        document.getElementById('plansList').style.display = 'block';
        document.getElementById('planDetail').style.display = 'none';
    }

    function getPlanProgress(planKey) {
        const plan = READING_PLANS[planKey];
        const completed = JSON.parse(localStorage.getItem('dsg-plan-' + planKey) || '[]');
        return { completed: completed.length, total: plan.days.length };
    }

    function startPlan(planKey) {
        activePlanKey = planKey;
        activePlan = { key: planKey, startDate: new Date().toISOString() };
        localStorage.setItem('dsg-active-plan', JSON.stringify(activePlan));
        showToast('üìÖ Plan started!');
        showPlanDetail(planKey);
    }

    function showPlanDetail(planKey) {
        const plan = READING_PLANS[planKey];
        const completed = JSON.parse(localStorage.getItem('dsg-plan-' + planKey) || '[]');
        const todayIndex = completed.length;
        
        document.getElementById('plansList').style.display = 'none';
        document.getElementById('planDetail').style.display = 'block';
        document.getElementById('planDetail').classList.add('active');
        
        // Today's reading
        if (todayIndex < plan.days.length) {
            document.getElementById('planTodayReading').textContent = plan.days[todayIndex].reading;
            document.getElementById('planTodayReading').dataset.ref = plan.days[todayIndex].ref;
            document.getElementById('planTodayReading').dataset.ch = plan.days[todayIndex].ch;
        } else {
            document.getElementById('planTodayReading').textContent = 'üéâ Plan Complete!';
        }
        
        // Checklist
        let checklistHtml = '';
        plan.days.forEach(function(day, i) {
            const isCompleted = completed.includes(i);
            const isToday = i === todayIndex;
            checklistHtml += '<div class="plan-day ' + (isCompleted ? 'completed' : '') + ' ' + (isToday ? 'today' : '') + '" onclick="togglePlanDay(\'' + planKey + '\',' + i + ')">' +
                '<div class="plan-day-check">' + (isCompleted ? '‚úì' : '') + '</div>' +
                '<div class="plan-day-text">Day ' + (i + 1) + ': ' + day.reading + '</div>' +
            '</div>';
        });
        document.getElementById('planChecklist').innerHTML = checklistHtml;
    }

    function showPlansList() {
        document.getElementById('plansList').style.display = 'block';
        document.getElementById('planDetail').style.display = 'none';
        document.getElementById('planDetail').classList.remove('active');
        loadPlansModal();
    }

    function togglePlanDay(planKey, dayIndex) {
        let completed = JSON.parse(localStorage.getItem('dsg-plan-' + planKey) || '[]');
        const idx = completed.indexOf(dayIndex);
        if (idx >= 0) {
            completed.splice(idx, 1);
        } else {
            completed.push(dayIndex);
        }
        localStorage.setItem('dsg-plan-' + planKey, JSON.stringify(completed));
        showPlanDetail(planKey);
    }

    function goToPlanReading() {
        const el = document.getElementById('planTodayReading');
        const ref = el.dataset.ref;
        const ch = el.dataset.ch;
        if (ref && ch) {
            goTo(ref, ch);
            closeModal('plansModal');
        }
    }

    // === DECLARATIONS ===
    const PRESET_DECLARATIONS = [
        {type:'I AM',text:'More than a conqueror through Christ who loves me',ref:'Romans 8:37'},
        {type:'I AM',text:'The righteousness of God in Christ Jesus',ref:'2 Corinthians 5:21'},
        {type:'I AM',text:'Seated with Christ in heavenly places',ref:'Ephesians 2:6'},
        {type:'I AM',text:'A new creation - the old has passed away',ref:'2 Corinthians 5:17'},
        {type:'I AM',text:'Fearfully and wonderfully made',ref:'Psalm 139:14'},
        {type:'I AM',text:'The head and not the tail, above and not beneath',ref:'Deuteronomy 28:13'},
        {type:'I AM',text:'Healed by His stripes',ref:'Isaiah 53:5'},
        {type:'I AM',text:'Strong in the Lord and in His mighty power',ref:'Ephesians 6:10'},
        {type:'GOD IS',text:'My refuge and strength, a very present help in trouble',ref:'Psalm 46:1'},
        {type:'GOD IS',text:'For me - who can be against me?',ref:'Romans 8:31'},
        {type:'GOD IS',text:'Faithful to complete the good work He started in me',ref:'Philippians 1:6'},
        {type:'GOD IS',text:'Working all things together for my good',ref:'Romans 8:28'},
        {type:'GOD IS',text:'My shepherd - I shall not want',ref:'Psalm 23:1'},
        {type:'GOD IS',text:'My light and my salvation - whom shall I fear?',ref:'Psalm 27:1'},
        {type:'I HAVE',text:'Not been given a spirit of fear, but of power, love, and a sound mind',ref:'2 Timothy 1:7'},
        {type:'I HAVE',text:'The mind of Christ',ref:'1 Corinthians 2:16'},
        {type:'I HAVE',text:'Authority to trample on serpents and scorpions',ref:'Luke 10:19'},
        {type:'I HAVE',text:'Every spiritual blessing in heavenly places',ref:'Ephesians 1:3'},
        {type:'I HAVE',text:'Peace that surpasses all understanding',ref:'Philippians 4:7'},
        {type:'I CAN',text:'Do all things through Christ who strengthens me',ref:'Philippians 4:13'},
        {type:'I CAN',text:'Cast all my anxiety on Him because He cares for me',ref:'1 Peter 5:7'},
        {type:'I CAN',text:'Approach the throne of grace with confidence',ref:'Hebrews 4:16'},
        {type:'I CAN',text:'Resist the devil and he will flee from me',ref:'James 4:7'}
    ];

    let currentDeclarationIndex = 0;
    let selectedDeclareType = 'I AM';

    function loadDeclarationsModal() {
        showDeclaration(currentDeclarationIndex);
        loadSavedDeclarations();
    }

    function showDeclaration(index) {
        const d = PRESET_DECLARATIONS[index];
        document.getElementById('declareType').textContent = d.type;
        document.getElementById('declareText').textContent = d.text;
        document.getElementById('declareRef').textContent = '‚Äî ' + d.ref;
    }

    function prevDeclaration() {
        currentDeclarationIndex = (currentDeclarationIndex - 1 + PRESET_DECLARATIONS.length) % PRESET_DECLARATIONS.length;
        showDeclaration(currentDeclarationIndex);
    }

    function nextDeclaration() {
        currentDeclarationIndex = (currentDeclarationIndex + 1) % PRESET_DECLARATIONS.length;
        showDeclaration(currentDeclarationIndex);
    }

    function speakDeclaration() {
        const d = PRESET_DECLARATIONS[currentDeclarationIndex];
        const text = d.type + '... ' + d.text + '! ' + d.ref;
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 0.85;
        synth.speak(utterance);
        showToast('üîä Speak it out loud!');
    }

    function saveDeclaration() {
        const d = PRESET_DECLARATIONS[currentDeclarationIndex];
        let saved = JSON.parse(localStorage.getItem('dsg-declarations') || '[]');
        
        // Check if already saved
        const exists = saved.some(function(s) { return s.text === d.text; });
        if (exists) {
            showToast('Already saved!');
            return;
        }
        
        saved.push(d);
        localStorage.setItem('dsg-declarations', JSON.stringify(saved));
        showToast('üíæ Declaration saved!');
        loadSavedDeclarations();
    }

    function selectDeclareType(el, type) {
        document.querySelectorAll('.declare-type').forEach(function(t) { t.classList.remove('selected'); });
        el.classList.add('selected');
        selectedDeclareType = type;
    }

    function addCustomDeclaration() {
        const text = document.getElementById('customDeclareText').value.trim();
        const ref = document.getElementById('customDeclareRef').value.trim();
        
        if (!text) {
            showToast('Please enter a declaration');
            return;
        }
        
        let saved = JSON.parse(localStorage.getItem('dsg-declarations') || '[]');
        saved.push({ type: selectedDeclareType, text: text, ref: ref || 'Custom', custom: true });
        localStorage.setItem('dsg-declarations', JSON.stringify(saved));
        
        document.getElementById('customDeclareText').value = '';
        document.getElementById('customDeclareRef').value = '';
        showToast('‚ûï Declaration added!');
        loadSavedDeclarations();
    }

    function loadSavedDeclarations() {
        const saved = JSON.parse(localStorage.getItem('dsg-declarations') || '[]');
        const list = document.getElementById('declarationList');
        
        if (saved.length === 0) {
            list.innerHTML = '<p style="color:var(--slate-500);text-align:center;padding:20px">Save declarations to build your arsenal</p>';
            return;
        }
        
        list.innerHTML = saved.map(function(d, i) {
            return '<div class="declaration-item">' +
                '<span class="declaration-item-type">' + d.type + '</span>' +
                '<span class="declaration-item-text">' + d.text + '</span>' +
                '<button onclick="removeDeclaration(' + i + ')" style="background:none;border:none;color:var(--slate-600);cursor:pointer;padding:4px">‚úï</button>' +
            '</div>';
        }).join('');
    }

    function removeDeclaration(index) {
        let saved = JSON.parse(localStorage.getItem('dsg-declarations') || '[]');
        saved.splice(index, 1);
        localStorage.setItem('dsg-declarations', JSON.stringify(saved));
        loadSavedDeclarations();
        showToast('Declaration removed');
    }

    // === NAVIGATION ===
    function updateBooks() {
        testament = document.getElementById('testamentSelect').value;
        const sel = document.getElementById('bookSelect');
        sel.innerHTML = '';
        BIBLE[testament].forEach(function(b) {
            const opt = document.createElement('option');
            opt.value = b.name;
            opt.textContent = b.name;
            sel.appendChild(opt);
        });
        if (!BIBLE[testament].find(function(b) { return b.name === book; })) {
            book = BIBLE[testament][0].name;
            chapter = '1';
        }
        sel.value = book;
        loadBook();
    }

    function loadBook() {
        book = document.getElementById('bookSelect').value;
        const data = BIBLE[testament].find(function(b) { return b.name === book; });
        const sel = document.getElementById('chapterSelect');
        sel.innerHTML = '';
        for (let i = 1; i <= data.ch; i++) {
            const opt = document.createElement('option');
            opt.value = i;
            opt.textContent = 'Ch ' + i;
            sel.appendChild(opt);
        }
        if (parseInt(chapter) > data.ch) chapter = '1';
        sel.value = chapter;
        renderChapter(chapter);
    }

    function goTo(b, c) {
        testament = BIBLE.NT.find(function(x) { return x.name === b; }) ? 'NT' : 'OT';
        book = b;
        chapter = c;
        document.getElementById('testamentSelect').value = testament;
        updateBooks();
    }

    // === RENDER CHAPTER ===
    async function renderChapter(ch) {
        if (speaking) cancelAudio();
        chapter = ch;
        saveLocation();
        loadNotes();

        document.getElementById('chapterSelect').value = ch;
        const area = document.getElementById('scriptureArea');
        area.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading ' + book + ' ' + ch + '...</p></div>';

        let verses = [];
        
        // Try bible-api.com first (most reliable, uses book names directly)
        try {
            const bookName = book.replace(/ /g, '%20');
            const url = 'https://bible-api.com/' + bookName + '%20' + ch + '?translation=asv';
            console.log('Fetching:', url);
            const res = await fetch(url);
            if (res.ok) {
                const data = await res.json();
                if (data.verses && data.verses.length > 0) {
                    verses = data.verses;
                    console.log('Loaded', verses.length, 'verses from bible-api.com');
                }
            }
        } catch (e) {
            console.log('bible-api.com failed:', e.message);
        }

        // If primary API failed, try backup API
        if (verses.length === 0) {
            try {
                // Convert book name for API (e.g., "1 Samuel" -> "1samuel")
                const bookSlug = book.toLowerCase().replace(/ /g, '');
                const url2 = 'https://cdn.jsdelivr.net/gh/wldeh/bible-api@main/bibles/en-asv/books/' + bookSlug + '/chapters/' + ch + '.json';
                console.log('Trying backup:', url2);
                const res2 = await fetch(url2);
                if (res2.ok) {
                    const data2 = await res2.json();
                    if (data2.verses) {
                        verses = data2.verses.map(function(v, i) {
                            return { verse: i + 1, text: v.text };
                        });
                        console.log('Loaded', verses.length, 'verses from backup API');
                    }
                }
            } catch (e2) {
                console.log('Backup API failed:', e2.message);
            }
        }

        // Final fallback to embedded content
        if (verses.length === 0) {
            const fallbackKey = book + '-' + ch;
            if (SCRIPTURE_FALLBACK[fallbackKey]) {
                verses = SCRIPTURE_FALLBACK[fallbackKey];
                console.log('Using embedded fallback for', fallbackKey);
            }
        }

        // Store verses globally for copy function
        currentVerses = verses;
        
        // Check if this is a red letter book (Gospels)
        const isGospel = ['Matthew','Mark','Luke','John'].includes(book);
        const redLetterEnabled = localStorage.getItem('dsg-redletter') !== 'false';

        // Build HTML
        let html = '';
        if (verses.length > 0) {
            verses.forEach(function(v, i) {
                const verseNum = v.verse || (i + 1);
                const isHL = localStorage.getItem('dsg-hl-' + book + '-' + ch + '-' + verseNum) === 'true';
                const isMemorized = localStorage.getItem('dsg-mem-' + book + '-' + ch + '-' + verseNum);
                const hlClass = isHL ? 'highlighted' : '';
                const memClass = isMemorized ? 'memorizing' : '';
                let text = injectLexicon(v.text);
                
                // Apply red letter styling for Jesus' words in Gospels
                if (isGospel && redLetterEnabled && isJesusWords(book, ch, verseNum)) {
                    text = '<span class="red-letter">' + text + '</span>';
                }
                
                const copyBtn = '<span class="verse-copy" onclick="copyVerse(' + verseNum + ');event.stopPropagation()" title="Copy verse">üìã</span>';
                const memBtn = '<span class="verse-mem ' + (isMemorized ? 'active' : '') + '" onclick="toggleMemorize(\'' + book + '\',\'' + ch + '\',' + verseNum + ');event.stopPropagation()" title="Memorize verse">üß†</span>';
                
                if (i === 0) {
                    html += '<p class="verse ' + hlClass + ' ' + memClass + '" onclick="toggleHighlight(\'' + book + '\',\'' + ch + '\',' + verseNum + ')"><span class="dropcap">' + verseNum + '</span>' + text + '<span class="verse-actions">' + memBtn + copyBtn + '</span></p>';
                } else {
                    html += '<p class="verse ' + hlClass + ' ' + memClass + '" onclick="toggleHighlight(\'' + book + '\',\'' + ch + '\',' + verseNum + ')"><span class="verse-num">' + verseNum + '</span>' + text + '<span class="verse-actions">' + memBtn + copyBtn + '</span></p>';
                }
            });
        } else {
            html = '<div style="text-align:center;color:var(--slate-500);padding:40px">' +
                '<p style="font-size:2rem;margin-bottom:16px">üìñ</p>' +
                '<p style="font-size:1.1rem;margin-bottom:12px">Unable to load scripture.</p>' +
                '<p style="font-size:0.85rem;color:var(--slate-600)">This may be due to:</p>' +
                '<ul style="text-align:left;display:inline-block;font-size:0.85rem;color:var(--slate-600);margin:12px 0">' +
                '<li>No internet connection</li>' +
                '<li>Opening the file directly (use a local server)</li>' +
                '<li>API temporarily unavailable</li>' +
                '</ul>' +
                '<p style="font-size:0.8rem;margin-top:16px;padding:12px;background:var(--slate-800);border-radius:8px">' +
                '<strong style="color:var(--gold-500)">Quick Fix:</strong> Open browser console (F12) to see errors.<br>' +
                'Or try these embedded chapters: Genesis 1, Psalms 23, Ephesians 6, Romans 8</p>' +
                '</div>';
        }
        
        // Track reading progress
        markChapterRead(book, ch);

        const info = BIBLE[testament].find(function(b) { return b.name === book; });
        const bookData = BIBLE[testament].find(function(b) { return b.name === book; });
        const hasPrev = !(testament === 'OT' && book === 'Genesis' && ch === '1');
        const hasNext = !(testament === 'NT' && book === 'Revelation' && ch === '22');
        
        area.innerHTML = '<div class="chapter-header"><div class="chapter-book">' + book + '</div><div class="chapter-num">Chapter ' + ch + '</div><div class="chapter-theme">' + info.theme + '</div></div>' +
            '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:10px 0;border-bottom:1px dashed var(--slate-800)">' +
            '<button onclick="prevChapter()" style="padding:10px 16px;background:var(--slate-800);border:none;border-radius:6px;color:var(--slate-300);cursor:pointer;font-size:0.85rem" ' + (hasPrev ? '' : 'disabled style="opacity:0.3;cursor:not-allowed;padding:10px 16px;background:var(--slate-800);border:none;border-radius:6px;color:var(--slate-300);font-size:0.85rem"') + '>‚Üê Previous</button>' +
            '<button onclick="toggleBookmark()" id="bookmarkBtn" style="padding:10px 14px;background:' + (isBookmarked() ? 'rgba(212,165,55,0.2)' : 'transparent') + ';border:1px solid ' + (isBookmarked() ? 'var(--gold-500)' : 'var(--slate-700)') + ';border-radius:6px;color:' + (isBookmarked() ? 'var(--gold-500)' : 'var(--slate-400)') + ';cursor:pointer;font-size:1rem" title="Bookmark">üîñ</button>' +
            '<button onclick="nextChapter()" style="padding:10px 16px;background:var(--slate-800);border:none;border-radius:6px;color:var(--slate-300);cursor:pointer;font-size:0.85rem" ' + (hasNext ? '' : 'disabled style="opacity:0.3;cursor:not-allowed;padding:10px 16px;background:var(--slate-800);border:none;border-radius:6px;color:var(--slate-300);font-size:0.85rem"') + '>Next ‚Üí</button>' +
            '</div>' +
            '<div class="verses" id="versesContainer" style="font-size:' + fontSize + 'px">' + html + '</div>' +
            '<div style="display:flex;justify-content:space-between;margin-top:20px;padding-top:15px;border-top:1px dashed var(--slate-800)">' +
            '<button onclick="prevChapter()" style="padding:10px 16px;background:var(--slate-800);border:none;border-radius:6px;color:var(--slate-300);cursor:pointer;font-size:0.85rem" ' + (hasPrev ? '' : 'disabled style="opacity:0.3"') + '>‚Üê Previous Chapter</button>' +
            '<button onclick="nextChapter()" style="padding:10px 16px;background:var(--slate-800);border:none;border-radius:6px;color:var(--slate-300);cursor:pointer;font-size:0.85rem" ' + (hasNext ? '' : 'disabled style="opacity:0.3"') + '>Next Chapter ‚Üí</button>' +
            '</div>';

        // Update sidebars
        renderSidebars();
        document.getElementById('audioTitle').textContent = book + ' ' + ch;
        window.scrollTo(0, 0);
    }

    function renderSidebars() {
        const info = BIBLE[testament].find(function(b) { return b.name === book; });
        const gear = GEAR[book] || {icon:'üìñ',name:'THE WORD',desc:'Living'};
        const progress = getBookProgress(book);
        const progressPct = Math.round((progress.read / progress.total) * 100);
        const christData = CHRIST_IN_BOOK[book] || {title:'The Messiah', desc:'Jesus is revealed throughout all Scripture', ref:'Luke 24:27', type:'theme'};
        const typeLabels = {prophecy:'Prophecy', type:'Type/Shadow', appearance:'Appearance', fulfillment:'Fulfilled'};
        const identityData = IDENTITY_IN_BOOK[book] || {type:'I AM', text:'A child of God, more than a conqueror through Christ', ref:'Romans 8:37'};
        const contextData = BOOK_CONTEXT[book] || {author:'Unknown', date:'Ancient', audience:'God\'s people', setting:'Various', time:'Unknown'};
        const keyVerse = KEY_VERSES[book] || {ch:1, v:1, text:'The Word of God is living and active.', ref:book + ' 1:1'};
        
        // Estimate reading time (~200 words per minute, avg 25 words per verse)
        const totalVerses = info.ch * 25; // rough estimate
        const readingMins = Math.ceil((totalVerses * 25) / 200 / info.ch); // per chapter

        document.getElementById('leftSidebar').innerHTML = 
            '<div class="sidebar-title">‚è±Ô∏è READING TIME</div>' +
            '<div class="reading-time">' +
                '<span class="reading-time-icon">üìñ</span>' +
                '<span class="reading-time-text">This chapter: <span class="reading-time-value">~' + readingMins + ' min</span></span>' +
            '</div>' +
            '<div class="sidebar-title">‚≠ê KEY VERSE</div>' +
            '<div class="key-verse-box" onclick="goTo(\'' + book + '\',\'' + keyVerse.ch + '\')">' +
                '<div class="key-verse-label">üíé Memorize This</div>' +
                '<div class="key-verse-text">"' + keyVerse.text + '"</div>' +
                '<div class="key-verse-ref">' + book + ' ' + keyVerse.ch + ':' + keyVerse.v + '</div>' +
                '<div class="key-verse-actions">' +
                    '<button class="key-verse-btn" onclick="event.stopPropagation();memorizeKeyVerse()">üß† Memorize</button>' +
                    '<button class="key-verse-btn" onclick="event.stopPropagation();speakKeyVerse()">üîä Hear</button>' +
                '</div>' +
            '</div>' +
            '<div class="sidebar-title">üìú HISTORICAL CONTEXT</div>' +
            '<div class="context-box">' +
                '<div class="context-row"><span class="context-label">Author</span><span class="context-value">' + contextData.author + '</span></div>' +
                '<div class="context-row"><span class="context-label">Written</span><span class="context-value">' + contextData.date + '</span></div>' +
                '<div class="context-row"><span class="context-label">Audience</span><span class="context-value">' + contextData.audience + '</span></div>' +
                '<div class="context-row"><span class="context-label">Setting</span><span class="context-value">' + contextData.setting + '</span></div>' +
            '</div>' +
            '<div class="sidebar-title">READING PROGRESS</div>' +
            '<div class="book-progress">' +
                '<div class="book-progress-label"><span>' + book + '</span><span>' + progress.read + ' / ' + progress.total + '</span></div>' +
                '<div class="book-progress-bar"><div class="book-progress-fill" style="width:' + progressPct + '%"></div></div>' +
            '</div>';

        document.getElementById('rightSidebar').innerHTML = 
            '<div class="sidebar-title">‚úù CHRIST IN THIS BOOK</div>' +
            '<div class="christ-box">' +
                '<div class="christ-box-label">Jesus Revealed <span class="christ-box-type">' + typeLabels[christData.type] + '</span></div>' +
                '<div class="christ-box-title">' + christData.title + '</div>' +
                '<div class="christ-box-desc">' + christData.desc + '</div>' +
                '<div class="christ-box-ref">üìñ ' + christData.ref + '</div>' +
            '</div>' +
            '<div class="sidebar-title">üëë MY IDENTITY</div>' +
            '<div class="identity-box">' +
                '<div class="identity-box-label">In ' + book + '</div>' +
                '<div class="identity-box-type">' + identityData.type + '</div>' +
                '<div class="identity-box-text">"' + identityData.text + '"</div>' +
                '<div class="identity-box-ref">' + identityData.ref + '</div>' +
                '<div class="identity-box-actions">' +
                    '<button class="identity-btn speak" onclick="speakIdentity()">üîä Speak It</button>' +
                    '<button class="identity-btn next" onclick="cycleIdentity()">Next ‚Üí</button>' +
                '</div>' +
            '</div>' +
            '<div style="margin-top:16px"><div class="sidebar-title">QUICK ACTIONS</div>' +
            '<button class="btn danger" style="width:100%;margin-bottom:8px" onclick="openModal(\'warRoomModal\')">‚ö† War Room</button>' +
            '<button class="btn" style="width:100%;border-color:var(--azure);color:var(--azure)" onclick="openModal(\'qrfModal\')">‚ö° Q.R.F.</button></div>';
    }

    // Key Verse Functions
    function memorizeKeyVerse() {
        const keyVerse = KEY_VERSES[book];
        if (keyVerse) {
            const key = 'dsg-mem-' + book + '-' + keyVerse.ch + '-' + keyVerse.v;
            if (!localStorage.getItem(key)) {
                localStorage.setItem(key, JSON.stringify({
                    book: book,
                    chapter: keyVerse.ch,
                    verse: keyVerse.v,
                    text: keyVerse.text,
                    level: 'new',
                    added: new Date().toISOString()
                }));
                showToast('üß† Added to memory verses!');
            } else {
                showToast('Already in your memory list');
            }
        }
    }

    function speakKeyVerse() {
        const keyVerse = KEY_VERSES[book];
        if (keyVerse) {
            const text = book + ' chapter ' + keyVerse.ch + ' verse ' + keyVerse.v + '... ' + keyVerse.text;
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.85;
            synth.speak(utterance);
        }
    }

    function injectLexicon(text) {
        let result = text;
        Object.keys(LEXICON).forEach(function(key) {
            const regex = new RegExp('\\b(' + key + ')\\b', 'gi');
            result = result.replace(regex, '<span style="color:var(--azure);cursor:pointer;border-bottom:1px dotted var(--azure)" onclick="openLexicon(\'' + key + '\');event.stopPropagation()">$1</span>');
        });
        return result;
    }

    function toggleHighlight(b, c, v) {
        const key = 'dsg-hl-' + b + '-' + c + '-' + v;
        const verses = document.querySelectorAll('.verse');
        const verse = verses[v - 1];
        if (localStorage.getItem(key) === 'true') {
            localStorage.removeItem(key);
            if (verse) verse.classList.remove('highlighted');
        } else {
            localStorage.setItem(key, 'true');
            if (verse) verse.classList.add('highlighted');
        }
    }

    function saveLocation() {
        localStorage.setItem('dsg-location', JSON.stringify({t: testament, b: book, c: chapter}));
    }

    // === IDENTITY FUNCTIONS ===
    let identityIndex = 0;
    const EXTRA_IDENTITIES = [
        {type:'I AM', text:'More than a conqueror through Christ who loves me', ref:'Romans 8:37'},
        {type:'I AM', text:'The righteousness of God in Christ Jesus', ref:'2 Corinthians 5:21'},
        {type:'I AM', text:'Seated with Christ in heavenly places', ref:'Ephesians 2:6'},
        {type:'I AM', text:'A new creation ‚Äî the old has passed away', ref:'2 Corinthians 5:17'},
        {type:'I AM', text:'An ambassador for Christ', ref:'2 Corinthians 5:20'},
        {type:'I HAVE', text:'Not been given a spirit of fear, but of power, love, and a sound mind', ref:'2 Timothy 1:7'},
        {type:'I HAVE', text:'The mind of Christ', ref:'1 Corinthians 2:16'},
        {type:'I HAVE', text:'Authority to trample on serpents and scorpions', ref:'Luke 10:19'},
        {type:'I CAN', text:'Do all things through Christ who strengthens me', ref:'Philippians 4:13'},
        {type:'I CAN', text:'Approach the throne of grace with confidence', ref:'Hebrews 4:16'},
        {type:'GOD IS', text:'For me ‚Äî who can be against me?', ref:'Romans 8:31'},
        {type:'GOD IS', text:'Working all things together for my good', ref:'Romans 8:28'}
    ];

    function speakIdentity() {
        const identityData = IDENTITY_IN_BOOK[book] || EXTRA_IDENTITIES[0];
        const text = identityData.type + '... ' + identityData.text + '! From ' + identityData.ref;
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 0.85;
        synth.speak(utterance);
        showToast('üîä Speak it out loud!');
    }

    function cycleIdentity() {
        identityIndex = (identityIndex + 1) % (EXTRA_IDENTITIES.length + 1);
        
        let identityData;
        if (identityIndex === 0) {
            identityData = IDENTITY_IN_BOOK[book] || EXTRA_IDENTITIES[0];
        } else {
            identityData = EXTRA_IDENTITIES[identityIndex - 1];
        }
        
        const box = document.querySelector('.identity-box');
        if (box) {
            box.querySelector('.identity-box-label').textContent = identityIndex === 0 ? 'In ' + book : 'Declaration';
            box.querySelector('.identity-box-type').textContent = identityData.type;
            box.querySelector('.identity-box-text').textContent = '"' + identityData.text + '"';
            box.querySelector('.identity-box-ref').textContent = identityData.ref;
        }
    }

    // === CHAPTER NAVIGATION ===
    function prevChapter() {
        let ch = parseInt(chapter);
        if (ch > 1) {
            renderChapter(String(ch - 1));
        } else {
            const books = BIBLE[testament];
            const idx = books.findIndex(function(b) { return b.name === book; });
            if (idx > 0) {
                book = books[idx - 1].name;
                chapter = String(books[idx - 1].ch);
                document.getElementById('bookSelect').value = book;
                loadBook();
            } else if (testament === 'NT') {
                testament = 'OT';
                const otBooks = BIBLE.OT;
                book = otBooks[otBooks.length - 1].name;
                chapter = String(otBooks[otBooks.length - 1].ch);
                document.getElementById('testamentSelect').value = 'OT';
                updateBooks();
            }
        }
    }

    function nextChapter() {
        const data = BIBLE[testament].find(function(b) { return b.name === book; });
        let ch = parseInt(chapter);
        if (ch < data.ch) {
            renderChapter(String(ch + 1));
        } else {
            const books = BIBLE[testament];
            const idx = books.findIndex(function(b) { return b.name === book; });
            if (idx < books.length - 1) {
                book = books[idx + 1].name;
                chapter = '1';
                document.getElementById('bookSelect').value = book;
                loadBook();
            } else if (testament === 'OT') {
                testament = 'NT';
                book = BIBLE.NT[0].name;
                chapter = '1';
                document.getElementById('testamentSelect').value = 'NT';
                updateBooks();
            }
        }
    }

    // === BOOKMARKS ===
    function isBookmarked() {
        const bookmarks = JSON.parse(localStorage.getItem('dsg-bookmarks') || '[]');
        return bookmarks.some(function(bm) { return bm.book === book && bm.chapter === chapter; });
    }

    function toggleBookmark() {
        let bookmarks = JSON.parse(localStorage.getItem('dsg-bookmarks') || '[]');
        const idx = bookmarks.findIndex(function(bm) { return bm.book === book && bm.chapter === chapter; });
        if (idx >= 0) {
            bookmarks.splice(idx, 1);
            showToast('Bookmark removed');
        } else {
            bookmarks.unshift({ book: book, chapter: chapter, date: new Date().toLocaleDateString() });
            showToast('Chapter bookmarked!');
        }
        localStorage.setItem('dsg-bookmarks', JSON.stringify(bookmarks));
        // Update button appearance
        const btn = document.getElementById('bookmarkBtn');
        if (btn) {
            const marked = isBookmarked();
            btn.style.background = marked ? 'rgba(212,165,55,0.2)' : 'transparent';
            btn.style.borderColor = marked ? 'var(--gold-500)' : 'var(--slate-700)';
            btn.style.color = marked ? 'var(--gold-500)' : 'var(--slate-400)';
        }
    }

    function showToast(message) {
        // Create toast if doesn't exist
        let toast = document.getElementById('toast');
        if (!toast) {
            toast = document.createElement('div');
            toast.id = 'toast';
            toast.style.cssText = 'position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--slate-800);border:1px solid var(--gold-500);padding:12px 24px;border-radius:8px;font-size:0.85rem;z-index:9999;opacity:0;transition:all 0.3s;pointer-events:none;color:var(--slate-200)';
            document.body.appendChild(toast);
        }
        toast.textContent = message;
        toast.style.opacity = '1';
        toast.style.transform = 'translateX(-50%) translateY(0)';
        setTimeout(function() {
            toast.style.opacity = '0';
            toast.style.transform = 'translateX(-50%) translateY(20px)';
        }, 2500);
    }

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
        if (e.key === 'ArrowLeft') prevChapter();
        if (e.key === 'ArrowRight') nextChapter();
    });

    // === NOTES ===
    function loadNotes() {
        const key = 'dsg-notes-' + book + '-' + chapter;
        const notes = localStorage.getItem(key) || '';
        document.getElementById('notesArea').value = notes;
        document.getElementById('notesLabel').textContent = 'Battle Log: ' + book + ' ' + chapter;
        
        document.getElementById('notesArea').oninput = function() {
            localStorage.setItem(key, this.value);
            document.getElementById('saveStatus').textContent = 'Saving...';
            setTimeout(function() {
                document.getElementById('saveStatus').textContent = 'Auto-saved';
            }, 500);
        };
    }

    // === TARGETS ===
    function loadTargets() {
        const targets = JSON.parse(localStorage.getItem('dsg-targets') || '[]');
        const list = document.getElementById('targetList');
        if (targets.length === 0) {
            list.innerHTML = '<p style="color:var(--slate-600);text-align:center">No targets yet.</p>';
            return;
        }
        list.innerHTML = targets.map(function(t, i) {
            return '<div class="target-item ' + (t.done ? 'done' : '') + '"><span onclick="toggleTarget(' + i + ')">' + t.text + '</span><button onclick="deleteTarget(' + i + ')">‚úï</button></div>';
        }).join('');
    }

    function addTarget() {
        const input = document.getElementById('targetInput');
        const text = input.value.trim();
        if (!text) return;
        const targets = JSON.parse(localStorage.getItem('dsg-targets') || '[]');
        targets.push({text: text, done: false});
        localStorage.setItem('dsg-targets', JSON.stringify(targets));
        input.value = '';
        loadTargets();
    }

    function toggleTarget(i) {
        const targets = JSON.parse(localStorage.getItem('dsg-targets') || '[]');
        targets[i].done = !targets[i].done;
        localStorage.setItem('dsg-targets', JSON.stringify(targets));
        loadTargets();
    }

    function deleteTarget(i) {
        const targets = JSON.parse(localStorage.getItem('dsg-targets') || '[]');
        targets.splice(i, 1);
        localStorage.setItem('dsg-targets', JSON.stringify(targets));
        loadTargets();
    }

    // === ARMOR ===
    function loadArmor() {
        ['belt','plate','shoes','shield','helmet','sword'].forEach(function(p) {
            if (localStorage.getItem('dsg-armor-' + p) === 'true') {
                document.getElementById('armor-' + p).classList.add('equipped');
            }
        });
    }

    function toggleArmor(piece) {
        const el = document.getElementById('armor-' + piece);
        const key = 'dsg-armor-' + piece;
        if (localStorage.getItem(key) === 'true') {
            localStorage.removeItem(key);
            el.classList.remove('equipped');
        } else {
            localStorage.setItem(key, 'true');
            el.classList.add('equipped');
        }
    }

    // === AUDIO ===
    function toggleAudio() {
        if (speaking) {
            cancelAudio();
        } else {
            playAudio();
        }
    }

    function playAudio() {
        const container = document.getElementById('versesContainer');
        if (!container) return;
        const text = container.innerText;
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 0.9;
        utterance.onstart = function() {
            speaking = true;
            document.getElementById('audioBtn').textContent = '‚è∏';
        };
        utterance.onend = function() {
            speaking = false;
            document.getElementById('audioBtn').textContent = '‚ñ∂';
        };
        synth.speak(utterance);
    }

    function cancelAudio() {
        synth.cancel();
        speaking = false;
        document.getElementById('audioBtn').textContent = '‚ñ∂';
    }

    // === DRAWER ===
    function toggleDrawer() {
        document.getElementById('drawer').classList.toggle('open');
        document.getElementById('drawerOverlay').classList.toggle('open');
    }

    function switchDrawerTab(btn, tabId) {
        document.querySelectorAll('.drawer-tab').forEach(function(t) { t.classList.remove('active'); });
        document.querySelectorAll('.drawer-body').forEach(function(b) { b.classList.remove('active'); });
        btn.classList.add('active');
        document.getElementById(tabId).classList.add('active');
    }

    // === FOCUS MODE ===
    function toggleFocus() {
        const main = document.getElementById('mainContent');
        const left = document.getElementById('leftSidebar');
        const right = document.getElementById('rightSidebar');
        if (left.style.display === 'none') {
            left.style.display = '';
            right.style.display = '';
            main.style.gridTemplateColumns = '250px 1fr 260px';
        } else {
            left.style.display = 'none';
            right.style.display = 'none';
            main.style.gridTemplateColumns = '1fr';
        }
    }

    // === MODALS ===
    function openModal(id) {
        document.getElementById(id).classList.add('open');
        if (id === 'codebookModal') initCodebook();
        if (id === 'arsenalModal') initArsenal();
        if (id === 'bootcampModal') initBootcamp();
        if (id === 'qrfModal') initQRF();
        if (id === 'warRoomModal') initWarRoom();
        if (id === 'memoryModal') initMemoryModal();
        if (id === 'victoryModal') loadVictories();
        if (id === 'streakModal') loadStreakModal();
        if (id === 'plansModal') loadPlansModal();
        if (id === 'declareModal') loadDeclarationsModal();
        if (id === 'introModal') loadBookIntro();
        if (id === 'topicsModal') loadTopicsModal();
        if (id === 'searchModal') document.getElementById('searchInput').focus();
    }

    function closeModal(id) {
        document.getElementById(id).classList.remove('open');
    }

    // === LEXICON ===
    function openLexicon(key) {
        const data = LEXICON[key];
        if (!data) return;
        document.getElementById('lexWord').textContent = data.word;
        document.getElementById('lexPhonetic').textContent = data.phonetic;
        document.getElementById('lexDef').textContent = data.def;
        document.getElementById('lexApp').textContent = data.app;
        openModal('lexiconModal');
    }

    function initCodebook() {
        const list = document.getElementById('codebookList');
        list.innerHTML = Object.keys(LEXICON).map(function(k) {
            const d = LEXICON[k];
            return '<div class="codebook-item" onclick="openLexicon(\'' + k + '\')"><div class="word">' + d.word + '</div><div class="term">' + k + '</div><div class="def">' + d.def + '</div></div>';
        }).join('');
    }

    // === SEARCH ===
    function performSearch() {
        const query = document.getElementById('searchInput').value.toLowerCase().trim();
        const results = document.getElementById('searchResults');
        
        if (query.length < 2) {
            results.innerHTML = '<p style="color:var(--slate-500);text-align:center">Enter at least 2 characters...</p>';
            return;
        }
        
        if (searchMode === 'books') {
            searchBooks(query);
        } else {
            searchVerses(query);
        }
    }

    function setSearchMode(mode) {
        searchMode = mode;
        document.getElementById('searchModeBooks').style.borderColor = mode === 'books' ? 'var(--gold-500)' : 'var(--slate-700)';
        document.getElementById('searchModeBooks').style.color = mode === 'books' ? 'var(--gold-500)' : 'var(--slate-400)';
        document.getElementById('searchModeVerses').style.borderColor = mode === 'verses' ? 'var(--gold-500)' : 'var(--slate-700)';
        document.getElementById('searchModeVerses').style.color = mode === 'verses' ? 'var(--gold-500)' : 'var(--slate-400)';
        document.getElementById('searchInput').placeholder = mode === 'books' ? 'Search book names or themes...' : 'Search verse content (e.g., "fear not", "love")...';
        document.getElementById('searchResults').innerHTML = '<p style="color:var(--slate-500);text-align:center">Enter a search term...</p>';
    }

    function searchBooks(query) {
        const results = document.getElementById('searchResults');
        let matches = [];
        ['OT', 'NT'].forEach(function(t) {
            BIBLE[t].forEach(function(b) {
                if (b.name.toLowerCase().includes(query) || b.theme.toLowerCase().includes(query)) {
                    matches.push({book: b.name, theme: b.theme, testament: t});
                }
            });
        });
        if (matches.length === 0) {
            results.innerHTML = '<p style="color:var(--slate-500);text-align:center">No books found matching "' + query + '"</p>';
            return;
        }
        results.innerHTML = matches.slice(0, 15).map(function(m) {
            return '<div class="search-item" onclick="goTo(\'' + m.book + '\',\'1\');closeModal(\'searchModal\')"><strong>' + m.book + '</strong> <span style="opacity:0.5">(' + m.testament + ')</span><span> ‚Äî ' + m.theme + '</span></div>';
        }).join('');
    }

    async function searchVerses(query) {
        const results = document.getElementById('searchResults');
        const loading = document.getElementById('searchLoading');
        
        loading.style.display = 'block';
        results.innerHTML = '';
        
        try {
            // Search using Bible API
            const response = await fetch('https://bible-api.com/' + encodeURIComponent(query) + '?translation=asv');
            
            if (response.ok) {
                const data = await response.json();
                loading.style.display = 'none';
                
                if (data.verses && data.verses.length > 0) {
                    results.innerHTML = data.verses.slice(0, 20).map(function(v) {
                        const highlighted = highlightQuery(v.text, query);
                        return '<div class="search-verse" onclick="goToSearchResult(\'' + v.book_name + '\',' + v.chapter + ')">' +
                            '<div class="search-verse-ref">' + v.book_name + ' ' + v.chapter + ':' + v.verse + '</div>' +
                            '<div class="search-verse-text">' + highlighted + '</div>' +
                        '</div>';
                    }).join('');
                    return;
                }
            }
            
            // Fallback: search embedded content
            searchEmbeddedVerses(query);
            
        } catch(e) {
            console.log('API search failed, searching embedded content');
            searchEmbeddedVerses(query);
        }
    }

    function searchEmbeddedVerses(query) {
        const results = document.getElementById('searchResults');
        const loading = document.getElementById('searchLoading');
        loading.style.display = 'none';
        
        let matches = [];
        
        // Search through SCRIPTURE_FALLBACK
        Object.keys(SCRIPTURE_FALLBACK).forEach(function(key) {
            const parts = key.split('-');
            const bookName = parts[0];
            const chapterNum = parts[1];
            
            SCRIPTURE_FALLBACK[key].forEach(function(v) {
                if (v.text.toLowerCase().includes(query)) {
                    matches.push({
                        book: bookName,
                        chapter: chapterNum,
                        verse: v.verse,
                        text: v.text
                    });
                }
            });
        });
        
        // Also search Verses of the Day
        VERSES_OF_DAY.forEach(function(v) {
            if (v.text.toLowerCase().includes(query)) {
                const parts = v.ref.split(' ');
                matches.push({
                    book: parts.slice(0, -1).join(' '),
                    chapter: parts[parts.length - 1].split(':')[0],
                    verse: parts[parts.length - 1].split(':')[1] || '1',
                    text: v.text
                });
            }
        });
        
        if (matches.length === 0) {
            results.innerHTML = '<p style="color:var(--slate-500);text-align:center">No verses found containing "' + query + '"</p>' +
                '<p style="color:var(--slate-600);text-align:center;font-size:0.8rem;margin-top:8px">Try searching for common words like "love", "faith", "fear", "peace"</p>';
            return;
        }
        
        results.innerHTML = matches.slice(0, 20).map(function(m) {
            const highlighted = highlightQuery(m.text, query);
            return '<div class="search-verse" onclick="goTo(\'' + m.book + '\',\'' + m.chapter + '\');closeModal(\'searchModal\')">' +
                '<div class="search-verse-ref">' + m.book + ' ' + m.chapter + ':' + m.verse + '</div>' +
                '<div class="search-verse-text">' + highlighted + '</div>' +
            '</div>';
        }).join('');
    }

    function highlightQuery(text, query) {
        const regex = new RegExp('(' + query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'gi');
        return text.replace(regex, '<mark>$1</mark>');
    }

    function goToSearchResult(bookName, chapterNum) {
        goTo(bookName, String(chapterNum));
        closeModal('searchModal');
    }

    // === THEME & FONT ===
    function toggleTheme() {
        const body = document.body;
        const toggle = document.getElementById('themeToggle');
        
        if (body.classList.contains('light-theme')) {
            body.classList.remove('light-theme');
            toggle.textContent = 'üåô';
            localStorage.setItem('dsg-theme', 'dark');
            showToast('üåô Dark mode');
        } else {
            body.classList.add('light-theme');
            toggle.textContent = '‚òÄÔ∏è';
            localStorage.setItem('dsg-theme', 'light');
            showToast('‚òÄÔ∏è Light mode');
        }
    }

    function adjustFontSize(delta) {
        fontSize = Math.max(14, Math.min(28, fontSize + delta));
        localStorage.setItem('dsg-font-size', fontSize);
        const versesContainer = document.getElementById('versesContainer');
        if (versesContainer) {
            versesContainer.style.fontSize = fontSize + 'px';
        }
        showToast('Font size: ' + fontSize + 'px');
    }

    // === ARSENAL ===
    function initArsenal() {
        const list = document.getElementById('arsenalList');
        let items = [];
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('dsg-hl-')) {
                const parts = key.split('-');
                items.push({type: 'highlight', book: parts[2], ch: parts[3], v: parts[4]});
            }
            if (key.startsWith('dsg-notes-') && localStorage.getItem(key).trim()) {
                const parts = key.split('-');
                items.push({type: 'note', book: parts[2], ch: parts[3]});
            }
        }
        if (items.length === 0) {
            list.innerHTML = '<p style="color:var(--slate-500);text-align:center">No intel collected yet.</p>';
            return;
        }
        list.innerHTML = items.map(function(item) {
            if (item.type === 'highlight') {
                return '<div class="arsenal-item" onclick="goTo(\'' + item.book + '\',\'' + item.ch + '\');closeModal(\'arsenalModal\')"><div class="type">Highlight</div><div class="ref">' + item.book + ' ' + item.ch + ':' + item.v + '</div></div>';
            } else {
                return '<div class="arsenal-item" onclick="goTo(\'' + item.book + '\',\'' + item.ch + '\');toggleDrawer();closeModal(\'arsenalModal\')"><div class="type">Field Note</div><div class="ref">' + item.book + ' ' + item.ch + '</div></div>';
            }
        }).join('');
    }

    function exportData() {
        const data = {highlights: [], notes: [], targets: [], armor: {}};
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const val = localStorage.getItem(key);
            if (key.startsWith('dsg-hl-')) data.highlights.push(key);
            if (key.startsWith('dsg-notes-')) data.notes.push({key: key, text: val});
            if (key.startsWith('dsg-armor-')) data.armor[key] = val;
        }
        data.targets = JSON.parse(localStorage.getItem('dsg-targets') || '[]');
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'dsg-bookclub-backup.json';
        a.click();
    }

    function importData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (data.highlights) data.highlights.forEach(function(k) { localStorage.setItem(k, 'true'); });
                if (data.notes) data.notes.forEach(function(n) { localStorage.setItem(n.key, n.text); });
                if (data.armor) Object.keys(data.armor).forEach(function(k) { localStorage.setItem(k, data.armor[k]); });
                if (data.targets) localStorage.setItem('dsg-targets', JSON.stringify(data.targets));
                alert('Data restored! Reloading...');
                location.reload();
            } catch (err) {
                alert('Invalid backup file.');
            }
        };
        reader.readAsText(file);
    }

    // === BOOTCAMP ===
    function initBootcamp() {
        const list = document.getElementById('bootcampList');
        list.innerHTML = BOOTCAMP.map(function(m, mi) {
            return '<div class="bootcamp-item" onclick="this.classList.toggle(\'expanded\')"><div class="badge">MODULE ' + (mi + 1) + '</div><h4>' + m.title + '</h4><p>' + m.desc + '</p><div class="bootcamp-verses">' + m.verses.map(function(v, vi) {
                const done = localStorage.getItem('dsg-mission-' + mi + '-' + vi) === 'true';
                return '<div class="bootcamp-verse" onclick="completeMission(' + mi + ',' + vi + ',\'' + v.t + '\');event.stopPropagation()"><span>' + v.t + ' - ' + v.l + '</span><span class="check ' + (done ? 'done' : '') + '">' + (done ? '‚úî' : '‚óã') + '</span></div>';
            }).join('') + '</div></div>';
        }).join('');
    }

    function completeMission(mi, vi, ref) {
        localStorage.setItem('dsg-mission-' + mi + '-' + vi, 'true');
        const parts = ref.split(' ');
        const bk = parts.length > 1 ? parts.slice(0, -1).join(' ') : parts[0];
        const ch = parts[parts.length - 1];
        goTo(bk, ch);
        closeModal('bootcampModal');
    }

    // === QRF ===
    function initQRF() {
        const grid = document.getElementById('qrfGrid');
        grid.innerHTML = Object.keys(QRF_DATA).map(function(k) {
            return '<button class="qrf-btn" onclick="loadQRF(\'' + k + '\')"><span class="icon">‚ö°</span>' + k + '</button>';
        }).join('');
        grid.style.display = 'grid';
        document.getElementById('qrfContent').classList.remove('active');
    }

    function loadQRF(key) {
        const data = QRF_DATA[key];
        document.getElementById('qrfGrid').style.display = 'none';
        document.getElementById('qrfContent').classList.add('active');
        document.getElementById('qrfTitle').textContent = data.title;
        document.getElementById('qrfTactic').textContent = 'TACTIC: ' + data.tactic;
        document.getElementById('qrfVerses').innerHTML = data.verses.map(function(v) {
            return '<div class="qrf-verse"><strong>' + v.ref + '</strong><span>' + v.text + '</span></div>';
        }).join('');
    }

    function resetQRF() {
        document.getElementById('qrfGrid').style.display = 'grid';
        document.getElementById('qrfContent').classList.remove('active');
    }

    // === WAR ROOM ===
    function initWarRoom() {
        document.getElementById('warRoomTitle').textContent = 'War Room: ' + book;
        const info = BIBLE[testament].find(function(b) { return b.name === book; });
        document.getElementById('sectorTactics').innerHTML = '<div class="card gold"><div class="card-label">Current Sector</div><div class="card-title">' + book + ' - ' + info.theme + '</div><div class="card-text">Apply this strategic theme to your current situation.</div></div>';
        
        document.getElementById('defenseGrid').innerHTML = Object.keys(DEFENSES).map(function(k) {
            return '<button class="strat-btn" onclick="showDefense(\'' + k + '\')">' + k.toUpperCase() + '</button>';
        }).join('');
        
        document.getElementById('strategyDetails').innerHTML = Object.keys(DEFENSES).map(function(k) {
            const d = DEFENSES[k];
            return '<div class="strat-detail" id="defense-' + k + '"><h4>' + d.title + '</h4><div class="verse">' + d.verse + '</div></div>';
        }).join('');
    }

    function showDefense(key) {
        document.querySelectorAll('.strat-detail').forEach(function(d) { d.classList.remove('active'); });
        document.querySelectorAll('.strat-btn').forEach(function(b) { b.classList.remove('active'); });
        document.getElementById('defense-' + key).classList.add('active');
        event.target.classList.add('active');
    }

    // === BOOK INTRODUCTION ===
    function loadBookIntro() {
        const intro = BOOK_INTROS[book];
        if (!intro) {
            document.getElementById('introContent').innerHTML = '<p style="color:var(--slate-400);text-align:center">Introduction coming soon...</p>';
            return;
        }
        
        document.getElementById('introBookName').textContent = book;
        document.getElementById('introPurpose').textContent = intro.purpose;
        
        document.getElementById('introOutline').innerHTML = intro.outline.map(function(item) {
            return '<li>' + item + '</li>';
        }).join('');
        
        document.getElementById('introThemes').innerHTML = intro.themes.map(function(theme) {
            return '<span class="intro-theme">' + theme + '</span>';
        }).join('');
    }

    // === TOPICAL INDEX ===
    let currentTopic = null;

    function loadTopicsModal() {
        showTopicsList();
        
        const grid = document.getElementById('topicGrid');
        grid.innerHTML = Object.keys(TOPICAL_INDEX).map(function(topic) {
            return '<button class="topic-btn" onclick="showTopic(\'' + topic + '\')">' + topic + '</button>';
        }).join('');
    }

    function showTopicsList() {
        document.getElementById('topicsList').style.display = 'block';
        document.getElementById('topicVerses').classList.remove('active');
        currentTopic = null;
    }

    function showTopic(topic) {
        currentTopic = topic;
        const verses = TOPICAL_INDEX[topic];
        
        document.getElementById('topicsList').style.display = 'none';
        document.getElementById('topicVerses').classList.add('active');
        document.getElementById('topicTitle').textContent = topic + ' (' + verses.length + ' verses)';
        
        document.getElementById('topicVersesList').innerHTML = verses.map(function(v) {
            return '<div class="topic-verse" onclick="goToTopicVerse(\'' + v.ref + '\')">' +
                '<div class="topic-verse-ref">üìñ ' + v.ref + '</div>' +
                '<div class="topic-verse-text">"' + v.text + '"</div>' +
            '</div>';
        }).join('');
    }

    function goToTopicVerse(ref) {
        // Parse reference like "John 3:16" or "1 Corinthians 13:4-7"
        const parts = ref.split(' ');
        let bookName, chapterVerse;
        
        if (parts[0].match(/^\d/)) {
            // Book starts with number like "1 Corinthians"
            bookName = parts[0] + ' ' + parts[1];
            chapterVerse = parts[2];
        } else {
            bookName = parts[0];
            chapterVerse = parts[1];
        }
        
        const chapter = chapterVerse.split(':')[0];
        goTo(bookName, chapter);
        closeModal('topicsModal');
    }

    // === PWA SERVICE WORKER REGISTRATION ===
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
            navigator.serviceWorker.register('sw.js')
                .then(function(registration) {
                    console.log('ServiceWorker registered:', registration.scope);
                })
                .catch(function(error) {
                    console.log('ServiceWorker registration failed:', error);
                });
        });
    }
    </script>
</body>
</html>
